<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title></title>
  
  <link rel="stylesheet" href="asset/bootstrap-3.1.1-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="asset/bootstrap-3.1.1-dist/css/bootstrap-theme.min.css">

  <link rel="stylesheet" href="./css/memo.css">

  <link  href="asset/vis/dist/vis.css" rel="stylesheet" type="text/css" />
  <script src="asset/vis/dist/vis.js"></script>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body>
<template id=varin>
<div class="form-group">
<label class="control-label col-xs-6">{{ label }}</label>
<div class="col-xs-6">
<input class="form-control" :id=label :value="value" v-on:input="onInput" onClick="this.select();" type="text" />
</div>
</div>
<p></template></p>
<ul class="nav flex-column menu">
<li class="nav-item" v-for="title in titles">
<a class="nav-link active" v-bind:href="'#'+title.href">{{ title.title }}</a>
</li>
</ul>


<h1 id="tar">tar</h1>
<p>「いつもの tar」ベストプラクティス</p>
<h2 id="要件">要件</h2>
<ul>
<li>対象はいつも同じファイル（ディレクトリ）</li>
<li>なので対象をリスト化して置いときたい</li>
<li>しかも、フルパスで（どこにインストールされても同じ動き）</li>
<li>だけどたまにはスキップしたいものもある（コメントアウトしたい）</li>
</ul>
<h2 id="ある種の実装">ある種の実装</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -v -e <span class="st">&#39;^\s*#&#39;</span> -e <span class="st">&#39;^\s*$&#39;</span> <span class="ot">${PWD}</span>/TARGETS.txt <span class="kw">&gt;</span> <span class="ot">${PWD}</span>/TARGETS.txt.tmp
<span class="kw">tar</span> zcf <span class="ot">${LOGD}</span>/all.tgz -C / --files-from=<span class="ot">${PWD}</span>/TARGETS.txt.tmp
<span class="kw">rm</span> -rf <span class="ot">${PWD}</span>/TARGETS.txt.tmp</code></pre>
<ul>
<li>TARGETS.txt がアーカイブ対象のリスト（コメント入り、改行区切り）</li>
<li>grep でコメント(#)行、空行を除外</li>
<li>それを tar の --files-from= に食わせている</li>
<li>tar の -C / は、 cd / の動き</li>
</ul>
<h1 id="rust">Rust</h1>
<h2 id="cargo">Cargo</h2>
<h3 id="create-new-bin">create new bin</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cargo</span> new --bin <span class="dt">{binname}</span>
<span class="kw">cd</span> <span class="dt">{binname}</span></code></pre>
<h2 id="cross-compile">cross compile</h2>
<h3 id="win64">win64</h3>
<h4 id="yum">yum</h4>
<pre class="sh"><code>sudo yum install -y mingw64-gcc
sudo yum install -y mingw64-winpthreads-static
# ??? sudo yum install -y glibc-static</code></pre>
<h4 id="cargoconfig">~/.cargo/config</h4>
<pre class="sh"><code>[target.x86_64-pc-windows-gnu]
linker = &quot;/usr/bin/x86_64-w64-mingw32-gcc&quot;</code></pre>
<h4 id="add-target">ADD TARGET</h4>
<pre class="sh"><code>rustup target add x86_64-pc-windows-gnu</code></pre>
<h4 id="build">BUILD</h4>
<pre class="sh"><code>cargo build --target x86_64-pc-windows-gnu</code></pre>
<h1 id="appium">Appium</h1>
<h2 id="windows-application-driver">Windows Application Driver</h2>
<h3 id="install">Install</h3>
<pre class="sh"><code>msiexec /i WindowsApplicationDriver.msi /q
setx /M PATH &quot;%PATH%;C:\Program Files (x86)\Windows Application Driver&quot;</code></pre>
<h3 id="run">Run</h3>
<p>Settings &gt; Update &amp; Security &gt; For Developers</p>
<h4 id="new-prompt">New Prompt</h4>
<pre class="sh"><code>WinAppDriver.exe</code></pre>
<h2 id="appium-python-client">Appium-Python-Client</h2>
<h3 id="install-1">Install</h3>
<pre class="sh"><code>python-3.6.2-amd64.exe /install /quiet
setx /M PATH &quot;%PATH%;C:\Users\IEUser\AppData\Local\Programs\Python\Python36\Scripts\&quot;
setx /M PATH &quot;%PATH%;C:\Users\IEUser\AppData\Local\Programs\Python\Python36\&quot;</code></pre>
<h4 id="new-prompt-1">New Prompt</h4>
<pre class="sh"><code>pip install Appium-Python-Client</code></pre>
<h2 id="test">TEST</h2>
<h3 id="notepad.exe">notepad.exe</h3>
<pre class="py"><code>import unittest
from appium import webdriver
from selenium.webdriver.common.keys import Keys


class NotepadTests(unittest.TestCase):

    def setUp(self):
        desired_caps = {}
        desired_caps[&quot;app&quot;] = &quot;C:\\Windows\\System32\\notepad.exe&quot;
        self.driver = webdriver.Remote(command_executor=&#39;http://127.0.0.1:4723&#39;, desired_capabilities=desired_caps)
        self.driver.find_element_by_name(&#39;Maximize&#39;).click()

    def tearDown(self):
        self.driver.quit()

    def test_01_01_01_helpmenu(self):
        self.driver.find_element_by_name(&quot;Help&quot;).click()
        self.driver.find_element_by_name(&quot;About Notepad&quot;).click()
        self.driver.save_screenshot(&quot;evi/about.png&quot;)
        self.driver.find_element_by_name(&quot;OK&quot;).click()

    def test_01_02_01_textinput(self):
        inputdata = &#39;hello automation&#39;
        self.driver.find_element_by_name(&#39;Text Editor&#39;).send_keys(inputdata)
        self.driver.save_screenshot(&quot;evi/type.png&quot;)
        result = str(self.driver.find_element_by_name(&#39;Text Editor&#39;).get_attribute(&#39;Value.Value&#39;))
        self.driver.find_element_by_name(&#39;Text Editor&#39;).clear()
        self.assertEqual(result, inputdata)


if __name__ == &#39;__main__&#39;:
    suite = unittest.TestLoader().loadTestsFromTestCase(NotepadTests)
    unittest.TextTestRunner(verbosity=2).run(suite)</code></pre>
<h1 id="selenium">selenium</h1>
<h2 id="install-2">install</h2>
<h3 id="selenium-1">selenium</h3>
<pre class="sh"><code># pip
sudo apt-get install python-pip
# selenium
sudo pip install selenium</code></pre>
<h3 id="webdriver">WebDriver</h3>
<p>ブラウザごとに実行環境に合うものをダウンロードして、$PATH にコピーする。</p>
<h2 id="hello-world">hello world</h2>
<pre class="py"><code>#!/usr/bin/env python

from selenium import webdriver

browser = webdriver.Firefox()
browser.get(&#39;http://www.ubuntu.com/&#39;)</code></pre>
<h1 id="clamav">CLAMAV</h1>
<h2 id="hand-scan">hand scan</h2>
<pre class="sh"><code>sudo clamscan --infected --remove --recursive ./</code></pre>
<h1 id="vsrx">vSRX</h1>
<pre class="sh"><code>vagrant plugin install vagrant-junos
vagrant plugin install vagrant-host-shell</code></pre>
<p>ffi のコンパイルがどうのと出たら</p>
<pre class="sh"><code>sudo apt-get install ruby-dev</code></pre>
<h4 id="vagrantfile">Vagrantfile</h4>
<pre class="sourceCode ruby"><code class="sourceCode ruby"><span class="co"># -*- mode: ruby -*-</span>
<span class="co"># vi: set ft=ruby :</span>
<span class="dt">Vagrant</span>.configure(<span class="st">&quot;2&quot;</span>) <span class="kw">do</span> |config|
  config.vm.box = <span class="st">&quot;juniper/vqfx10k-re&quot;</span>
  config.vm.box_check_update = <span class="dv">false</span>
  config.ssh.insert_key = <span class="dv">false</span>
<span class="kw">end</span></code></pre>
<h1 id="raid">RAID</h1>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-raid',data:{label:''
,hdd1: '/dev/sdd'
,hdd2: '/dev/sde'
,mdx:  '/dev/md1'
}});})</script>

<div id="app-raid">
<form class="form-horizontal">
<varin label="HDD-1"  v-model="hdd1"></varin> <varin label="HDD-2"  v-model="hdd2"></varin> <varin label="md no." v-model="mdx"></varin>
</form>

<h2 id="hdd-setup">HDD SETUP</h2>
<h3 id="parted">parted</h3>
<h4 id="hdd1">{{hdd1}}</h4>
<pre class="sh"><code>parted -s {{hdd1}} &quot;mklabel gpt&quot;
parted -s {{hdd1}} &quot;mkpart primary 0% 100%&quot;
parted -s {{hdd1}} &quot;set 1 raid on&quot;</code></pre>
<h4 id="hdd2">{{hdd2}}</h4>
<pre class="sh"><code>parted -s {{hdd2}} &quot;mklabel gpt&quot;
parted -s {{hdd2}} &quot;mkpart primary 0% 100%&quot;
parted -s {{hdd2}} &quot;set 1 raid on&quot;</code></pre>
<h2 id="make-raid">MAKE RAID</h2>
<h4 id="raid-1">RAID-1</h4>
<pre class="sh"><code>mdadm --create {{mdx}} --level=raid1 --raid-devices=2 {{hdd1}} {{hdd2}}</code></pre>
<p>[y], [RET]</p>
<h2 id="check">CHECK</h2>
<pre class="sh"><code>watch -d -n 2 cat /proc/mdstat</code></pre>
<p>[UU] is OK</p>
</div>


<h1 id="vuecomponent">VueComponent</h1>
<script>window.addEventListener('load', function () {
new Vue({el:'#app1',data:{label:''
,input1: '$input1'
,input2: '$input2'
}});})</script>

<div id="app1">
<form class="form-horizontal">
<varin label="input1" v-model="input1"></varin> <varin label="input2" v-model="input2"></varin>
</form>

<h2 id="h2">h2</h2>
<pre><code>L1 is {{ input1 }}
L2 is {{ input2 }}</code></pre>
</div>


<h1 id="checksum">Checksum</h1>
<script>window.addEventListener('load', function () {
new Vue({el:'#Checksum', data: {label:''
,filename:'$FILENAME'
}});})</script>

<div id='Checksum'>
<form class="form-horizontal">
<varin label="TARGET FILE NAME" v-model="filename"></varin>
</form>

<h4 id="on-windows">on Windows</h4>
<p>Apprication Control に手動追加するときに必要。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">certutil</span> -hashfile {{ filename }} <span class="kw">SHA1</span></code></pre>
<h4 id="on-linux">on Linux</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">md5sum</span> {{ filename }}</code></pre>
</div>

<h1 id="neo4j">neo4j</h1>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> (a_san<span class="ch">:Person</span> { name:<span class="ot">&quot;Aさん&quot;</span>, 所属:<span class="ot">&quot;開発部&quot;</span>})
<span class="kw">create</span> (b_san<span class="ch">:Person</span> { name:<span class="ot">&quot;Bさん&quot;</span>, 所属:<span class="ot">&quot;経理部&quot;</span>})

<span class="kw">create</span> (a_san)-[r:知ってる]-&gt;(b_san)

match (a_san<span class="ch">:Person</span>),(b_san<span class="ch">:Person</span>)
<span class="kw">where</span> a_san.name=<span class="ot">&quot;Aさん&quot;</span> <span class="kw">and</span> b_san.name=<span class="ot">&quot;Bさん&quot;</span>
<span class="kw">create</span> (a_san)-[r:知ってる]-&gt;(b_san)
<span class="kw">return</span> r;</code></pre>
<h2 id="misk">misk</h2>
<p>いらんイメージ消して、docker 再起動したらいけた。謎。</p>
<pre><code>ERROR: for neo4j  Cannot start service neo4j: oci runtime error: process_linux.go:330: running prestart hook 0 caused &quot;fork/exec /usr/bin/dockerd (deleted): no such file or directory: &quot;</code></pre>
<h1 id="hecate">hecate</h1>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">go</span> get -u github.com/evanmiller/hecate</code></pre>
<h1 id="postgres">POSTGRES</h1>
<h2 id="client">CLIENT</h2>
<h3 id="connect">CONNECT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">psql</span> -h <span class="dt">{PG_SRV_ADDRESS}</span> -U <span class="dt">{PG_USER}</span></code></pre>
<h2 id="database">Database</h2>
<h3 id="list">list</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">\l</code></pre>
<h3 id="connect-1">Connect</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">\c {TABLENAME}</code></pre>
<h2 id="table">Table</h2>
<h3 id="list-1">list</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">\dt</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> table_name <span class="kw">from</span> INFORMATION_SCHEMA.tables;</code></pre>
<h2 id="view">View</h2>
<h3 id="list-2">list</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">\dv</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> table_name <span class="kw">from</span> INFORMATION_SCHEMA.views;</code></pre>
<h2 id="column-list">Column List</h2>
<pre class="sourceCode sql"><code class="sourceCode sql">\d {TABLENAME}</code></pre>
<h2 id="batch-file">Batch File</h2>
<pre class="sourceCode sql"><code class="sourceCode sql">\i {FILENAME.sql}</code></pre>
<h2 id="log">Log</h2>
<h4 id="varlibpostgresqldata">/var/lib/postgresql/data</h4>
<pre class="sh"><code>log_statement = &#39;all&#39;</code></pre>
<h1 id="syslog">SYSLOG</h1>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="dt">{COMMAND}</span> <span class="kw">2&gt;&amp;1</span> <span class="kw">|</span> <span class="kw">tee</span> <span class="kw">&gt;(logger</span> -i -t <span class="st">&quot;{TAG}&quot;</span><span class="kw">)</span></code></pre>
<h1 id="load">Load</h1>
<h2 id="cpu">CPU</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yes</span> <span class="kw">&gt;</span> /dev/null</code></pre>
<h2 id="disk">DISK</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">while</span> <span class="kw">true;</span> <span class="kw">do</span> <span class="kw">dd</span> if=/dev/zero of=./tmpfile bs=1M count=1000<span class="kw">;</span> <span class="kw">done</span>; <span class="kw">rm</span> ./tmpfile</code></pre>
<h1 id="mozc">MOZC</h1>
<p>よくわからんが日本語入力できなくなったとき。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/usr/lib/mozc/mozc_renderer</span> <span class="kw">&amp;</span></code></pre>
<h1 id="ufw">ufw</h1>
<h2 id="basics">BASICS</h2>
<p>デフォルトは無効 (ubuntu server 16.10) 。</p>
<p>有効化すると下記の状態となるため、クライアント運用は可能。</p>
<ul>
<li>deny (incoming) --- 入力 NG</li>
<li>allow (outgoing) --- 出力 OK</li>
<li>disabled (routed) --- 転送 NG</li>
</ul>
<h3 id="su">su</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> su -</code></pre>
<h3 id="display-status">Display STATUS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ufw</span> status verbose</code></pre>
<h3 id="enabledisable">ENABLE/DISABLE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ufw</span> enable</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ufw</span> disable</code></pre>
<h1 id="xmonad">XMONAD</h1>
<h2 id="mod-key-change">MOD Key Change</h2>
<h4 id="xmonad-1">.xmonad</h4>
<p>MOD to <a href="#windows-3">WINDOWS</a></p>
<pre class="hs"><code>modMask = myModMask</code></pre>
<h4 id="xmodmap">.Xmodmap</h4>
<pre><code>! [caps]=[Windows] に
clear Lock
keycode  66 = Super_L</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">xmodmap</span> -e <span class="st">&quot;clear Lock&quot;</span>
<span class="kw">xmodmap</span> -e <span class="st">&quot;keycode  66 = Super_L&quot;</span></code></pre>
<h4 id="xinitrc">.xinitrc</h4>
<pre><code>xmodmap $HOME/.Xmodmap</code></pre>
<h2 id="dmenuランチャ">dmenu(ランチャ)</h2>
<h3 id="install-run">install &amp; run</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> apt-get search dmenu</code></pre>
<p>MOD + [P]</p>
<h2 id="設定更新">設定更新</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">xmonad</span> --recompile <span class="kw">&amp;&amp;</span> <span class="kw">xmonad</span> --restart</code></pre>
<h2 id="キーバインド">キーバインド</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">キーバインド</th>
<th style="text-align: center;">働き</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">MOD + SHIFT + RET</td>
<td style="text-align: center;">新しいタイルにターミナルを開く</td>
</tr>
<tr class="even">
<td style="text-align: left;">MOD + [J]/[K]</td>
<td style="text-align: center;">タイルフォーカスを移動</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MOD + SHIFT + [J]/[K]</td>
<td style="text-align: center;">フォーカスタイルと隣接タイルと入れ替える</td>
</tr>
<tr class="even">
<td style="text-align: left;">MOD + [1]/.../[9]</td>
<td style="text-align: center;">仮想デスクトップを切り替える</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MOD + SPC</td>
<td style="text-align: center;">タイルのレイアウト方法を切り替える</td>
</tr>
</tbody>
</table>
<h1 id="ntp">ntp</h1>
<h3 id="同期状況">同期状況</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/usr/sbin/ntpq</span> -p</code></pre>
<pre><code>     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
*196.2.33.10     LOCAL(0)         6 u  503 1024  377    1.656   -0.089   0.048
 196.2.34.10     .INIT.          16 u    - 1024    0    0.000    0.000   0.000
 196.3.33.10     .INIT.          16 u    - 1024    0    0.000    0.000   0.000
 196.3.34.10     .INIT.          16 u    - 1024    0    0.000    0.000   0.000</code></pre>
<h4 id="windows">Windows</h4>
<p>管理者コマンド</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">w32tm</span> /query /peers</code></pre>
<h3 id="強制同期">強制同期</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> service ntpd restart</code></pre>
<h4 id="windows-1">Windows</h4>
<p>管理者コマンド</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">w32tm</span> /resync /nowait</code></pre>
<h3 id="windows-2">Windows</h3>
<p>gpedit.msc で以下を実施</p>
<ul>
<li>ntp クライアントの有効化</li>
<li>ntp サーバの設定(192.168.0.1,0x1)</li>
</ul>
<p>service.msc の Windows Time で以下を実施</p>
<ul>
<li>(再)起動</li>
<li>自動起動</li>
</ul>
<h1 id="centrecom-sh210x210">CentreCOM SH210(x210)</h1>
<h2 id="port-shutdown">PORT SHUTDOWN</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">show</span> interface status
<span class="kw">enable</span>
<span class="kw">configure</span> terminal
<span class="kw">interface</span> port1.0.8
<span class="kw">shutdown</span>
<span class="kw">exit</span>
<span class="kw">exit</span>
<span class="kw">write</span> file
<span class="kw">show</span> interface status</code></pre>
<h2 id="状況表示">状況表示</h2>
<h3 id="running-config">RUNNING-CONFIG</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">enable</span>
<span class="kw">show</span> running-config</code></pre>
<h3 id="mac-address-filter">MAC ADDRESS Filter</h3>
<p>???</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mac</span> address-table static</code></pre>
<h3 id="ポートの状態">ポートの状態</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">show</span> interface status</code></pre>
<p>表示例</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">Port</span>       Name               Status            Vlan Duplex   Speed Type
<span class="kw">port1.0.1</span>                     connected            1 a-full  a-1000 1000BASE-T
<span class="kw">port1.0.2</span>                     connected            1 a-full  a-1000 1000BASE-T
<span class="kw">port1.0.3</span>                     notconnect           1 auto      auto 1000BASE-T
<span class="kw">port1.0.4</span>                     connected            1 a-full  a-1000 1000BASE-T
<span class="kw">port1.0.5</span>                     notconnect           1 auto      auto 1000BASE-T
<span class="kw">port1.0.6</span>                     connected            1 a-full   a-100 1000BASE-T
<span class="kw">port1.0.7</span>                     connected            1 a-full  a-1000 1000BASE-T
<span class="kw">port1.0.8</span>                     connected            1 a-full  a-1000 1000BASE-T
<span class="kw">port1.0.9</span>                     notconnect           1 auto      auto not present</code></pre>
<h2 id="基本設定ip接続可能化">基本設定(IP接続可能化)</h2>
<h3 id="rs-232c-接続">RS-232C 接続</h3>
<p>USB to Serial ケーブルで接続、ドライバをインストールする。</p>
<h3 id="ip-addr-設定">IP ADDR 設定</h3>
<p>各モード(階層)プロンプト</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">&gt;</span>
    <span class="co">#</span>
        <span class="kw">(config)</span>#
            <span class="kw">(config-if)</span>#</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">enable</span>
    <span class="kw">configure</span> terminal
        <span class="kw">interface</span> vlan1
            <span class="kw">ip</span> address 192.168.10.254/24

        <span class="kw">ip</span> route 0.0.0.0/0 192.168.10.1

    <span class="kw">write</span> file</code></pre>
<h3 id="sshsftp-の有効化">SSH(+SFTP) の有効化</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">&gt;</span>
    <span class="co">#</span>
        <span class="kw">(config)</span>#
            <span class="kw">(config-if)</span>#</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">awplus&gt;</span> enable

<span class="kw">awplus</span># configure terminal
<span class="kw">Enter</span> configuration commands, one per line.  End with CNTL/Z.

<span class="kw">awplus</span>(config)#<span class="kw">crypto</span> key generate hostkey dsa

<span class="kw">Generating</span> host key (1024 bits dsa)
<span class="kw">This</span> may take a while. Please wait ... Done

<span class="kw">WARNING</span>: The SSH server must now be enabled with <span class="st">&quot;service ssh&quot;</span>

<span class="kw">awplus</span>(config)# <span class="kw">crypto</span> key generate hostkey rsa

<span class="kw">Generating</span> host key (1024 bits rsa)
<span class="kw">This</span> may take a while. Please wait ... Done

<span class="kw">WARNING</span>: The SSH server must now be enabled with <span class="st">&quot;service ssh&quot;</span>

<span class="kw">awplus</span>(config)# <span class="kw">crypto</span> key generate hostkey rsa1

<span class="kw">Generating</span> host key (1024 bits rsa1)
<span class="kw">This</span> may take a while. Please wait ... Done

<span class="kw">WARNING</span>: The SSH server must now be enabled with <span class="st">&quot;service ssh&quot;</span>

<span class="kw">awplus</span>(config)# <span class="kw">ssh</span> server allow-users *
<span class="kw">awplus</span>(config)# <span class="kw">ssh</span> server session-timeout 3600
<span class="kw">awplus</span>(config)# <span class="kw">service</span> ssh
<span class="kw">awplus</span>(config)# ^<span class="kw">D</span>
<span class="kw">awplus</span># write file

<span class="kw">Building</span> configuration...
[<span class="kw">OK</span>]</code></pre>
<h3 id="ポート速度設定">ポート速度設定</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">awplus&gt;</span> enable
<span class="kw">awplus</span># configure terminal
<span class="kw">awplus</span>(config)# <span class="kw">interface</span> port1.0.1
<span class="kw">awplus</span>(config-if)# <span class="kw">speed</span> 10
<span class="kw">awplus</span>(config-if)# <span class="kw">duplex</span> full</code></pre>
<h1 id="visual-studio-code">Visual Studio Code</h1>
<h2 id="gnome">GNOME</h2>
<p>マルチカーソル(Alt)が効かない場合</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">gsettings</span> set org.gnome.desktop.wm.preferences mouse-button-modifier <span class="st">&quot;&lt;Super&gt;&quot;</span></code></pre>
<h2 id="基本操作">基本操作</h2>
<h3 id="コマンドラインから起動">コマンドラインから起動</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">code</span> .</code></pre>
<h3 id="コマンドパレットの呼出し">コマンドパレットの呼出し</h3>
<table>
<tbody>
<tr class="odd">
<td style="text-align: center;">通常</td>
<td style="text-align: center;">Command + P</td>
</tr>
<tr class="even">
<td style="text-align: center;">拡張</td>
<td style="text-align: center;">Command + Shift + P</td>
</tr>
</tbody>
</table>
<h2 id="エディタ操作">エディタ操作</h2>
<h3 id="カーソル移動">カーソル移動</h3>
<p>to top,bottom: Command + UP, DOWN</p>
<h2 id="英語モード">英語モード</h2>
<ul>
<li>コマンドまで日本語...</li>
<li>メニューバーに(F)...</li>
</ul>
<h3 id="locale.json-を開く">locale.json を開く</h3>
<pre><code>&gt;言語を構成する</code></pre>
<h3 id="内容を以下にする">内容を以下にする</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="st">&quot;locale&quot;</span>:<span class="st">&quot;en-US&quot;</span></code></pre>
<h3 id="再起動する">再起動する</h3>
<h1 id="handsontable">Handsontable</h1>
<h2 id="css">CSS</h2>
<h3 id="shadow">SHADOW</h3>
<h4 id="handsontable-mastersrccsshandsontable.css">handsontable-master/src/css/handsontable.css</h4>
<pre class="sourceCode css"><code class="sourceCode css"><span class="fl">.handsontable</span> <span class="fl">.handsontable</span> table <span class="kw">{</span>
  <span class="kw">-webkit-box-shadow:</span> <span class="dt">1px</span> <span class="dt">2px</span> <span class="dt">5px</span> <span class="dt">rgba(0</span>, <span class="dt">0</span>, <span class="dt">0</span>, <span class="dt">0.4)</span><span class="kw">;</span>
  <span class="kw">box-shadow:</span> <span class="dt">1px</span> <span class="dt">2px</span> <span class="dt">5px</span> <span class="dt">rgba(0</span>, <span class="dt">0</span>, <span class="dt">0</span>, <span class="dt">0.4)</span><span class="kw">;</span>
<span class="kw">}</span></code></pre>
<h1 id="network-manager">NETWORK MANAGER</h1>
<h2 id="connection">CONNECTION</h2>
<h3 id="add">ADD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">nmcli</span> connection add \
      <span class="kw">type</span> ethernet \
      <span class="kw">ifname</span> eno1 \
      <span class="kw">con-name</span> eno1-1 \
      <span class="kw">autoconnect</span> yes \
      <span class="kw">save</span> yes \
      <span class="kw">ip4</span> <span class="st">&quot;10.0.0.10/24&quot;</span> \
      <span class="kw">gw4</span> <span class="st">&quot;0.0.0.0&quot;</span>

<span class="kw">nmcli</span> connection mod ipv4.method manual ipv4.addresses <span class="st">&quot;192.168.0.100/24&quot;</span></code></pre>
<h3 id="del">DEL</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">nmcli</span> connection delete eno1-1</code></pre>
<h1 id="selinux">selinux</h1>
<h2 id="off">OFF</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> <span class="st">&#39;SELINUX=disabled&#39;</span> <span class="kw">&gt;</span> /etc/selinux/config</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">reboot</span></code></pre>
<h1 id="ll-basics">LL BASICS</h1>
<h2 id="repl">REPL</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">PYTHON</th>
<th style="text-align: left;">RUBY</th>
<th style="text-align: left;">JAVASCRIPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">python</td>
<td style="text-align: left;">irb</td>
<td style="text-align: left;">node</td>
</tr>
</tbody>
</table>
<h2 id="lib">LIB</h2>
<h3 id="include">INCLUDE</h3>
<h4 id="python">python</h4>
<pre class="sourceCode python"><code class="sourceCode python">sys.path.append(os.path.join(os.path.dirname(<span class="ot">__file__</span>),<span class="st">&#39;</span><span class="ot">{{</span><span class="st">LIBDIR</span><span class="ot">}}</span><span class="st">&#39;</span>))</code></pre>
<h2 id="listarray">LIST(ARRAY)</h2>
<h3 id="join">JOIN</h3>
<h4 id="python-1">PYTHON</h4>
<pre class="sourceCode python"><code class="sourceCode python"><span class="co">&#39;&#39;</span>.join([<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>])  <span class="co"># ab</span>
<span class="co">&#39;,&#39;</span>.join([<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>]) <span class="co"># a,b</span></code></pre>
<h4 id="ruby">RUBY</h4>
<pre class="sourceCode ruby"><code class="sourceCode ruby">[<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>].join(<span class="st">&#39;&#39;</span>)  <span class="co"># ab</span>
[<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>].join(<span class="st">&#39;,&#39;</span>) <span class="co"># a,b</span></code></pre>
<h4 id="javascript">JAVASCRIPT</h4>
<pre class="sourceCode javascript"><code class="sourceCode javascript">[<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>].<span class="fu">join</span>(<span class="st">&#39;&#39;</span>)  <span class="co">// ab</span>
[<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>].<span class="fu">join</span>(<span class="st">&#39;,&#39;</span>) <span class="co">// a,b</span></code></pre>
<h3 id="reverse">REVERSE</h3>
<h4 id="python-2">PYTHON</h4>
<pre class="sourceCode python"><code class="sourceCode python">[<span class="st">&#39;a&#39;</span>,<span class="st">&#39;b&#39;</span>][::-<span class="dv">1</span>] <span class="co"># [&#39;b&#39;, &#39;a&#39;]</span></code></pre>
<h2 id="date">DATE</h2>
<h3 id="serialint-to-str">SERIAL(INT) to STR</h3>
<h4 id="python-3">PYTHON</h4>
<pre class="sourceCode python"><code class="sourceCode python"><span class="ch">import</span> time
time.strftime(<span class="st">&quot;%Y-%m-</span><span class="ot">%d</span><span class="st"> %H:%M:%S&quot;</span>,time.localtime(<span class="dv">963920001</span>)) <span class="co"># &#39;2000-07-18 12:33:21&#39;</span>
time.strftime(<span class="st">&quot;%Y-%m-</span><span class="ot">%d</span><span class="st"> %H:%M:%S&quot;</span>,time.gmtime(<span class="dv">963920001</span>))    <span class="co"># &#39;2000-07-18 11:33:21&#39;</span></code></pre>
<h1 id="bash">BASH</h1>
<h2 id="str-cut">STR CUT</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">a=</span>ABC
<span class="kw">echo</span> <span class="ot">${a:1:1}</span> <span class="co"># B</span></code></pre>
<h2 id="history">history</h2>
<h3 id="add-time">add time</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">HISTTIMEFORMAT=</span><span class="st">&#39;%Y-%m-%d %T &#39;</span></code></pre>
<h2 id="brace-expansion">brace expansion</h2>
<h3 id="add-seq">add seq</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> A-<span class="dt">{{1..3},5}</span>  <span class="co"># A-1 A-2 A-3 A-5</span>
<span class="kw">echo</span> A-<span class="dt">{a..c}</span>      <span class="co"># A-a A-b A-c</span></code></pre>
<h3 id="cp-date">cp + date</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cp</span> filename{,<span class="kw">`date</span> +<span class="st">&#39;__%Y-%m-%d_%H-%M-%S&#39;</span><span class="kw">`</span>}<span class="kw">.tgz</span>
<span class="co"># cp filename.tgz filename__2015-01-23_23-05-58.tgz</span></code></pre>
<h1 id="virtual-box">VIRTUAL BOX</h1>
<h2 id="disk-1">DISK</h2>
<h3 id="create-shareable">create shareable</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vboxmanage</span> createhd --size 1000 --variant Fixed --filename disk1.vdi
<span class="kw">vboxmanage</span> modifyhd --type shareable disk1.vdi</code></pre>
<h2 id="serial-port">Serial Port</h2>
<h3 id="linux-host-win-guest">Linux Host &amp; Win Guest</h3>
<h4 id="linuxhost">Linux(Host)</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">su</span>
<span class="kw">chmod</span> 666 /dev/ttyS0
<span class="kw">ll</span> /dev/ttyS0
<span class="kw">crw-rw-rw-</span> 1 root dialout 4, 64  1月 21 20:12 2015 ttyS0</code></pre>
<p>この設定は再起動時にリセットされる。 恒久的に使う場合は、/etc/udev/... に、...</p>
<h4 id="winvbox-guest-settingserial-port">Win(VBox Guest Setting:Serial Port)</h4>
<ul>
<li>[ON] &quot;Serial Port Enable&quot;</li>
<li>COM1</li>
<li>Host Device</li>
<li><a href="#off">OFF</a> &quot;Make PIPE&quot;</li>
<li>/dev/ttyS0</li>
</ul>
<h1 id="allied-telesis-centrecom">Allied Telesis CentreCOM</h1>
<h2 id="conn-to-serial-port">Conn to Serial Port</h2>
<h3 id="serial-port-settings">Serial Port Settings</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">sets</th>
<th style="text-align: left;">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bit/sec</td>
<td style="text-align: left;">9600</td>
</tr>
<tr class="even">
<td style="text-align: left;">data bit</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">parity</td>
<td style="text-align: left;">none</td>
</tr>
<tr class="even">
<td style="text-align: left;">stop bit</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flow cont</td>
<td style="text-align: left;">none</td>
</tr>
</tbody>
</table>
<h3 id="userpassword">User/Password</h3>
<p>manager/friend</p>
<h3 id="add-ip">ADD IP</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">add</span> ip IPADDRESS=202.46.51.254 MASK=255.255.255.0 GATEWAY=0.0.0.0</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">show</span> ip

<span class="kw">IP</span> Address Information
<span class="kw">--------------------------------------------</span>
 <span class="kw">Type</span> ....................... Static
 <span class="kw">Interface</span> .................. default
 <span class="kw">IP</span> address ................. 202.46.51.254
 <span class="kw">Subnet</span> mask ................ 255.255.255.0
 <span class="kw">Gateway</span> address ............ 0.0.0.0
 <span class="kw">MTU</span> ........................ 1500
 <span class="kw">DHCP</span> Client ................ Disabled
 <span class="kw">Directed</span> broadcast ......... No
<span class="kw">--------------------------------------------</span></code></pre>
<h3 id="enable-http-server">ENable Http server</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ENable</span> Http server</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">SHow</span> Http server</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">HTTP</span> Server Module Configuration:
<span class="kw">--------------------------------------</span>
<span class="kw">Status</span>                     : Enabled
<span class="kw">HTTP</span> Server Listen Port    : 80
<span class="kw">--------------------------------------</span></code></pre>
<h3 id="enable-telnet-server">ENable Telnet server</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ENable</span> TELnet server</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">SHow</span> TElnet</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">TELNET</span> Module Configuration:
<span class="kw">--------------------------------------</span>
 <span class="kw">TELNET</span> Server             : Enabled
 <span class="kw">TELNET</span> Server Listen Port : 23
 <span class="kw">TELNET</span> Connection Limit   : 4
<span class="kw">--------------------------------------</span></code></pre>
<h1 id="fdisk">FDISK</h1>
<h2 id="list-all">LIST ALL</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">fdisk</span> -l</code></pre>
<h2 id="part">PART</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">fdisk</span> /dev/sdb</code></pre>
<ul>
<li>p: 領域テーブルを表示する</li>
<li>n: 新規</li>
<li>p: 基本パーティション</li>
<li>1: パーティション番号</li>
<li>RET,RET</li>
<li>p: 領域テーブルを表示する</li>
<li>w: テーブルをディスクに書き込み、終了する</li>
</ul>
<h2 id="formatmake-filesystem">FORMAT(make filesystem)</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mke2fs</span> /dev/sdb1</code></pre>
<h1 id="dd">DD</h1>
<h2 id="make-dummyfile">MAKE DUMMYFILE</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> if=/dev/zero of=./dummyfile bs=100M count=1
<span class="kw">ls</span> -l ./dummyfile</code></pre>
<h1 id="systemd">SYSTEMD</h1>
<h2 id="service">SERVICE</h2>
<h3 id="files">FILES</h3>
<h4 id="usrlibsystemdcp.path">/usr/lib/systemd/cp.path</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">[<span class="kw">Unit</span>]
<span class="ot">Description=</span>systemdtest

[<span class="kw">Path</span>]
<span class="ot">PathChanged=</span>/home/vagrant/target1.txt

[<span class="kw">Install</span>]
<span class="ot">WantedBy=</span>multi-user.target</code></pre>
<h4 id="usrlibsystemdcp.service">/usr/lib/systemd/cp.service</h4>
<p>下の2行がないと、enableでなんかゆわれる</p>
<pre class="sourceCode bash"><code class="sourceCode bash">[<span class="kw">Unit</span>]
<span class="ot">Description=</span>Copy <span class="kw">file</span>

[<span class="kw">Service</span>]
<span class="ot">Type=</span>oneshot
<span class="ot">ExecStart=</span>/usr/bin/cp <span class="kw">-f</span> /home/vagrant/target1.txt /home/vagrant/target2.txt

[<span class="kw">Install</span>]
<span class="ot">WantedBy=</span>multi-user.target</code></pre>
<h3 id="install-3">INSTALL</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> ln -s /etc/systemd/system/cp.path    /etc/systemd/system/multi-user.target.wants/
<span class="kw">sudo</span> ln -s /etc/systemd/system/cp.service /etc/systemd/system/multi-user.target.wants/</code></pre>
<h3 id="enable">ENABLE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> systemctl enable cp.path
<span class="kw">sudo</span> systemctl enable cp.service</code></pre>
<h3 id="start">START</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> systemctl start cp.path
<span class="kw">sudo</span> systemctl start cp.service</code></pre>
<h3 id="status">STATUS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">systemctl</span> status cp.path
<span class="kw">systemctl</span> status cp.service</code></pre>
<h2 id="reload">RELOAD</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> systemctl --system daemon-reload</code></pre>
<h1 id="iconv">ICONV</h1>
<ul>
<li>Windows SJIS は、 SHIFT_JISX0213 とすべし。</li>
<li>Windows UTF-8 は BOM 付き。</li>
<li>-c でエラーストップしなくなる。</li>
</ul>
<h2 id="文字コード一覧表示">文字コード一覧表示</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">iconv</span> -l</code></pre>
<h2 id="euc---utf-8">EUC -&gt; UTF-8</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">iconv</span> -f EUC-JP -t UTF-8 FILE -o FILE.utf8</code></pre>
<h2 id="sjis---utf-8">SJIS -&gt; UTF-8</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">iconv</span> -f SHIFT_JISX0213 -t UTF-8 FILE -o FILE.utf8</code></pre>
<h2 id="bom-delete">BOM delete</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">tail</span> --bytes=+4 index.unix.txt</code></pre>
<h2 id="一括処理">一括処理</h2>
<h3 id="カレントディレクトリ以下">カレントディレクトリ以下</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">find</span> -type f <span class="kw">|</span> <span class="kw">xargs</span> file <span class="kw">|</span> <span class="kw">grep</span> <span class="st">&quot;:.*text&quot;</span> <span class="kw">|</span> <span class="kw">cut</span> -d : -f1 <span class="kw">|</span> <span class="kw">xargs</span> -t -I<span class="dt">{}</span> iconv -f EUC-JP -t UTF-8 <span class="dt">{}</span> -o <span class="dt">{}</span>.utf8</code></pre>
<h1 id="awk">AWK</h1>
<h2 id="col-complete">COL COMPLETE</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">{</span>
  <span class="kw">echo</span> <span class="st">&#39;100 abc&#39;</span>
  <span class="kw">echo</span> <span class="st">&#39;bcd&#39;</span>
  <span class="kw">echo</span> <span class="st">&#39;200 def&#39;</span>
<span class="kw">}</span> <span class="kw">&gt;</span> <span class="kw">file.txt</span>
<span class="kw">cat</span> file.txt
<span class="kw">cat</span> file.txt <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;m=match($0,/^[0-9]+\ /){print $0;n=substr($0,RSTART,RLENGTH)};!m{print n $0}&#39;</span>
<span class="kw">rm</span> file.txt</code></pre>
<h1 id="tar-1">TAR</h1>
<h2 id="ls">LS</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">tar</span> zft AAA.tgz</code></pre>
<h2 id="matome">MATOME</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">for</span> <span class="kw">f</span> in ./*.tgz <span class="kw">;</span> <span class="kw">do</span> <span class="kw">tar</span> zxvf <span class="ot">$f</span> <span class="kw">;</span> <span class="kw">done</span></code></pre>
<h1 id="netstat">NETSTAT</h1>
<h2 id="option">OPTION</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">netstat</span>  --inet -aenop</code></pre>
<ul>
<li>--inet: inet protocol</li>
<li>a: all status</li>
<li>e: extend(User&amp;Inode)</li>
<li>n: numeric</li>
<li>o: timers</li>
<li>p: pid,program</li>
</ul>
<h2 id="state">STATE</h2>
<h3 id="from-man">from man</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">NAME</th>
<th style="text-align: left;">WHAT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ESTABLISHED</td>
<td style="text-align: left;">ソケットは確立した接続状態にある。</td>
</tr>
<tr class="even">
<td style="text-align: left;">SYN_SENT</td>
<td style="text-align: left;">ソケットは接続を確立しようと試みている。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SYN_RECV</td>
<td style="text-align: left;">接続要求をネットワークから受信している。</td>
</tr>
<tr class="even">
<td style="text-align: left;">FIN_WAIT1</td>
<td style="text-align: left;">ソケットはクローズされており、接続は切断中である。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FIN_WAIT2</td>
<td style="text-align: left;">接続はクローズされ、ソケットはリモート側からの切断を待っている。</td>
</tr>
<tr class="even">
<td style="text-align: left;">TIME_WAIT</td>
<td style="text-align: left;">ソケットは、クローズ後にリモートからの切断が再送されるのを待っている。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CLOSED</td>
<td style="text-align: left;">ソケットは使用されていない。</td>
</tr>
<tr class="even">
<td style="text-align: left;">CLOSE_WAIT</td>
<td style="text-align: left;">リモート側は既に切断され、ソケットがクローズされるのを待っている。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LAST_ACK</td>
<td style="text-align: left;">リモート側は既に切断され、ソケットもクローズされている。 確認 (acknowledgement) を待っている。</td>
</tr>
<tr class="even">
<td style="text-align: left;">LISTEN</td>
<td style="text-align: left;">ソケットは接続待ち (listen) である。このようなソケットは、--listening (-l) または --all (-a) オプションを指定しない限り、出力には含まれない。</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CLOSING</td>
<td style="text-align: left;">両方のソケットが切断されているが、まだ全てのデータが送られていない。</td>
</tr>
<tr class="even">
<td style="text-align: left;">UNKNOWN</td>
<td style="text-align: left;">ソケットの状態は不明である。</td>
</tr>
</tbody>
</table>
<h1 id="mac-os-x">Mac OS X</h1>
<h2 id="network">NETWORK</h2>
<h3 id="listen-port">LISTEN PORT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">lsof</span> -nP -iTCP -sTCP:LISTEN</code></pre>
<h1 id="yeoman">YEOMAN</h1>
<p>homebrew で入れてる場合は sudo 無し</p>
<p>can not load module は npm update -g</p>
<p>パーミッションぽいのは chmod -R <code>whoami</code> ~/.npm</p>
<h2 id="setup">setup</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">npm</span> install -g yo grunt grunt-cli bower</code></pre>
<h2 id="generator">generator</h2>
<h3 id="search">search</h3>
<p><a href="http://yeoman.io/generators/">http://yeoman.io/generators/</a></p>
<h3 id="install-4">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">npm</span> install -g generator-webapp</code></pre>
<h2 id="generate-webapp">generate WEBAPP</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mkdir</span> WEBAPPDIR <span class="kw">&amp;&amp;</span> <span class="kw">cd</span> WEBAPPDIR
<span class="kw">yo</span> webapp</code></pre>
<h2 id="exec-webapp">exec WEBAPP</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grunt</span> server</code></pre>
<h1 id="shell-script">SHELL SCRIPT</h1>
<h2 id="arg">ARG</h2>
<h3 id="arg-check">ARG CHECK</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/bin/env sh</span>
<span class="kw">if [</span> <span class="ot">$#</span> <span class="ot">-ne</span> 2<span class="kw"> ]</span>; <span class="kw">then</span>
    <span class="kw">echo</span> usage: <span class="kw">`basename</span> <span class="ot">${0}</span><span class="kw">`</span> YYYY MO <span class="kw">&gt;&amp;2</span>
    <span class="kw">exit</span> 1
<span class="kw">fi</span>
<span class="ot">ARG1=${1}</span>
<span class="ot">ARG2=${2}</span></code></pre>
<h2 id="time">TIME</h2>
<h3 id="uptime-for-scriptbash">UPTIME for SCRIPT(bash)</h3>
<p>bash にはあらかじめ SECONDS ていう環境変数がある。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/bin/env bash</span>
<span class="ot">SECONDS=</span>0
<span class="kw">sleep</span> 3
<span class="kw">echo</span> <span class="ot">$SECONDS</span></code></pre>
<h2 id="quoteation">QUOTEATION</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">AAA=</span>abc
<span class="kw">echo</span> <span class="st">&quot;</span><span class="ot">${AAA}</span><span class="st">&quot;</span> <span class="co"># 展開される</span>
<span class="kw">echo</span> <span class="st">&#39;${AAA}&#39;</span> <span class="co"># 展開されぬ</span></code></pre>
<h2 id="for">FOR</h2>
<h3 id="foreach">foreach</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">for</span> <span class="kw">num</span> in one two three<span class="kw">;</span> <span class="kw">do</span>
    <span class="kw">echo</span> <span class="ot">${num}</span>
<span class="kw">done</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">nums=</span><span class="st">&quot;one two three&quot;</span>
<span class="kw">for</span> <span class="kw">num</span> in <span class="ot">${nums}</span><span class="kw">;</span> <span class="kw">do</span>
    <span class="kw">echo</span> <span class="ot">${num}</span>
<span class="kw">done</span></code></pre>
<h3 id="range1..10">range(1..10)</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">for</span> <span class="kw">x</span> in <span class="kw">`seq</span> 1 10<span class="kw">`;</span> <span class="kw">do</span>
    <span class="kw">echo</span> <span class="ot">${x}</span>
<span class="kw">done</span></code></pre>
<h2 id="if">IF</h2>
<h3 id="file-not-exists">FILE NOT EXISTS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">if [</span> <span class="ot">!</span> <span class="ot">-e</span> FILE<span class="kw"> ]</span>; <span class="kw">then</span>
   <span class="kw">echo</span> <span class="st">&#39;file not found&#39;</span>
<span class="kw">fi</span></code></pre>
<h3 id="string">STRING</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">a=</span>aaa
<span class="kw">[</span> <span class="ot">$a</span> <span class="ot">==</span> <span class="st">&#39;aaa&#39;</span><span class="kw"> ]</span> ; <span class="kw">echo</span> <span class="ot">$?</span>  <span class="co"># 0</span>
<span class="kw">[</span> <span class="ot">$a</span> <span class="ot">!=</span> <span class="st">&#39;aaa&#39;</span><span class="kw"> ]</span> ; <span class="kw">echo</span> <span class="ot">$?</span>  <span class="co"># 1</span></code></pre>
<h1 id="elastic-search">ELASTIC SEARCH</h1>
<script>window.addEventListener('load', function () {
new Vue({el:'#vesearch',data:{label:'',
host:'localhost:9200',
index:'myindex',
type:'mytype'
}});})</script>

<div id="vesearch">
<form class="form-horizontal">
<varin label="SERVICE HOST:PORT" v-model="host"></varin> <varin label="INDEX NAME"        v-model="index"></varin> <varin label="TYPE NAME"         v-model="type"></varin>
</form>


<h2 id="setup-1">Setup</h2>
<h4 id="ubuntu">ubuntu</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sysctl</span> vm.max_map_count
<span class="kw">sudo</span> sysctl -w vm.max_map_count=262144
<span class="kw">sysctl</span> vm.max_map_count</code></pre>
<h2 id="metricbeat">Metricbeat</h2>
<h3 id="start-1">Start</h3>
<h4 id="ubuntu-1">ubuntu</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> ./metricbeat -e -c metricbeat.yml</code></pre>
<h4 id="macos">macOS</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> ./metricbeat -e -c metricbeat.yml -d <span class="st">&quot;publish&quot;</span></code></pre>
<h3 id="template">Template?</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XPUT <span class="st">&#39;http://{{ host }}/_template/metricbeat&#39;</span> -d@/etc/metricbeat/metricbeat.template.json</code></pre>
<h3 id="kibana">Kibana</h3>
<h4 id="discover-index">Discover Index</h4>
<pre><code>metricbeat-*</code></pre>
<h4 id="create-dushbord">Create Dushbord</h4>
<h4 id="tar.gz">tar.gz</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">./scripts/import_dashboards</span></code></pre>
<h4 id="deb">deb</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/usr/share/metricbeat/scripts</span></code></pre>
<h2 id="index">INDEX</h2>
<h3 id="list-3">List</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XGET {{ host }}<span class="kw">/_aliases?pretty</span></code></pre>
<h3 id="create">create</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XPUT <span class="st">&#39;http://{{ host }}/{{ index }}&#39;</span></code></pre>
<h3 id="look">look</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XGET <span class="st">&#39;http://{{ host }}/{{ index }}?pretty=true&#39;</span></code></pre>
<h3 id="delete">delete</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XDELETE <span class="st">&#39;http://{{ host }}/{{ index }}&#39;</span></code></pre>
<h2 id="type">TYPE</h2>
<h3 id="create-1">create</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XPUT <span class="st">&#39;http://{{ host }}/{{ index }}/{{ type }}/_mapping&#39;</span>  -d @{{ type }}<span class="kw">.json</span></code></pre>
<h4 id="type-.json">{{ type }}.json</h4>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;{{ type }}&quot;</span>:{
        <span class="dt">&quot;properties&quot;</span>:{
            <span class="dt">&quot;@timestamp&quot;</span>:{
                <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;date&quot;</span>
                ,<span class="dt">&quot;format&quot;</span>:<span class="st">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>
            }
            ,<span class="dt">&quot;srv&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;pid&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;user&quot;</span>    :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;pr&quot;</span>      :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;ni&quot;</span>      :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;virt&quot;</span>    :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;res&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;shr&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;s&quot;</span>       :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;cpu&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;float&quot;</span>}
            ,<span class="dt">&quot;mem&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;float&quot;</span>}
            ,<span class="dt">&quot;times&quot;</span>   :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>}
            ,<span class="dt">&quot;cmd0&quot;</span>    :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;cmd&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
        }
    }
}</code></pre>
<h3 id="look-1">look</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XGET <span class="st">&#39;http://{{ host }}/{{ index }}/{{ type }}/_mapping?pretty=true&#39;</span></code></pre>
<h3 id="delete-1">delete</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XGET <span class="st">&#39;http://{{ host }}/{{ index }}/{{ type }}&#39;</span></code></pre>
<h2 id="bulk-import">BULK IMPORT</h2>
<h4 id="importdatafile.json"><span class="citation" data-cites="IMPORTDATAFILE.json">@IMPORTDATAFILE.json</span></h4>
<pre class="sourceCode json"><code class="sourceCode json">{<span class="dt">&quot;index&quot;</span>:{}}
{<span class="dt">&quot;@timestamp&quot;</span>:<span class="st">&quot;2014-11-01 00:01:01&quot;</span>,<span class="dt">&quot;srv&quot;</span>:<span class="st">&quot;srv_A&quot;</span>,<span class="dt">&quot;pid&quot;</span>:<span class="dv">2884</span>,<span class="dt">&quot;user&quot;</span>:<span class="st">&quot;oracle&quot;</span>,<span class="dt">&quot;pr&quot;</span>:<span class="st">&quot;15&quot;</span>,<span class="dt">&quot;ni&quot;</span>:<span class="st">&quot;0&quot;</span>,<span class="dt">&quot;virt&quot;</span>:<span class="dv">1589000</span>,<span class="dt">&quot;res&quot;</span>:<span class="dv">496000</span>,<span class="dt">&quot;shr&quot;</span>:<span class="dv">489000</span>,<span class="dt">&quot;s&quot;</span>:<span class="st">&quot;S&quot;</span>,<span class="dt">&quot;cpu&quot;</span>:<span class="fl">15.4</span>,<span class="dt">&quot;mem&quot;</span>:<span class="fl">10.0</span>,<span class="dt">&quot;times&quot;</span>:<span class="st">&quot;0:03.45&quot;</span>,<span class="dt">&quot;cmd0&quot;</span>:<span class="st">&quot;oracle&quot;</span>,<span class="dt">&quot;cmd&quot;</span>:<span class="st">&quot;oracle (LOCAL=NO)&quot;</span>}
{<span class="dt">&quot;index&quot;</span>:{}}
{<span class="dt">&quot;@timestamp&quot;</span>:<span class="st">&quot;2014-11-01 00:01:01&quot;</span>,<span class="dt">&quot;srv&quot;</span>:<span class="st">&quot;srv_A&quot;</span>,<span class="dt">&quot;pid&quot;</span>:<span class="dv">10680</span>,<span class="dt">&quot;user&quot;</span>:<span class="st">&quot;oracle&quot;</span>,<span class="dt">&quot;pr&quot;</span>:<span class="st">&quot;16&quot;</span>,<span class="dt">&quot;ni&quot;</span>:<span class="st">&quot;0&quot;</span>,<span class="dt">&quot;virt&quot;</span>:<span class="dv">1603000</span>,<span class="dt">&quot;res&quot;</span>:<span class="dv">1000000</span>,<span class="dt">&quot;shr&quot;</span>:<span class="dv">1000000</span>,<span class="dt">&quot;s&quot;</span>:<span class="st">&quot;S&quot;</span>,<span class="dt">&quot;cpu&quot;</span>:<span class="fl">3.9</span>,<span class="dt">&quot;mem&quot;</span>:<span class="fl">27.4</span>,<span class="dt">&quot;times&quot;</span>:<span class="st">&quot;400:19.45&quot;</span>,<span class="dt">&quot;cmd0&quot;</span>:<span class="st">&quot;ora_j000&quot;</span>,<span class="dt">&quot;cmd&quot;</span>:<span class="st">&quot;ora_j000&quot;</span>}
{<span class="dt">&quot;index&quot;</span>:{}}
{<span class="dt">&quot;@timestamp&quot;</span>:<span class="st">&quot;2014-11-01 00:01:01&quot;</span>,<span class="dt">&quot;srv&quot;</span>:<span class="st">&quot;srv_A&quot;</span>,<span class="dt">&quot;pid&quot;</span>:<span class="dv">4645</span>,<span class="dt">&quot;user&quot;</span>:<span class="st">&quot;root&quot;</span>,<span class="dt">&quot;pr&quot;</span>:<span class="st">&quot;15&quot;</span>,<span class="dt">&quot;ni&quot;</span>:<span class="st">&quot;0&quot;</span>,<span class="dt">&quot;virt&quot;</span>:<span class="dv">6276</span>,<span class="dt">&quot;res&quot;</span>:<span class="dv">948</span>,<span class="dt">&quot;shr&quot;</span>:<span class="dv">668</span>,<span class="dt">&quot;s&quot;</span>:<span class="st">&quot;R&quot;</span>,<span class="dt">&quot;cpu&quot;</span>:<span class="fl">1.9</span>,<span class="dt">&quot;mem&quot;</span>:<span class="fl">0.0</span>,<span class="dt">&quot;times&quot;</span>:<span class="st">&quot;0:00.01&quot;</span>,<span class="dt">&quot;cmd0&quot;</span>:<span class="st">&quot;top&quot;</span>,<span class="dt">&quot;cmd&quot;</span>:<span class="st">&quot;top -b -n 1 -c&quot;</span>}</code></pre>
<h3 id="normal-size">NORMAL SIZE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XPOST <span class="st">&#39;http://{{ host }}/{{ index }}/{{ type }}/_bulk&#39;</span> --data-binary @IMPORTDATAFILE.json  <span class="kw">&gt;</span> /dev/null</code></pre>
<h3 id="laerge-sizesplit">LAERGE SIZE(SPLIT)</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">split</span> IMPORTDATAFILE.json -l 100000
<span class="kw">time</span> for f in x??<span class="kw">;</span> <span class="kw">do</span> <span class="kw">curl</span> -XPOST <span class="st">&#39;http://{{ host }}/{{ index }}/{{ type }}/_bulk&#39;</span> --data-binary @<span class="ot">$f</span> <span class="kw">&gt;</span> /dev/null<span class="kw">;</span> <span class="kw">done</span>
<span class="kw">rm</span> -f x??</code></pre>
<h2 id="search-1">SEARCH</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> -XGET <span class="st">&#39;http://{{ host }}/{{ index }}/{{ type }}/_search&#39;</span></code></pre>
</div>



<h1 id="bz2">BZ2</h1>
<h3 id="extract">EXTRACT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">tar</span> jxvf FILE.tar.bz2</code></pre>
<h1 id="node">NODE</h1>
<h2 id="npm">npm</h2>
<h3 id="order-package">order PACKAGE</h3>
<h4 id="package.json">package.json</h4>
<p>dependencies に追加していく</p>
<pre class="sourceCode json"><code class="sourceCode json">{
  <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;tw&quot;</span>,
  <span class="dt">&quot;version&quot;</span>: <span class="st">&quot;1.0.0&quot;</span>,
  <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;&quot;</span>,
  <span class="dt">&quot;main&quot;</span>: <span class="st">&quot;index.js&quot;</span>,
  <span class="dt">&quot;scripts&quot;</span>: {
    <span class="dt">&quot;test&quot;</span>: <span class="st">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  },
  <span class="dt">&quot;author&quot;</span>: <span class="st">&quot;&quot;</span>,
  <span class="dt">&quot;license&quot;</span>: <span class="st">&quot;ISC&quot;</span>,
  <span class="dt">&quot;dependencies&quot;</span>: {
    <span class="dt">&quot;ntwitter&quot;</span>: <span class="st">&quot;~0.5.0&quot;</span>
  }
}</code></pre>
<h3 id="package-install">PACKAGE INSTALL</h3>
<p>bundler と違ってデフォルトでローカル ./node_modules/ にダウンロードされる</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">npm</span> install</code></pre>
<h1 id="cassandra">CASSANDRA</h1>
<h2 id="cqlsh">CQLSH</h2>
<h3 id="exec-cql-file">exec CQL file</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cqlsh</span> HOSTNAME -f FILENAME</code></pre>
<h3 id="cluster-status">CLUSTER STATUS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">nodetool</span> status KEYSPACE</code></pre>
<h1 id="tcpdump">TCPDUMP</h1>
<h2 id="on-screen">on Screen</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> tcpdump -Xs 256 -n -i eth1 dst port 50012</code></pre>
<h2 id="to-file">to File</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> tcpdump -G 3600 -w ./eno1_YYYYMM%d_%HMISS.pcap -Z root -z gzip -i eth0</code></pre>
<p>-G [sec] が無いと、ファイル名の %. が動かない</p>
<h1 id="scheme">SCHEME</h1>
<h2 id="list-4">LIST</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">OPE</th>
<th style="text-align: center;">内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(car LIST)</td>
<td style="text-align: center;">リストの先頭要素を返す</td>
</tr>
<tr class="even">
<td style="text-align: left;">(cdr LIST)</td>
<td style="text-align: center;">リストの先頭要素を除いた要素を返す</td>
</tr>
</tbody>
</table>
<h1 id="closure">CLOSURE</h1>
<h2 id="what">What</h2>
<p>関数そのものに値を保持する仕組み。これが無いと大域汚染を伴うクラスやグローバル変数を使うことになる。この大域汚染は、特に複数のサードパーティライブラリを組み合わせる際に問題となる。</p>
<p>なので、データセットのダーティフラグとかしょうもない用事には CLOSURE を使う。</p>
<h3 id="examplejavascript">example:javascript</h3>
<pre class="sourceCode javascript"><code class="sourceCode javascript">#!<span class="ot">/bin/env</span> node

<span class="kw">function</span> <span class="fu">outer</span>(n) {
    <span class="kw">var</span> x = n;
    <span class="kw">return</span> <span class="kw">function</span>() {
        <span class="ot">console</span>.<span class="fu">log</span>(x);
        x = x + <span class="dv">1</span>;
    };
}

<span class="kw">var</span> f1 = <span class="fu">outer</span>(<span class="dv">1</span>);
<span class="kw">var</span> f2 = <span class="fu">outer</span>(<span class="dv">11</span>);

<span class="fu">f1</span>();
<span class="fu">f1</span>();
<span class="ot">console</span>.<span class="fu">log</span>(<span class="st">&quot;---&quot;</span>)
<span class="fu">f2</span>();
<span class="fu">f2</span>();
<span class="ot">console</span>.<span class="fu">log</span>(<span class="st">&quot;---&quot;</span>)
<span class="fu">f1</span>();
<span class="fu">f1</span>();</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">node</span> ./closure.js
<span class="kw">1</span>
<span class="kw">2</span>
<span class="kw">---</span>
<span class="kw">11</span>
<span class="kw">12</span>
<span class="kw">---</span>
<span class="kw">3</span>
<span class="kw">4</span></code></pre>
<h1 id="python-4">PYTHON</h1>
<h2 id="httpd">HTTPD</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">python</span> -m SimpleHTTPServer 12345</code></pre>
<h2 id="date-time">DATE &amp; TIME</h2>
<h3 id="what-time-now">what time now</h3>
<pre class="sourceCode python"><code class="sourceCode python"><span class="ch">import</span> datetime
datetime.datetime.today().strftime(<span class="st">&#39;%Y-%m-</span><span class="ot">%d</span><span class="st">_%H-%M-%S&#39;</span>)</code></pre>
<h1 id="crudsqlrest">CRUD/SQL/REST</h1>
<h2 id="basics-1">BASICs</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">OPE</th>
<th style="text-align: left;">CRUD</th>
<th style="text-align: left;">SQL</th>
<th style="text-align: left;">REST</th>
<th style="text-align: left;">$http</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">追加</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">insert</td>
<td style="text-align: left;">post</td>
<td style="text-align: left;">BODY</td>
</tr>
<tr class="even">
<td style="text-align: left;">取得</td>
<td style="text-align: left;">Read</td>
<td style="text-align: left;">select</td>
<td style="text-align: left;">get</td>
<td style="text-align: left;">URI</td>
</tr>
<tr class="odd">
<td style="text-align: left;">更新</td>
<td style="text-align: left;">Update</td>
<td style="text-align: left;">update</td>
<td style="text-align: left;">put</td>
<td style="text-align: left;">BODY</td>
</tr>
<tr class="even">
<td style="text-align: left;">削除</td>
<td style="text-align: left;">Delete</td>
<td style="text-align: left;">delete</td>
<td style="text-align: left;">delete</td>
<td style="text-align: left;">URI</td>
</tr>
</tbody>
</table>
<h1 id="nkf">NKF</h1>
<h3 id="改行変換">改行変換</h3>
<h4 id="from-win">from Win</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">perl</span> -pe <span class="st">&#39;s/\r//&#39;</span> Win.txt <span class="kw">&gt;</span> UNIX.txt</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">nkf</span> -Lu AAA.txt</code></pre>
<h4 id="from-unix">from UNIX</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">perl</span> -pe <span class="st">&#39;s/\n/\r\n/&#39;</span> UNIX.txt <span class="kw">&gt;</span> Win.txt</code></pre>
<h1 id="wget">WGET</h1>
<h2 id="ftp">FTP</h2>
<h3 id="ftp-get">FTP GET</h3>
<script>window.addEventListener('load', function () {
new Vue({el:'#vwgetftp',data:{label:''
,ftpserver : 'ftpserver'
,ftpuser   : 'user'
,ftppass   : 'passwd'
,fname     : 'getfilename'
}});})</script>

<div id="vwgetftp">
<form class="form-horizontal">
<varin label="ftp server" v-model="ftpserver"></varin> <varin label="ftp user" v-model="ftpuser"></varin> <varin label="ftp pass" v-model="ftppass"></varin> <varin label="file name" v-model="fname"></varin>
</form>


<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">wget</span> --ftp-user=<span class="dt">{{ftpuser}}</span> --ftp-password=<span class="dt">{{ftppass}}</span> ftp://<span class="dt">{{ftpserver}}/{{fname}}</span></code></pre>
</div>

<h1 id="sqlite3">SQLITE3</h1>
<script>window.addEventListener('load', function () {
new Vue({el:'#vsqlite',data:{label:''
,SQLITE_DB_NAME : 'MYDB'
,SQLITE_TAB_NAME: 'MYTAB'
,SQLITE_SQL_FILE: 'MYFILE'
}});})</script>

<div id="vsqlite">
<form class="form-horizontal">
<varin label="DATABASE NAME" v-model="SQLITE_DB_NAME"></varin> <varin label="TABLE NAME" v-model="SQLITE_TAB_NAME"></varin> <varin label="SQL-FILE NAME" v-model="SQLITE_SQL_FILE"></varin>
</form>

<h2 id="database-1">DATABASE</h2>
<h3 id="createconnect-database">create/connect DATABASE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlite3</span> <span class="dt">{{SQLITE_DB_NAME}}</span>.sqlite3</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">.databases</code></pre>
<h2 id="table-1">TABLE</h2>
<h3 id="csv-data-import">CSV DATA IMPORT</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.separator ,
.import <span class="kw">FILE</span> TAB</code></pre>
<h3 id="list-5">LIST</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.tables</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> name <span class="kw">from</span> sqlite_master <span class="kw">where</span> type=<span class="st">&#39;table&#39;</span> <span class="kw">order</span> <span class="kw">by</span> name;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> <span class="st">&#39;.import ./csv/&#39;</span> || name || <span class="st">&#39;.csv &#39;</span> || name <span class="kw">from</span> sqlite_master <span class="kw">where</span> type=<span class="st">&#39;table&#39;</span> <span class="kw">order</span> <span class="kw">by</span> name;</code></pre>
<h3 id="sql-from-file">SQL from FILE</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.read {{SQLITE_SQL_FILE}}</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">sqlite3 {{SQLITE_DB_NAME}} &lt; {{SQLITE_SQL_FILE}}</code></pre>
<h3 id="create-2">CREATE</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> {{SQLITE_TAB_NAME}} (
    <span class="kw">id</span> <span class="dt">integer</span> <span class="kw">not</span> <span class="kw">null</span> <span class="kw">primary</span> <span class="kw">key</span>
  , name text
  , notype
  , ts <span class="dt">timestamp</span> <span class="kw">default</span> (datetime(<span class="st">&#39;now&#39;</span>, <span class="st">&#39;localtaime&#39;</span>))
);</code></pre>
<h3 id="drop">DROP</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> {{SQLITE_TAB_NAME}};</code></pre>
<h3 id="source">SOURCE</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.schema {{SQLITE_TAB_NAME}}</code></pre>
</div>


<h1 id="emacs">EMACS</h1>
<h3 id="replace-cr">REPLACE &amp; CR</h3>
<p>M-% するときに、C-q C-j で改行挿入</p>
<h3 id="rect">RECT</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">key</th>
<th style="text-align: center;">move</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">C-x r k</td>
<td style="text-align: center;">矩形領域カット</td>
</tr>
<tr class="even">
<td style="text-align: center;">C-x r y</td>
<td style="text-align: center;">矩形領域ペースト</td>
</tr>
</tbody>
</table>
<h3 id="packeage">PACKEAGE</h3>
<p>M-x packeage-list-packeage</p>
<h1 id="ruby-1">RUBY</h1>
<h2 id="rbenv">rbenv</h2>
<h3 id="install-5">install</h3>
<p>git clone</p>
<h3 id="available-versions">available versions</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">rbenv</span> install --list</code></pre>
<h3 id="install-6">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">rbenv</span> install 2.1.2</code></pre>
<h3 id="init">init</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">rbenv</span> global 2.1.2</code></pre>
<h2 id="ruby-build">ruby-build</h2>
<h3 id="install-7">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> clone https://github.com/sstephenson/ruby-build.git .ruby-build
<span class="kw">.ruby-build/install.sh</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">rm</span> -fr .ruby-build</code></pre>
<h3 id="install-version">install version</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ruby-build</span> 2.1.2 /usr/local</code></pre>
<h3 id="bundler">BUNDLER</h3>
<h4 id="init-1">init</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">bundle</span> init</code></pre>
<h4 id="install-gems">install GEMS</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">bundle</span> install --path=vendor/bundle</code></pre>
<h4 id="exec">exec</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">bundle</span> exec ruby app.rb</code></pre>
<h2 id="json">JSON</h2>
<p>パースするとき no ASCII とかいわれたら。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">LANG=</span>en_US.UTF8
<span class="kw">locale</span></code></pre>
<p>ssh はログイン元の環境変数(LANG)を引継ぐため、意図せず &quot;ja_JP.UTF-8&quot; になってしまう。</p>
<h1 id="linux">LINUX</h1>
<h2 id="use-disc-media">USE DISC MEDIA</h2>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-diskimage',data:{label:''
,ISO_FILEPATH: 'medianame.iso'
,ISO_MOUNTPOINT: '/mnt/dvd'
}});})</script>

<div id="app-diskimage">
<form class="form-horizontal">
<varin label="ISO FILE NAME" v-model="ISO_FILEPATH"></varin> <varin label="MOUNT POINT" v-model="ISO_MOUNTPOINT"></varin>
</form>

<h4 id="iso-to-dvd">ISO to DVD</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">growisofs</span> -dvd-compat -Z /dev/dvdrw=<span class="dt">{{ISO_FILEPATH}}</span></code></pre>
<h4 id="dir-to-iso">dir to iso</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">genisoimage</span> -allow-limited-size -o DIRNAME.iso DIRNAME</code></pre>
<h4 id="disc-to-iso-file">DISC to ISO FILE</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> if=/dev/sr0 of=<span class="dt">{{ISO_FILEPATH}}</span></code></pre>
<h4 id="mount-iso-file">MOUNT ISO FILE</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mkdir</span> -p <span class="dt">{{ISO_MOUNTPOINT}}</span>
<span class="kw">mount</span> -t iso9660 -o loop <span class="dt">{{ISO_FILEPATH}}</span> <span class="dt">{{ISO_MOUNTPOINT}}</span></code></pre>
<p>umount</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">umount</span> <span class="dt">{{ISO_MOUNTPOINT}}</span></code></pre>
<p>永続化</p>
<h6 id="etcfstab">/etc/fstab</h6>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> <span class="st">&quot;{{ISO_FILEPATH}} {{ISO_MOUNTPOINT}} iso9660 loop,ro,auto 0 0&quot;</span> <span class="kw">&gt;&gt;</span> /etc/fstab
<span class="kw">cat</span> /etc/fstab
<span class="kw">mount</span> -a</code></pre>
</div>


<h2 id="lock-tray">LOCK TRAY?</h2>
<p>VirtualBox やらの VM が邪魔してる場合あり。とめよ。</p>
<h2 id="make-swap">MAKE SWAP</h2>
<h3 id="on-file">on FILE</h3>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-make-swap',data:{label:''
,LINUX_SWAP_FILE: '/swapfile'
}});})</script>

<div id="app-make-swap">
<form class="form-horizontal">
<varin label="FILE NAME" v-model="LINUX_SWAP_FILE"></varin>
</form>

<p>example 255MB(4096x65536)</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> if=/dev/zero  of=<span class="dt">{{LINUX_SWAP_FILE}}</span> bs=4096 count=65536
<span class="ot">mkswap=</span><span class="dt">{{LINUX_SWAP_FILE}}</span>
<span class="kw">chmod</span> 600 <span class="dt">{{LINUX_SWAP_FILE}}</span>
<span class="kw">swapon</span> <span class="dt">{{LINUX_SWAP_FILE}}</span></code></pre>
<h4 id="etcfstab-1">/etc/fstab</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="dt">{{LINUX_SWAP_FILE}}</span> <span class="kw">swap</span> swap defaults</code></pre>
</div>


<h1 id="p2v">P2V</h1>
<h2 id="physical-drive-to-image-file">physical drive to image file</h2>
<h3 id="physical-drive-のセクタサイズを調べる">physical drive のセクタサイズを調べる</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> fdisk -l /dev/sda</code></pre>
<h4 id="出力例">出力例</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">ディスク <span class="kw">/dev</span>/sda: <span class="kw">500.1</span> GB, 500107862016 バイト
ヘッド <span class="kw">255</span>, セクタ 63, シリンダ 60801
<span class="kw">Units</span> = シリンダ数 of 16065 * 512 = 8225280 バイト
セクタサイズ <span class="kw">(</span>論理 <span class="kw">/</span> 物理<span class="kw">):</span> 512 バイト / 512 バイト
<span class="kw">I/O</span> size (minimum/optimal)<span class="kw">:</span> 512 bytes / 512 bytes
ディスク<span class="kw">識別子</span>: 0x6f16023a

デバイス ブート      始点        <span class="kw">終</span>点     ブロック   Id  システム
<span class="kw">/dev/sda1</span>   *           1          64      512000   83  Linux
パーティション <span class="kw">1</span> は、シリンダ境界で終わっていません。
<span class="kw">/dev/sda2</span>              64      121602   976254976   8e  Linux LVM</code></pre>
<h3 id="dd-コマンドでイメージファイル化">dd コマンドでイメージファイル化</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> bs=セクタサイズ if=/dev/sda of=sda.dd conv=sync,noerror</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> bs=セクタサイズ if=/dev/sda conv=sync,noerror <span class="kw">|</span> <span class="kw">gzip</span> -c9 <span class="kw">&gt;</span> sda.dd.gz</code></pre>
<h5 id="dd-の進捗表示">dd の進捗表示</h5>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> watch -n 60 <span class="st">&quot;pkill -USER1 dd&quot;</span></code></pre>
<h4 id="イメージファイルの中身確認">イメージファイルの中身確認</h4>
<h5 id="パーティションテーブル">パーティションテーブル</h5>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">fdisk</span> -l sda.dd</code></pre>
<h5 id="マウントしてみる">マウントしてみる</h5>
<h2 id="image-file-to-vdi">image file to VDI</h2>
<p>自動的に圧縮（最小化ではない）される。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vboxmanage</span> convertfromraw sda.dd sda.vdi</code></pre>
<h2 id="参考情報">参考情報</h2>
<h3 id="fsck-とかで起動しない場合">fsck とかで起動しない場合</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mount</span> -o remount,rw</code></pre>
<h3 id="ゼロ埋め">ゼロ埋め</h3>
<p>対象ドライブに cd して、</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> if=/dev/zero of=zero bs=4k<span class="kw">;</span> \<span class="kw">rm</span> zero</code></pre>
<h3 id="圧縮">圧縮</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vboxmanage</span> modifyhd sda.vdi --compact</code></pre>
<h1 id="tmux">TMUX</h1>
<h2 id="config">Config</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Triger(Ctr+[b]...)</th>
<th style="text-align: left;">Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">:source-file ~/.tmux.conf</td>
<td style="text-align: left;">設定反映</td>
</tr>
</tbody>
</table>
<h2 id="session">Session</h2>
<p>プロジェクト単位に作成、アタッチする。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">## 一覧表示</span>
<span class="kw">tmux</span> ls
<span class="co">## 作成</span>
<span class="kw">tmux</span> new -s <span class="kw">&lt;</span>session<span class="kw">&gt;</span>
<span class="co">## 削除（個別）</span>
<span class="kw">tmux</span> kill-session -t <span class="kw">&lt;</span>session<span class="kw">&gt;</span>
<span class="co">## 削除（全て）</span>
<span class="kw">tmux</span> kill-server</code></pre>
<h2 id="pane">Pane</h2>
<p>ウインドウを分割する。</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Triger(Ctr+[b]...)</th>
<th style="text-align: left;">Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">&quot;</td>
<td style="text-align: left;">上下に分割</td>
</tr>
<tr class="even">
<td style="text-align: left;">%</td>
<td style="text-align: left;">左右に分割</td>
</tr>
<tr class="odd">
<td style="text-align: left;">o</td>
<td style="text-align: left;">Pane を移動</td>
</tr>
<tr class="even">
<td style="text-align: left;">[SPC]</td>
<td style="text-align: left;">レイアウト切り替え</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[Ctr]+[カーソル]</td>
<td style="text-align: left;">サイズ変更</td>
</tr>
<tr class="even">
<td style="text-align: left;">:set-window-option synchronize-panes on</td>
<td style="text-align: left;">各 Pain にキー入力をブロードキャストする</td>
</tr>
<tr class="odd">
<td style="text-align: left;">:set-window-option synchronize-panes off</td>
<td style="text-align: left;">各 Pain にキー入力をブロードキャストしない</td>
</tr>
</tbody>
</table>
<h1 id="git">GIT</h1>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-git',data:{label:''
,GIT_REPONAME: 'makyos/name.git'
,GIT_ROOT    : '/var/lib/git'
,GIT_REMOTE  : 'github.com'
,GIT_USER    : 'makyos'
,GIT_SSH     : '22'
,GIT_COMMENT : '1st commit'
}});})</script>

<div id="app-git">
<form class="form-horizontal">
<varin label="REPO NAME" v-model="GIT_REPONAME"></varin> <varin label="ROOT" v-model="GIT_ROOT"></varin> <varin label="REMOTE" v-model="GIT_REMOTE"></varin> <varin label="USER" v-model="GIT_USER"></varin> <varin label="SSH" v-model="GIT_SSH"></varin> <varin label="COMMIT -m" v-model="GIT_COMMENT"></varin>
</form>


<h2 id="basics-2">BASICS</h2>
<h4 id="clone">CLONE</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> clone ssh://<span class="dt">{{GIT_USER}}@{{GIT_REMOTE}}:{{GIT_SSH}}{{GIT_ROOT}}/{{GIT_REPONAME}}</span></code></pre>
<h4 id="commit">COMMIT</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> add .
<span class="kw">git</span> commit -a -m <span class="st">&quot;{{GIT_COMMENT}}&quot;</span></code></pre>
<h4 id="commit-log">COMMIT LOG</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> log</code></pre>
<h4 id="push">PUSH</h4>
<pre><code>git push origin master</code></pre>
<h4 id="pull">PULL</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> pull origin master</code></pre>
<h4 id="最終コミットまで戻す">最終コミットまで戻す</h4>
<pre class="sh"><code>git reset --hard HEAD</code></pre>
<h4 id="remote-url-を変更">remote URL を変更</h4>
<h5 id="変更方法">変更方法</h5>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> remote set-url origin git@github.com:<span class="dt">{USER}:{REPOS.}</span></code></pre>
<h5 id="確認方法">確認方法</h5>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> remote -v</code></pre>
<h4 id="remote-との比較">remote との比較</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> fetch origin <span class="kw">&amp;&amp;</span> <span class="kw">git</span> diff origin/master</code></pre>
<h4 id="マスター競合pull忘れ">マスター競合(PULL忘れ)</h4>
<p>単純マージ</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> fetch <span class="kw">&amp;&amp;</span> <span class="kw">git</span> merge origin/master</code></pre>
<h4 id="過去のファイル内容表示">過去のファイル内容表示</h4>
<p>HASH 値は、コミットログ(git log)で探す。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> show <span class="dt">{HASH}:{FILEPATH}</span></code></pre>
<h2 id="giihub.com">Giihub.com</h2>
<h3 id="公開鍵を登録">公開鍵を登録</h3>
<h4 id="テスト方法">テスト方法</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ssh</span> -T git@github.com
<span class="kw">Hi</span> <span class="dt">{USERNAME}</span>! You<span class="st">&#39;ve successfully authenticated, but GitHub does not provide shell access.</span></code></pre>
<h2 id="gitlab">GITLAB</h2>
<h3 id="create-remote-rep.">CREATE REMOTE REP.</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> mkdir -p <span class="dt">{{GIT_ROOT}}/{{GIT_REPONAME}}</span>
<span class="kw">cd</span> <span class="dt">{{GIT_ROOT}}/{{GIT_REPONAME}}</span>
<span class="kw">sudo</span> git init --bare --shared
<span class="kw">sudo</span> chown -R root:git .
<span class="kw">ls</span> -la</code></pre>
<h3 id="create-local-rep.">CREATE LOCAL REP.</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> init
<span class="kw">git</span> add .
<span class="kw">git</span> commit -m <span class="st">&quot;1st&quot;</span></code></pre>
<h3 id="push-to-remote">PUSH to REMOTE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> remote add origin ssh://<span class="dt">{{GIT_USER}}@{{GIT_REMOTE}}:{{GIT_SSH}}{{GIT_ROOT}}/{{GIT_REPONAME}}</span>
<span class="kw">git</span> push origin master</code></pre>
</div>

<h2 id="command-graph">COMMAND GRAPH</h2>
<div id="gitgraph" style="width: 100%; height: 300px; border: 1px solid lightgray;">
<div id="graph-navigation_wrapper" style="position: absolute; width: 100%; height: 300px;">
<pre><code>&lt;div id=&quot;graph-navigation_zoomExtends&quot; class=&quot;graph-navigation zoomExtends&quot;&gt;
&lt;/div&gt;</code></pre>
</div>
<div class="graph-frame" style="position: relative; overflow: hidden; width: 100%; height: 100%;">
<pre><code>&lt;canvas style=&quot;position: relative; -webkit-user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%&quot;&gt;&lt;/canvas&gt;</code></pre>
</div>
</div>
<script type="text/javascript">
var gitcontainer = document.getElementById('gitgraph');
var gitdata = {dot: 'digraph { \
\
WORKING  [shape=box,   fontColor=black,color=orange]; \
STAGING  [shape=box,   fontColor=white,color=blue]; \
LOCAL    [shape=box,   fontColor=white,color=red]; \
REMORT   [shape=box,   fontColor=white,color=red]; \
\
WORKING -> ADD          -> STAGING ; \
STAGING -> COMMIT       -> LOCAL   ; \
LOCAL   -> PUSH         -> REMORT  ; \
LOCAL   -> RESET_COMMIT -> WORKING ; \
REMORT  -> FETCH        -> LOCAL   ; \
REMORT  -> PULL         -> LOCAL   ; \
           PULL         -> WORKING ; \
\
}'};
var gitgraph = new vis.Graph(gitcontainer, gitdata);
</script>




<h1 id="docker">DOCKER</h1>
<h2 id="setup-2">Setup</h2>
<h3 id="install-8">Install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">brew</span> cask install docker</code></pre>
<h3 id="without-sudo">WITHOUT sudo</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># sudo groupadd docker</span>
<span class="kw">sudo</span> gpasswd -a <span class="ot">${USER}</span> docker
<span class="kw">sudo</span> service docker restart</code></pre>
<p>最ログインが必要！</p>
<h3 id="hello-world-1">Hello World</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run hello-world</code></pre>
<h2 id="docker-compose">docker-compose</h2>
<h4 id="docker-compose.yml">docker-compose.yml</h4>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="fu">centos:</span>
  <span class="fu">image:</span> centos:latest
  <span class="fu">container_name:</span> centos7
  <span class="fu">entrypoint:</span> tail -f /dev/null</code></pre>
<h3 id="updown">UP/DOWN</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker-compose</span> up</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker-compose</span> down</code></pre>
<h2 id="container">CONTAINER</h2>
<h3 id="list-6">LIST</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> ps -a</code></pre>
<h3 id="run-stop">RUN &amp; STOP</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -d -p 80:80 --name web nginx</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> stop <span class="dt">{CONTAINER}</span></code></pre>
<h3 id="remove">REMOVE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rm <span class="dt">{CONTAINER}</span></code></pre>
<h3 id="connect-2">CONNECT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> exec -it <span class="dt">{CONTAINER}</span> /bin/bash</code></pre>
<h2 id="image">IMAGE</h2>
<h3 id="list-7">LIST</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> images</code></pre>
<h3 id="remove-1">REMOVE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rmi <span class="dt">{IMAGE}</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rmi <span class="ot">$(</span><span class="kw">docker</span> images -a <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;/^&lt;none&gt;/ { print $3 }&#39;</span><span class="ot">)</span></code></pre>
<h1 id="docker.old">Docker.OLD</h1>
<h3 id="install-9">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> install -y docker-io.x86_64</code></pre>
<h3 id="ps">PS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">watch</span> -n 2 <span class="st">&#39;df -h; echo; free -m; echo; docker ps -a|head; echo; docker images -a&#39;</span></code></pre>
<h2 id="dockerfile">DOCKERFILE</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">FROM</span> centos:latest

<span class="co"># EPEL</span>
<span class="kw">RUN</span> rpm -i http://ftp.riken.jp/Linux/fedora/epel/6/i386/epel-release-6-8.noarch.rpm
<span class="kw">RUN</span> rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
<span class="kw">RUN</span> yum clean metadata

<span class="co"># yum</span>
<span class="kw">RUN</span> yum --enablerepo=epel install -y \
    <span class="kw">make</span> \
    <span class="kw">gcc</span> \
    <span class="kw">zlib-devel</span> \
    <span class="kw">openssl-devel</span> \
    <span class="kw">readline-devel</span> \
    <span class="kw">ncurses-devel</span> \
    <span class="kw">gdbm-devel</span> \
    <span class="kw">db4-devel</span> \
    <span class="kw">libffi-devel</span> \
    <span class="kw">tk-devel</span> \
    <span class="kw">libyaml-devel</span> \
    <span class="kw">tar</span> \
    <span class="kw">git</span>

<span class="co"># Install ruby-build</span>
<span class="kw">RUN</span> git clone https://github.com/sstephenson/ruby-build.git .ruby-build
<span class="kw">RUN</span> .ruby-build/install.sh
<span class="kw">RUN</span> rm -fr .ruby-build

<span class="co"># Install ruby</span>
<span class="kw">RUN</span> ruby-build 2.1.2 /usr/local

<span class="co"># Install bundler</span>
<span class="kw">RUN</span> gem update --system
<span class="kw">RUN</span> gem install bundler --no-rdoc --no-ri</code></pre>
<h2 id="command-graph-1">COMMAND GRAPH</h2>
<div id="docker_graph" style="width: 100%; height: 300px; border: 1px solid lightgray;">
<div id="graph-navigation_wrapper" style="position: absolute; width: 100%; height: 300px;">
<pre><code>&lt;div id=&quot;graph-navigation_zoomExtends&quot; class=&quot;graph-navigation zoomExtends&quot;&gt;
&lt;/div&gt;</code></pre>
</div>
<div class="graph-frame" style="position: relative; overflow: hidden; width: 100%; height: 100%;">
<pre><code>&lt;canvas style=&quot;position: relative; -webkit-user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%&quot;&gt;&lt;/canvas&gt;</code></pre>
</div>
</div>
<script type="text/javascript">
var container = document.getElementById('docker_graph');
var data = {dot: 'digraph { \
\
REGISTER   [shape=box,fontColor=white,color=red]; \
Dockerfile [shape=box,fontColor=white,color=red]; \
IMAGE      [shape=box]; \
CONTAINER  [shape=box]; \
Running    [shape=circle]; \
Stoped     [shape=circle]; \
SAVEFILE   [shape=box]; \
EXPORTFILE [shape=box]; \
\
Dockerfile -- build -> IMAGE; \
\
REGISTER -- pull -> IMAGE ; \
REGISTER -- login  ; \
REGISTER -- search ; \
REGISTER -- tag    ; \
\
IMAGE -- push -> REGISTER  ; \
IMAGE -- run  -> CONTAINER ; \
IMAGE -- save -> SAVEFILE -- LOAD -> IMAGE ; \
IMAGE -- history ; \
IMAGE -- images  ; \
IMAGE -- insert  ; \
IMAGE -- rmi     ; \
IMAGE -- load    ; \
IMAGE -- inspect ; \
\
CONTAINER -- commit -> IMAGE      ; \
CONTAINER -- export -> EXPORTFILE -- import -> IMAGE ; \
CONTAINER -- Running ; \
CONTAINER -- Stoped  ; \
CONTAINER -- inspect ; \
CONTAINER -- logs    ; \
CONTAINER -- port    ; \
CONTAINER -- ps      ; \
CONTAINER -- diff    ; \
\
Running  -- attach   ; \
Running  -- cp       ; \
Running  -- top      ; \
Running  -- stop     [dir = none, weight = 100]; \
Running  -- kill     ; \
Running  -- restart  ; \
Running  -- wait     ; \
\
Stoped -- start -> Running ; \
Stoped -- rm ;    \
\
}'};
var graph = new vis.Graph(container, data);
</script>


<h2 id="use">USE</h2>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-docker',data:{label:''
,DOCKER_TARG_REPO: 'ubuntu'
,DOCKER_TARG_TAG: 'ruby2'
,DOCKER_IMAGE_ID: '${IMAGE_ID}'
,DOCKER_CONTAINER_ID: '${CONTAINER_ID}'
}});})</script>

<div id="app-docker">
<form class="form-horizontal">
<varin label="REPO"         v-model="DOCKER_TARG_REPO"></varin> <varin label="TAG"          v-model="DOCKER_TARG_TAG"></varin> <varin label="IMAGE ID"     v-model="DOCKER_IMAGE_ID"></varin> <varin label="CONTAINER ID" v-model="DOCKER_CONTAINER_ID"></varin>
</form>

<h3 id="build-1">BUILD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> build -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> .</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> build --rm=true -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> .</code></pre>
<h3 id="run-stop-1">RUN / STOP</h3>
<h4 id="run-1">RUN</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -i -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> /bin/bash</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -i -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> /usr/sbin/sshd -D</code></pre>
<h4 id="stop">STOP</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> stop <span class="dt">{{DOCKER_CONTAINER_ID}}</span></code></pre>
<h4 id="all-stop">ALL STOP</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> stop <span class="kw">`docker</span> ps -aq<span class="kw">`</span></code></pre>
<h3 id="commit-1">COMMIT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> commit <span class="dt">{{DOCKER_CONTAINER_ID}}</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span></code></pre>
<h3 id="export-import">EXPORT / IMPORT</h3>
<p>差分統合される。</p>
<h4 id="export">EXPORT</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> export <span class="dt">{{DOCKER_CONTAINER_ID}}</span> <span class="kw">&gt;</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.export.tar</code></pre>
<h4 id="import">IMPORT</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cat</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.export.tar <span class="kw">|</span> <span class="kw">docker</span> import - <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span></code></pre>
<h3 id="save-load">SAVE / LOAD</h3>
<p>差分統合されない。</p>
<h4 id="save">SAVE</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> save <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> <span class="kw">&gt;</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.save.tar</code></pre>
<h4 id="load-1">LOAD</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> load <span class="kw">&lt;</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.save.tar</code></pre>
<h3 id="remove-all-container">REMOVE ALL CONTAINER</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rm <span class="kw">`docker</span> ps -aq<span class="kw">`</span></code></pre>
<h3 id="images-tree">images tree</h3>
<p>-tree もうすぐなくなる...</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> images -tree</code></pre>
<h3 id="all-images-list">all images list</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> images -a</code></pre>
<h3 id="remove-images">remove images</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rmi <span class="kw">&lt;</span>IMAGE ID<span class="kw">&gt;</span></code></pre>
<h3 id="remove-all-homeless-images">remove all homeless images</h3>
<p>消えないもの</p>
<ul>
<li>コミット済み image に依存されている？</li>
<li>コンテナが残っとる？</li>
<li>コンテナが動いとる？</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rmi <span class="ot">$(</span><span class="kw">docker</span> images -a <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;/^&lt;none&gt;/ {print $3}&#39;</span><span class="ot">)</span></code></pre>
<h3 id="all-clear">ALL CLEAR</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> stop <span class="kw">`docker</span> ps -aq<span class="kw">`</span>
<span class="kw">docker</span> rm <span class="kw">`docker</span> ps -aq<span class="kw">`</span>
<span class="kw">docker</span> rmi <span class="ot">$(</span><span class="kw">docker</span> images -a <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;{print $3}&#39;</span><span class="ot">)</span></code></pre>
<p>docker rmi $(docker images -a | awk '{print $3}')</p>
</div>


<h2 id="boot2docker">boot2docker</h2>
<h3 id="install-10">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">brew</span> install docker boot2docker</code></pre>
<h3 id="up">up</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">boot2docker</span> init
<span class="kw">boot2docker</span> up</code></pre>
<h3 id="ssh">ssh</h3>
<p>password: tcuser</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">boot2docker</span> ssh</code></pre>
<h3 id="docker_host">DOCKER_HOST</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">DOCKER_HOST=</span>tcp://localhost:4243</code></pre>
<h1 id="iptables">IPTABLES</h1>
<pre class="sourceCode bash"><code class="sourceCode bash">● 現在<span class="kw">の設</span>定の確認
<span class="kw">iptables</span> -L

● <span class="kw">FORWARDは</span>使わない
<span class="kw">iptables</span> -P FORWARD DROP

● <span class="kw">まずは全許</span>可<span class="kw">に</span>
<span class="kw">iptables</span> -P INPUT ACCEPT

● デフォルト<span class="kw">の</span>ルールを全て削除
<span class="kw">iptables</span> -F

● 自分自身<span class="kw">か</span>らのパケットは全許可
<span class="kw">iptables</span> -A INPUT -i lo -j ACCEPT

● <span class="kw">SSH許</span>可 or SSH自分(255.255.255.255)だ<span class="kw">け許</span>可
<span class="kw">iptables</span> -A INPUT -p tcp --dport 22 -j ACCEPT
 <span class="kw">or</span>
 <span class="kw">iptables</span> -A INPUT -s 255.255.255.255 -p tcp --dport 22 -j ACCEPT

● <span class="kw">FTP</span>(20,21,4000-4029) <span class="kw">の</span>接続を許可
<span class="kw">iptables</span> -A INPUT -p tcp --dport 20 -j ACCEPT
<span class="kw">iptables</span> -A INPUT -p tcp --dport 21 -j ACCEPT
<span class="kw">iptables</span> -A INPUT -p tcp --dport 4000:4029 -j ACCEPT

● <span class="kw">http</span>, https の接続を許可
<span class="kw">iptables</span> -A INPUT -p tcp --dport 80 -j ACCEPT
<span class="kw">iptables</span> -A INPUT -p tcp --dport 443 -j ACCEPT

● <span class="kw">POP</span>(受信メール)<span class="kw">の許</span>可
<span class="kw">iptables</span> -A INPUT -p tcp --dport 110 -j ACCEPT

● <span class="kw">SMTP</span>(送信メール)<span class="kw">の許</span>可【これをしないと世間からメールが来なくなる！】
<span class="kw">iptables</span> -A INPUT -p tcp --dport 25 -j ACCEPT

● <span class="kw">SUBMISSION</span> ポートを開<span class="kw">放</span>
<span class="kw">iptables</span> -A INPUT -p tcp --dport 587 -j ACCEPT

● <span class="kw">PostgreSQL</span>も外から使います
<span class="kw">iptables</span> -A INPUT -p tcp --dport 5432 -j ACCEPT

● <span class="kw">DNS</span>関係
<span class="kw">iptables</span> -A INPUT -p tcp --dport 53 -j ACCEPT
<span class="kw">iptables</span> -A INPUT -p udp --dport 53 -j ACCEPT

● <span class="kw">PING</span>を許可
<span class="kw">iptables</span> -A INPUT -p icmp -j ACCEPT

● <span class="kw">TCPの</span>接続開始と応答、FTPデータなどを許可【これをしないと外にメールが飛ばなくなる】
<span class="kw">iptables</span> -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

● <span class="kw">設</span>定したルール以外のパケットを拒<span class="kw">否</span>
<span class="kw">iptables</span> -P INPUT DROP</code></pre>
<h3 id="port-forward">port forward</h3>
<h4 id="vsftpd">vsftpd</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">pasv_enable=</span>YES
<span class="ot">pasv_min_port=</span>20
<span class="ot">pasv_max_port=</span>20
<span class="ot">pasv_address=</span><span class="dt">{global_ip_address}</span>

<span class="kw">iptables</span> -I FORWARD -p tcp --dport 20 -j ACCEPT</code></pre>
<h1 id="ansible">ANSIBLE</h1>
<h2 id="basics-3">BASICS</h2>
<h3 id="ping">ping</h3>
<p>実行前に接続できるか確認する。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ansible</span> -i hosts all -m ping</code></pre>
<h3 id="run-playbook">run playbook</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ansible-playbook</span> -i hosts site.yml</code></pre>
<h2 id="roll">roll</h2>
<h3 id="send-file">send file</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> copy CENTOS iso file 1
  <span class="fu">copy:</span> src=CentOS-6.5-x86_64-bin-DVD1.iso dest=/mnt/ owner=root group=root mode=644</code></pre>
<h3 id="mkdir">mkdir</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> make mount position
  <span class="fu">file:</span> path=/mnt/CentOS-6.5_1 owner=root group=root mode=644 state=directory</code></pre>
<h3 id="mod-file-line">mod file line</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> MODFILE &quot;yum.conf&quot;
  <span class="fu">lineinfile:</span> dest=/etc/yum.conf  regexp=^keepcache  line=keepcache=1</code></pre>
<h3 id="yums">yums</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> yum install depend pkg
  <span class="fu">yum:</span> name={{ item }} state=installed disablerepo=* enablerepo=c6-media
  <span class="fu">with_items:</span>
    <span class="kw">-</span> compat-libstdc++-33
    <span class="kw">-</span> elfutils-libelf-devel
    <span class="kw">-</span> elfutils-libelf-devel-static
    <span class="kw">-</span> gcc
    <span class="kw">-</span> gcc-c++
    <span class="kw">-</span> glibc-devel
    <span class="kw">-</span> glibc-headers
    <span class="kw">-</span> kernel-headers
    <span class="kw">-</span> libaio-devel
    <span class="kw">-</span> libgomp
    <span class="kw">-</span> libstdc++-devel
    <span class="kw">-</span> sysstat</code></pre>
<h3 id="add-group-user">add group &amp; user</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> create group
  <span class="fu">group:</span> name={{item.name}} gid={{item.gid}} state=present
  <span class="fu">with_items:</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;oinstall&quot;</span> <span class="kw">, </span><span class="fu">gid:</span> 701<span class="kw">}</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;dba&quot;</span>      <span class="kw">, </span><span class="fu">gid:</span> 702<span class="kw">}</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;oracle&quot;</span>   <span class="kw">, </span><span class="fu">gid:</span> 703<span class="kw">}</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;oper&quot;</span>     <span class="kw">, </span><span class="fu">gid:</span> 704<span class="kw">}</span>

<span class="kw">-</span> <span class="fu">name:</span> create user
  <span class="fu">user:</span> name={{item.name}} uid={{item.uid}} password={{item.pass}} group=oinstall groups=dba,oper createhome=yes state=present
  <span class="fu">with_items:</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;oracle&quot;</span> <span class="kw">, </span><span class="fu">uid:</span> 701<span class="kw">,</span> <span class="fu">pass:</span> <span class="st">&quot;$1$SomeSalt$c7SWNheGRHNaCLwuAG7Sa.&quot;</span> <span class="kw">}</span></code></pre>
<h4 id="make-password">make password</h4>
<pre class="sourceCode python"><code class="sourceCode python">python -c <span class="st">&#39;import crypt; print crypt.crypt(&quot;REPLACE:username&quot;, &quot;$1$SomeSalt$&quot;)&#39;</span></code></pre>
<h4 id="exec-shell-command">exec shell command</h4>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> yum install
  <span class="fu">shell:</span> yum --disablerepo=\* -y localinstall /opt/rpm/*.rpm &gt; /opt/rpm/res.txt</code></pre>
<p>command もあるが、なんか違う。</p>
<h1 id="test-1">test</h1>
<h2 id="ファイルの有無">ファイルの有無</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">test</span> ! -e /vagrant/rpm/gitlab-7.3.2_omnibus-1.el6.x86_64.rpm<span class="kw">;</span> <span class="kw">echo</span> <span class="ot">$?</span></code></pre>
<h1 id="cut">cut</h1>
<h2 id="列目だけ">1列目だけ</h2>
<pre><code>cut -d &#39; &#39; -f1</code></pre>
<h1 id="grep">grep</h1>
<h2 id="and">AND</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> <span class="st">&#39;AAA&#39;</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">&#39;BBB&#39;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> <span class="st">&#39;AAA.*BBB&#39;</span></code></pre>
<h3 id="複数行">複数行</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -P <span class="st">&#39;AAA[\s\S]*?BBB&#39;</span></code></pre>
<h2 id="or">OR</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> <span class="st">&#39;AAA\|BBB&#39;</span></code></pre>
<h2 id="not">NOT</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -v <span class="st">&#39;AAA&#39;</span></code></pre>
<h2 id="前後も表示">前後も表示</h2>
<ul>
<li>-B マッチ「前」の行数</li>
<li>-A マッチ「後」の行数</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -B 3 -A 3 <span class="st">&#39;xyz&#39;</span> *.txt</code></pre>
<h1 id="sed">sed</h1>
<h2 id="ファイルを直接置換え">ファイルを直接置換え</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sed</span> -i -e <span class="st">&#39;s/AAA/ZZZ/g&#39;</span> FILENAME.txt</code></pre>
<h2 id="改行コード変換">改行コード変換</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sed</span> <span class="st">&quot;s/\r//g&quot;</span> FILENAME.txt</code></pre>
<h1 id="echo">echo</h1>
<h2 id="改行しない">改行しない</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> -n <span class="st">&#39;ZZZ...&#39;</span></code></pre>
<h2 id="colorstyle">COLOR/STYLE</h2>
<h3 id="green">GREEN</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">          \<span class="kw">e</span>[32m  \e[m
          <span class="kw">&lt;----&gt;</span>  <span class="kw">&lt;</span>--<span class="kw">&gt;</span>
<span class="kw">echo</span> -e <span class="st">&#39;[\e[32mOK\e[m]&#39;</span></code></pre>
<h3 id="red">RED</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">          \<span class="kw">e</span>[31m  \e[m
          <span class="kw">&lt;----&gt;</span>  <span class="kw">&lt;</span>--<span class="kw">&gt;</span>
<span class="kw">echo</span> -e <span class="st">&#39;[\e[31mNG\e[m]&#39;</span></code></pre>
<h3 id="bold">BOLD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">         \<span class="kw">e</span>[1m         \e[m
         <span class="kw">&lt;---&gt;</span>         <span class="kw">&lt;</span>--<span class="kw">&gt;</span>
<span class="kw">echo</span> -e <span class="st">&#39;\e[1mI AM BOLD\e[m&#39;</span></code></pre>
<h3 id="red-bold">RED + BOLD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">            \<span class="kw">e</span>[1m\e[31m        \e[m
            <span class="kw">&lt;---&gt;&lt;</span>----<span class="kw">&gt;</span>        <span class="kw">&lt;</span>--<span class="kw">&gt;</span>
<span class="kw">echo</span> -e <span class="st">&#39;zzz\e[1m\e[31mRED+BOLD\e[mzzz&#39;</span></code></pre>
<h3 id="what-ever">What Ever</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> -e <span class="st">&quot;</span>
<span class="st"># Attribute codes:</span>
<span class="st"># 00=none 01=bold 04=underscore 05=blink 07=reverse 08=concealed</span>
<span class="st"># Text color codes:</span>
<span class="st"># 30=black 31=red 32=green 33=yellow 34=blue 35=magenta 36=cyan 37=white</span>
<span class="st"># Background color codes:</span>
<span class="st"># 40=black 41=red 42=green 43=yellow 44=blue 45=magenta 46=cyan 47=white</span>

<span class="st">状態番号</span>
<span class="st">\033[00m デフォルト状態 00 \033[00m</span>
<span class="st">\033[01m 強調           01 \033[00m</span>
<span class="st">\033[04m 下線           04 \033[00m</span>
<span class="st">\033[05m 点滅           05 \033[00m</span>
<span class="st">\033[07m 色反転         07 \033[00m</span>
<span class="st">\033[08m 塗りつぶし     08 \033[00m(塗りつぶし 08)</span>

<span class="st">色番号</span>
<span class="st">\033[30m 黒               30 \033[00m \033[40m 40 \033[00m \033[31;40m 31;40 \033[00m \033[32;00;40m 32;00;40 \033[00m</span>
<span class="st">\033[31m 赤               31 \033[00m \033[41m 41 \033[00m \033[32;41m 32;41 \033[00m \033[33;01;41m 33;01;41 \033[00m</span>
<span class="st">\033[32m 緑               32 \033[00m \033[42m 42 \033[00m \033[33;42m 33;42 \033[00m \033[34;04;42m 34;04;42 \033[00m</span>
<span class="st">\033[33m 黄(または茶)     33 \033[00m \033[43m 43 \033[00m \033[34;43m 34;43 \033[00m \033[35;05;43m 35;05;43 \033[00m</span>
<span class="st">\033[34m 青               34 \033[00m \033[44m 44 \033[00m \033[35;44m 35;44 \033[00m \033[36;07;44m 36;07;44 \033[00m</span>
<span class="st">\033[35m 紫               35 \033[00m \033[45m 45 \033[00m \033[36;45m 36;45 \033[00m \033[37;00;45m 37;00;45 \033[00m</span>
<span class="st">\033[36m シアン           36 \033[00m \033[46m 46 \033[00m \033[37;46m 37;46 \033[00m \033[30;01;46m 30;01;46 \033[00m</span>
<span class="st">\033[37m 白(またはグレー) 37 \033[00m \033[47m 47 \033[00m \033[30;47m 30;47 \033[00m \033[31;04;47m 31;04;47 \033[00m</span>
<span class="st">&quot;</span></code></pre>
<h1 id="ファイルの内容置換">ファイルの内容置換</h1>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-cmdreplace',data:{label:''
,CMD_REPLACE_BEFOR    : 'BEFOR'
,CMD_REPLACE_AFTER    : 'AFTER'
,CMD_REPLACE_FILENAME : '*.html'
}});})</script>

<div id="app-cmdreplace">
<form class="form-horizontal">
<varin label="BEFOR" v-model="CMD_REPLACE_BEFOR"></varin> <varin label="AFTER" v-model="CMD_REPLACE_AFTER"></varin> <varin label="FILE"  v-model="CMD_REPLACE_FILENAME"></varin>
</form>


<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -rl <span class="st">&quot;{{CMD_REPLACE_BEFOR}}&quot;</span> */<span class="dt">{{CMD_REPLACE_FILENAME}}</span>
<span class="kw">perl</span> -p -i.befor -e <span class="st">&#39;s/{{CMD_REPLACE_BEFOR}}/{{CMD_REPLACE_AFTER}}/g&#39;</span> <span class="dt">{{CMD_REPLACE_FILENAME}}</span></code></pre>
<p>OR</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">find</span> . -name <span class="st">&#39;{{CMD_REPLACE_FILENAME}}&#39;</span> -type f -exec sed -i <span class="st">&#39;s/{{CMD_REPLACE_BEFOR}}/{{CMD_REPLACE_AFTER}}/g&#39;</span> <span class="dt">{}</span> <span class="dt">\;</span></code></pre>
</div>



<h1 id="date-1">date</h1>
<h2 id="設定">設定</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span> --set <span class="st">&quot;2016/12/31 12:34:56&quot;</span></code></pre>
<h2 id="from-通算秒-to-日時">from 通算秒 to 日時</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span> -d <span class="st">&quot;1970-01-01 UTC 4294967295 seconds&quot;</span> <span class="st">&#39;+%Y-%m-%d %H:%M:%S&#39;</span></code></pre>
<h2 id="from-日時-to-通算秒">from 日時 to 通算秒</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span> -d <span class="st">&quot;2000-01-01 00:00:00&quot;</span> +%s</code></pre>
<h2 id="watch">WATCH</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">watch</span> -t -n 0.1 --no-title <span class="st">&quot;date  +&#39;%n +------------+%n | %Y-%m-%d |%n +------------+%n |  %H:%M:%S  |%n +------------+%n | %N0 |%n +------------+%n | %s |%n +------------+&#39;&quot;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">while</span> <span class="kw">true;do</span> <span class="kw">date</span> +<span class="st">&quot;%Y-%m-%d %H:%M:%S.%N&quot;</span><span class="kw">;sleep</span> 1<span class="kw">;done</span></code></pre>
<h2 id="timer">TIMER</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">watch</span> -n 0.1 --no-title <span class="st">&#39;expr `date +%s -d &quot;2020-12-31 23:59:59&quot;` - `date +%s`&#39;</span></code></pre>
<h2 id="日時書式">日時書式</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span>
<span class="kw">date</span> +<span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span></code></pre>
<h2 id="offset">OFFSET</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span>
<span class="kw">date</span> -d <span class="st">&quot;12 hours ago&quot;</span>
<span class="kw">date</span> -d <span class="st">&quot;12 hours&quot;</span></code></pre>
<h3 id="ファイル検索-コマンド実行">ファイル検索 &amp; コマンド実行</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">find</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="kw">&lt;</span>検索文字<span class="kw">&gt;</span> <span class="kw">|</span> <span class="kw">xargs</span> <span class="kw">&lt;</span>コマンド<span class="kw">&gt;</span></code></pre>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-fileandfile',data:{label:''
,CMD_FILE1    : 'CMD_FILE1'
,CMD_FILE2    : 'CMD_FILE2'
}});})</script>

<div id="app-fileandfile">
<form class="form-horizontal">
<varin label="FILE-1" v-model="CMD_FILE1"></varin> <varin label="FILE-2" v-model="CMD_FILE2"></varin>
</form>

<h3 id="ナイスな-diff">ナイスな diff</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">diff</span> -y --suppress-common-lines <span class="dt">{{CMD_FILE1}}</span> <span class="dt">{{CMD_FILE2}}</span></code></pre>
<h3 id="ファイルの単純横結合">ファイルの単純横結合</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">paste</span>  <span class="dt">{{CMD_FILE1}}</span> <span class="dt">{{CMD_FILE2}}</span></code></pre>
</div>

<h3 id="プロンプト反転">プロンプト反転</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">PS1=</span><span class="st">&quot;\[\033[07m\][\u@</span><span class="ot">${HOSTNAME}</span><span class="st"> \W]</span><span class="dt">\\</span><span class="st">$\[\033[00m\] &quot;</span></code></pre>
<h3 id="pgrep">pgrep</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">pgrep</span> procname*</code></pre>
<h4 id="pkill-and-kill">pkill and kill</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">pgrep</span> procname* <span class="kw">|</span> <span class="kw">xargs</span> kill -9</code></pre>
<h3 id="exfat">exfat</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> mount -t exfat-fuse /dev/sde1 /media/exfat
<span class="kw">umount</span> /media/exfat</code></pre>
<h3 id="lang">LANG</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">LANG=</span>en_US.UTF-8</code></pre>
<h3 id="scp">scp</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">scp</span> -P 22 -rq tcp/ username@192.168.33.32:/home/aaa/</code></pre>
<h1 id="vi">VI</h1>
<h2 id="edit">EDIT</h2>
<h3 id="置換え">置換え</h3>
<h4 id="確認あり">確認あり</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">:<span class="kw">%s/前</span>/後<span class="kw">/gc</span></code></pre>
<h4 id="確認なし">確認なし</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">:<span class="kw">%s/前</span>/後<span class="kw">/g</span></code></pre>
<h2 id="view-1">VIEW</h2>
<h3 id="カーソル移動-1">カーソル移動</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">key</th>
<th style="text-align: left;">move</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1G</td>
<td style="text-align: left;">1 行目のあたま</td>
</tr>
<tr class="even">
<td style="text-align: center;">G</td>
<td style="text-align: left;">最終行のケツ</td>
</tr>
<tr class="odd">
<td style="text-align: center;">~</td>
<td style="text-align: left;">今の行のあたま</td>
</tr>
<tr class="even">
<td style="text-align: center;">$</td>
<td style="text-align: left;">今の行のケツ</td>
</tr>
<tr class="odd">
<td style="text-align: center;">[CTR]+[b]</td>
<td style="text-align: left;">ページアップ</td>
</tr>
<tr class="even">
<td style="text-align: center;">[CTR]+[f]</td>
<td style="text-align: left;">ページダウン</td>
</tr>
</tbody>
</table>
<h1 id="windows-3">WINDOWS</h1>
<h2 id="メーカー情報">メーカー情報</h2>
<p>以下のレジストリ情報を操作すればどうにでもなる。空にすれば削除もできる。</p>
<pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\OEMInformation</code></pre>
<h2 id="product-key">Product Key</h2>
<p>Windows 7 Professional SP1 で取得できた。 以下のコードを PowerShell ISE で実行する。</p>
<pre class="sh"><code>function Get-ProductKey {
    $map=&quot;BCDFGHJKMPQRTVWXY2346789&quot;
    $key = &quot;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot;
    $value = (get-itemproperty $key).digitalproductid[0x34..0x42]
    $ProductKey = &quot;&quot;
    for ($i = 24; $i -ge 0; $i--) {
      $r = 0
      for ($j = 14; $j -ge 0; $j--) {
        $r = ($r * 256) -bxor $value[$j]
        $value[$j] = [math]::Floor([double]($r/24))
        $r = $r % 24
      }
      $ProductKey = $map[$r] + $ProductKey
      if (($i % 5) -eq 0 -and $i -ne 0) {
        $ProductKey = &quot;-&quot; + $ProductKey
      }
    }
    $ProductKey
}
Get-ProductKey</code></pre>
<h2 id="disk-wipe">DISK WIPE</h2>
<pre><code>cipher /w:c:</code></pre>
<h2 id="network-1">NETWORK</h2>
<p>ドス窓は管理者権限で実行</p>
<h3 id="ip-アドレス設定">IP アドレス設定</h3>
<pre><code>netsh interface ipv4 set address name=&quot;ローカル エリア接続&quot; addr=192.2.56.111 mask=255.255.255.0 gateway=192.2.56.1</code></pre>
<h3 id="ip-アドレス追加">IP アドレス追加</h3>
<p>追加の場合は gateway 不要</p>
<pre><code>netsh interface ipv4 add address name=&quot;ローカル エリア接続&quot; addr=192.2.56.111 mask=255.255.255.0</code></pre>
<h3 id="ip-アドレス削除">IP アドレス削除</h3>
<pre><code>netsh interface ipv4 del address name=&quot;ローカル エリア接続&quot; addr=192.2.56.111</code></pre>
<h3 id="dns">DNS</h3>
<h4 id="display">display</h4>
<pre><code>ipconfig /displaydns</code></pre>
<h4 id="flush">flush</h4>
<pre><code>ipconfig /flushdns</code></pre>
<h3 id="各種情報収集">各種情報収集</h3>
<pre><code>mkdir .\%COMPUTERNAME%
cd .\%COMPUTERNAME%

echo &quot;&quot;        &gt; 10_SYSTEM
systeminfo     &gt; 11_SYSTEM__systeminfo.txt
msinfo32 /report 12_SYSTEM__msinfo32.txt

echo &quot;&quot;        &gt; 20_NETWORK
ipconfig /all  &gt; 21_NETWORK__ipconfig_all.txt
route print    &gt; 22_NETWORK__route_print.txt
netstat -sp    &gt; 23_NETWORK__netstat_sp.txt
netstat -e     &gt; 24_NETWORK__netstat_e.txt
net use        &gt; 25_NETWORK__net_use.txt

echo &quot;&quot;            &gt; 30_TASK
schtasks /query /V &gt; 31_TASK__shttasks.txt
tasklist           &gt; 32_TASK__tasklist.txt
tasklist /svc      &gt; 33_TASK__tasklist_svc.txt
tasklist /m        &gt; 34_TASK__tasklist_m.txt

echo &quot;&quot;                        &gt; 40_LOG
wevutil qe system      /f:TEXT &gt; 41_LOG__wevutil_qe_system.txt
wevutil qe Application /f:TEXT &gt; 42_LOG__wevutil_qe_application.txt</code></pre>
<h1 id="nxr120">NXR120</h1>
<h2 id="web">Web</h2>
<pre><code>http://IPADDRESS:880/
(admin/admin)</code></pre>
<h2 id="ssh-1">ssh</h2>
<h3 id="設定の確認">設定の確認</h3>
<pre><code>show config</code></pre>
<h3 id="default-gateway">default gateway</h3>
<pre><code>configure terminal
ip route 0.0.0.0/0 196.1.58.1
exit
save config</code></pre>
<h3 id="ip-masquerade">ip masquerade</h3>
<pre><code>configure terminal
   interface ethernet 1
      ip masquerade
   exit
exit
save config</code></pre>
<h3 id="speed">Speed</h3>
<pre><code>configure terminal
   interface ethernet 1
      speed 10M-full
   exit
exit
save config</code></pre>
<h3 id="ブリッジの設定方法">ブリッジの設定方法</h3>
<p>設定上は masquerade と共存が可能であるが、その場合 masquerade は機能しない（アドレス変換されない）。</p>
<pre><code>configure terminal
   interface bridge 0
      ip address 192.168.10.1/24
      bridge port 1 ethernet 0
      bridge port 2 ethernet 1
   exit
exit
save config</code></pre>
<h3 id="nat">1:1 NAT</h3>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-nxr120-nat',data:{label:''
,nxr_e0ip    : '192.168.0.1'
,NXR_RIP    : '192.168.0.10'
,nxr_e1ip    : '11.22.33.1'
,nxr_vip    : '11.22.33.10'
}});})</script>

<div id="app-nxr120-nat">
<form class="form-horizontal">
<varin label="ethernet0 IP" v-model="nxr_e0ip"></varin> <varin label="host IP"      v-model="NXR_RIP"></varin> <varin label="ethernet1 IP" v-model="nxr_e1ip"></varin> <varin label="host virtIP"  v-model="nxr_vip"></varin>
</form>

<pre class="sh"><code>show config
configure terminal

system dnat-group DNAT
system snat-group SNAT
ip dnat DNAT ip any {{nxr_vip}} {{NXR_RIP}}
ip snat SNAT ip {{NXR_RIP}} any {{nxr_vip}}

interface ethernet 0

  ip address {{nxr_e0ip}}/24
  ip snat-group SNAT
  exit

interface ethernet 1

  ip address {{nxr_e1ip}}/24
  ip address {{nxr_vip}}/24 secondary
  ip dnat-group DNAT
  exit

exit
save config
restart</code></pre>
</div>

<h3 id="ip-filter">ip filter</h3>
<pre class="sh"><code>configure terminal

ip access-list eth0_in permit 192.2.58.221/32 192.2.58.220/32 tcp any 22
ip access-list eth0_in permit 192.2.58.221/32 192.2.58.220/32 tcp any 880
ip access-list eth0_in permit any any icmp
ip access-list eth0_in deny any any

ip access-list eth1_in permit any any tcp any any
ip access-list eth1_in permit 195.200.58.33/32 any tcp any 80
ip access-list eth1_in permit 195.200.58.33/32 any tcp any range 1024 65535
ip access-list eth1_in permit any any icmp
ip access-list eth1_in deny any any

ip access-list eth1_forward_in permit 195.200.58.33/32 any tcp any range 1024 65535
ip access-list eth1_forward_in permit any any tcp any range 80 81
ip access-list eth1_forward_in permit any any tcp any 8081
ip access-list eth1_forward_in permit any any tcp any 8084
ip access-list eth1_forward_in permit 196.2.58.221/32 any tcp any range 1024 65535
ip access-list eth1_forward_in permit any any tcp range 80 81 any
ip access-list eth1_forward_in permit any any tcp 8081 any
ip access-list eth1_forward_in permit any any tcp 8084 any
ip access-list eth1_forward_in permit 193.2.14.31/32 192.2.58.221/32 tcp any any
ip access-list eth1_forward_in permit 193.3.15.31/32 192.2.58.221/32 tcp any any
ip access-list eth1_forward_in permit 192.2.58.221/32 193.2.14.31/32 tcp any any
ip access-list eth1_forward_in permit 192.2.58.221/32 193.3.15.31/32 tcp any any
ip access-list eth1_forward_in permit any any icmp
ip access-list eth1_forward_in deny any any


interface ethernet 0
   ip access-group in eth0_in
exit

interface ethernet 1
   ip access-group in eth1_in
   ip access-group forward_in eth1_forward_in
exit

save config

restart</code></pre>
<h3 id="設定の無効化">設定の無効化</h3>
<pre><code>頭に no をつける</code></pre>
<h1 id="ssh-2">SSH</h1>
<h2 id="no-pass-login">NO PASS LOGIN</h2>
<h3 id="on-local">on LOCAL</h3>
<h4 id="keygen">keygen</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ssh-keygen</span>
<span class="kw">ssh-add</span> ./id_rsa...?
<span class="kw">cat</span> ~/.ssh/id_rsa.pub</code></pre>
<h3 id="on-server">on SERVER</h3>
<h4 id="paste">paste</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/home/USERNAME/.ssh/authorized_keys</span></code></pre>
<h1 id="centos">CENTOS</h1>
<h2 id="single-user-mode">single user mode</h2>
<ul>
<li>起動カウントダウン中に [ENTER] を押す。</li>
<li>karnel... の行を選んで [e] を押す。</li>
<li>起動オプションの末尾に [スペース]+single を追記して [ENTER] を押す。</li>
<li>karnel... の行を選んで [b] を押す。</li>
</ul>
<h2 id="selinux-1">SELINUX</h2>
<h3 id="状況確認">状況確認</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">getenforce</span></code></pre>
<h3 id="一時的な-off">一時的な OFF</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">setenforce</span> 0</code></pre>
<h3 id="恒久的な-off">恒久的な OFF</h3>
<h4 id="etcselinuxconfig">/etc/selinux/config</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">SELINUX=</span>disabled</code></pre>
<h2 id="network-2">NETWORK</h2>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-eth',data:{label:''
,CENT_NET_IFNAME: 'eth0'
}});})</script>

<div id="app-eth">
<form class="form-horizontal">
<varin label="I/F NAME"  v-model="CENT_NET_IFNAME"></varin>
</form>

<h3 id="ip-アドレスリンクスピード固定化">IP アドレス・リンクスピード固定化</h3>
<h4 id="etcsysconfignetwork-scriptsifcfg-eth0">/etc/sysconfig/network-scripts/ifcfg-eth0</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">HWADDR=</span>XX:XX:XX:XX:XX:XX
<span class="ot">DEVICE=</span><span class="dt">{{CENT_NET_IFNAME}}</span>
<span class="ot">BOOTPROTO=</span>none
<span class="ot">ONBOOT=</span>yes
<span class="ot">USERCTL=</span>no
<span class="ot">IPV6INIT=</span>no
<span class="ot">PEERDNS=</span>no
<span class="ot">TYPE=</span>Ethernet
<span class="ot">IPADDR=</span>192.168.1.10
<span class="ot">NETMASK=</span>255.255.255.0
<span class="ot">ETHTOOL_OPTS=</span><span class="st">&quot;autoneg off speed 10 duplex full&quot;</span></code></pre>
<h4 id="sudo">sudo</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> network restart</code></pre>
<h3 id="ip-エイリアス">IP エイリアス</h3>
<h4 id="sudo-1">sudo</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> /etc/sysconfig/network-scripts
<span class="kw">cp</span> ifcfg-<span class="dt">{{CENT_NET_IFNAME}}</span> ifcfg-<span class="dt">{{CENT_NET_IFNAME}}</span>:1</code></pre>
<h4 id="etcsysconfignetwork-scriptsifcfg-cent_net_ifname1">/etc/sysconfig/network-scripts/ifcfg-{{CENT_NET_IFNAME}}:1</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">HWADDR=</span>XX:XX:XX:XX:XX:XX
<span class="ot">DEVICE=</span><span class="dt">{{CENT_NET_IFNAME}}</span>:1
<span class="ot">BOOTPROTO=</span>none
<span class="ot">ONBOOT=</span>yes
<span class="ot">USERCTL=</span>no
<span class="ot">IPV6INIT=</span>no
<span class="ot">PEERDNS=</span>no
<span class="ot">TYPE=</span>Ethernet
<span class="ot">IPADDR=</span>192.168.1.10
<span class="ot">NETMASK=</span>255.255.255.0
<span class="ot">ETHTOOL_OPTS=</span><span class="st">&quot;autoneg off speed 10 duplex full&quot;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> network restart</code></pre>
<h3 id="スタティックルート">スタティックルート</h3>
<h4 id="etcsysconfigstatic-routes">/etc/sysconfig/static-routes</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">any</span> net 123.1.2.0 netmask 255.255.255.0 gw 192.168.0.201</code></pre>
<h4 id="sudo-2">sudo</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> network restart</code></pre>
<h3 id="デフォルトゲートウェイホスト名">デフォルトゲートウェイ・ホスト名</h3>
<h4 id="etcsysconfignetwork">/etc/sysconfig/network</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">NETWORKING=</span>yes
<span class="ot">NETWORKING_IPV6=</span>no
<span class="ot">HOSTNAME=</span>SERVERNAME
<span class="ot">GATEWAY=</span>192.168.0.123</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> network restart</code></pre>
</div>

<h1 id="yum-1">YUM</h1>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-yum',data:{label:''
,YUM_PKG: 'httpd'
,YUM_OPT: 'YUM_OPT="--disablerepo=\\* --enablerepo=c6-media"'
}});})</script>

<div id="app-yum">
<form class="form-horizontal">
<varin label="PKG NAME"  v-model="YUM_PKG"></varin> <varin label="OPT"       v-model="YUM_OPT"></varin>
</form>

<h2 id="repo">REPO</h2>
<h3 id="files-1">FILES</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/etc/yum.repos.d</span></code></pre>
<h3 id="add-1">ADD</h3>
<h4 id="epel">EPEL</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> install epel-release</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">curl</span> http://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-6 \
  <span class="kw">-o</span> <span class="ot">$RPMDIR</span>/RPM-GPG-KEY-EPEL-6
<span class="kw">curl</span> http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm \
  <span class="kw">-o</span> <span class="ot">$RPMDIR</span>/epel-release-6-8.noarch.rpm

<span class="kw">sudo</span> rpm --import file://<span class="ot">$RPMDIR</span>/RPM-GPG-KEY-EPEL-6
<span class="kw">sudo</span> rpm -ihv file://<span class="ot">$RPMDIR</span>/epel-release-6-8.noarch.rpm</code></pre>
<h3 id="onoff-repo">ON/OFF REPO</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> --disablerepo=<span class="dt">\*</span> --enablerepo=c6-media ...</code></pre>
<h2 id="package">PACKAGE</h2>
<h3 id="dependencies">dependencies</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> deplist <span class="dt">{{YUM_PKG}}</span> <span class="dt">{{YUM_OPT}}</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> deplist <span class="dt">{{YUM_PKG}}</span> <span class="dt">{{YUM_OPT}}</span> <span class="kw">|</span> <span class="kw">grep</span> provider</code></pre>
<h3 id="download">DOWNLOAD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yumdownloader</span> --resolve <span class="dt">{{YUM_PKG}}</span></code></pre>
<h3 id="install-from-local-rpm">INSTALL from LOCAL RPM</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> --disablerepo=<span class="dt">\*</span> -y localinstall ./*.rpm</code></pre>
<h3 id="list-8">LIST</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> <span class="dt">{{YUM_OPT}}</span> list</code></pre>
<h3 id="create-local-repos.">CREATE LOCAL REPOS.</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/bin/bash</span>

<span class="kw">function</span><span class="fu"> download_yum</span> <span class="kw">{</span>
    <span class="kw">if [</span> <span class="ot">!</span> <span class="ot">-e</span> <span class="ot">${YUMDIR}</span>/repodata/repomd.xml<span class="kw"> ]</span> ; <span class="kw">then</span>
    <span class="kw">sudo</span> yum install -y yum-plugin-downloadonly createrepo
    <span class="kw">sudo</span> yum install -y --downloadonly --downloaddir=<span class="ot">${YUMDIR}</span> <span class="ot">${YUMPKGS}</span>
    <span class="kw">sudo</span> createrepo -v <span class="ot">${YUMDIR}</span>
    <span class="kw">sudo</span> yum clean all
    <span class="kw">fi</span>
<span class="kw">}</span>

<span class="kw">function</span><span class="fu"> mk_repofile</span> <span class="kw">{</span>
    <span class="kw">sudo</span> chmod 777 /etc/yum.repos.d
    <span class="co"># sudo rm -f /etc/yum.repos.d/*</span>
    <span class="ot">REPOFILE=</span>/etc/yum.repos.d/<span class="ot">${REPONAME}</span>.repo
    <span class="kw">echo</span> [<span class="ot">${REPONAME}</span>]             <span class="kw">&gt;</span>  <span class="ot">${REPOFILE}</span>
    <span class="kw">echo</span> gpgcheck=0                <span class="kw">&gt;&gt;</span> <span class="ot">${REPOFILE}</span>
    <span class="kw">echo</span> name=<span class="ot">${REPONAME}</span>          <span class="kw">&gt;&gt;</span> <span class="ot">${REPOFILE}</span>
    <span class="kw">echo</span> baseurl=file://<span class="ot">${YUMDIR}</span>/ <span class="kw">&gt;&gt;</span> <span class="ot">${REPOFILE}</span>
    <span class="kw">echo</span> enabled=1                 <span class="kw">&gt;&gt;</span> <span class="ot">${REPOFILE}</span>
    <span class="kw">sudo</span> chmod 755 /etc/yum.repos.d
    <span class="kw">sudo</span> yum clean all
<span class="kw">}</span>

<span class="kw">function</span><span class="fu"> download_etc</span> <span class="kw">{</span>
    <span class="kw">for</span> <span class="kw">url</span> in <span class="ot">${ETCFILES}</span><span class="kw">;</span> <span class="kw">do</span>
    <span class="ot">savefile=${ETCDIR}</span>/<span class="ot">$(</span><span class="kw">basename</span> <span class="ot">${url})</span>
    <span class="kw">if [</span> <span class="ot">!</span> <span class="ot">-e</span> <span class="ot">${savefile}</span><span class="kw"> ]</span>; <span class="kw">then</span>
        <span class="kw">sudo</span> curl <span class="ot">${url}</span> -o <span class="ot">${savefile}</span>
    <span class="kw">fi</span>
    <span class="kw">done</span>
<span class="kw">}</span>

<span class="kw">function</span><span class="fu"> main</span> <span class="kw">{</span>
    <span class="ot">SHAREDDIR=</span>/vagrant
    <span class="ot">DOWNLOADDIR=${SHAREDDIR}</span>/download

    <span class="ot">REPONAME=</span>localhost
    <span class="ot">YUMDIR=${DOWNLOADDIR}</span>/yum ; <span class="kw">sudo</span> mkdir -p <span class="ot">${YUMDIR}</span>
    <span class="ot">YUMPKGS=</span><span class="st">&quot;ansible git&quot;</span>

    <span class="ot">ETCDIR=${DOWNLOADDIR}</span>/etc ; <span class="kw">sudo</span> mkdir -p <span class="ot">${ETCDIR}</span>
    <span class="ot">ETCFILES=</span><span class="st">&quot;</span>
<span class="st">http://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-6</span>
<span class="st">http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span>
<span class="st">&quot;</span>

    <span class="kw">download_etc</span>
    <span class="kw">sudo</span> rpm --import file://<span class="ot">${ETCDIR}</span>/RPM-GPG-KEY-EPEL-6
    <span class="kw">sudo</span> rpm -ihv file://<span class="ot">${ETCDIR}</span>/epel-release-6-8.noarch.rpm

    <span class="kw">download_yum</span>
    <span class="kw">mk_repofile</span>
    <span class="kw">sudo</span> yum install -y --disablerepo=* --enablerepo=<span class="ot">${REPONAME}</span> <span class="ot">${YUMPKGS}</span>

<span class="kw">}</span>

<span class="kw">main</span></code></pre>
</div>


<h1 id="chef">CHEF</h1>
<h2 id="misc">MISC</h2>
<h3 id="create-cookbok">CREATE cookbok</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">knife</span> cookbook create app -o site-cookbooks</code></pre>
<h1 id="virualbox">VirualBox</h1>
<h2 id="image-1">image</h2>
<h3 id="from-vmware">from vmware</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">VBoxManage</span> clonehd --format VDI cyua.vmdk cyua.vdi</code></pre>
<h1 id="vagrant">VAGRANT</h1>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-vagrant',data:{label:''
,VAG_BOX_FILE: './package.box'
,VAG_BOX_NAME: 'centos65-x86_64-20131205'
,VAG_VM_NAME: 'vm1'
,VAG_VM_IP: 'VAG_VM_IP'
,VAG_SSH_PORT: 'VAG_SSH_PORT=\'2205\''
}});})</script>

<div id="app-vagrant">
<form class="form-horizontal">
<varin label="BOX FILE"     v-model="VAG_BOX_FILE"></varin> <varin label="BOX NAME"     v-model="VAG_BOX_NAME"></varin> <varin label="VM NAME"      v-model="VAG_VM_NAME"></varin> <varin label="VM STATIC IP" v-model="VAG_VM_IP"></varin> <varin label="VM SSH PORT"  v-model="VAG_SSH_PORT"></varin>
</form>

<h2 id="box">BOX</h2>
<h3 id="add-2">ADD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> box add <span class="dt">{{VAG_BOX_NAME}}</span> <span class="dt">{{VAG_BOX_FILE}}</span>
<span class="kw">vagrant</span> box list</code></pre>
<h3 id="vms-status">VMs STATUS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> global-status</code></pre>
<h2 id="guest">guest</h2>
<h3 id="scp-host-to-guest">scp host to guest</h3>
<pre class="sh"><code>vagrant ssh-config &gt; ssh.config &amp;&amp; scp -F ssh.config ./src.tgz vagrant@dummy-1:~</code></pre>
<h3 id="ssh-guest-to-guest">ssh guest to guest</h3>
<p>ゲスト上で公開鍵を作成(ssh-keygen -&gt; ~/.ssh/id_rsa.pub)し、 対向 guest に公開鍵&quot;内容&quot;を登録(~/.ssh/authorized_keys に追加ペースト)する。</p>
<h2 id="vagrantfile-1">Vagrantfile</h2>
<pre class="sourceCode ruby"><code class="sourceCode ruby"><span class="co"># -*- mode: ruby -*-</span>
<span class="co"># vi: set ft=ruby :</span>

<span class="dt">VAGRANTFILE_API_VERSION</span> = <span class="st">&quot;2&quot;</span>
<span class="dt">NUM_INSTANCES</span> = <span class="dv">3</span>
<span class="dt">BASE_IP_ADDR</span>  = <span class="dt">ENV</span>[<span class="st">&#39;BASE_IP_ADDR&#39;</span>] || <span class="st">&quot;192.168.100.10&quot;</span>

<span class="dt">Vagrant</span>.configure(<span class="dt">VAGRANTFILE_API_VERSION</span>) <span class="kw">do</span> |config|

  config.vm.box = <span class="st">&quot;centos/7&quot;</span>
  <span class="co"># config.vm.synced_folder &quot;~/src/&quot;, &quot;/vagrant/src&quot;</span>
  config.ssh.insert_key = <span class="dv">false</span>

  <span class="kw">if</span> <span class="dt">Vagrant</span>.has_plugin?(<span class="st">&quot;vagrant-vbguest&quot;</span>) <span class="kw">then</span>
    config.vbguest.auto_update = <span class="dv">false</span>
  <span class="kw">end</span>

  (<span class="dv">1</span>..<span class="dt">NUM_INSTANCES</span>).each <span class="kw">do</span> |i|
    config.vm.define <span class="st">&quot;dummy-</span><span class="ot">#{</span>i<span class="ot">}</span><span class="st">&quot;</span> <span class="kw">do</span> |dummy|
      dummy.vm.box_check_update = <span class="dv">false</span>
      dummy.vm.hostname = <span class="st">&quot;dummy-</span><span class="ot">#{</span>i<span class="ot">}</span><span class="st">&quot;</span>
      dummy.vm.network <span class="st">:private_network</span>, ip: <span class="st">&quot;</span><span class="ot">#{</span><span class="dt">BASE_IP_ADDR</span><span class="ot">}#{</span>i<span class="ot">}</span><span class="st">&quot;</span>
    <span class="kw">end</span>

    config.vm.provider <span class="st">&quot;virtualbox&quot;</span> <span class="kw">do</span> |vbox|
      vbox.gui = <span class="dv">false</span>
      vbox.customize [<span class="st">&quot;modifyvm&quot;</span>, <span class="st">:id</span>, <span class="st">&quot;--memory&quot;</span>, <span class="st">&quot;1000&quot;</span>]
    <span class="kw">end</span>

  <span class="kw">end</span>

<span class="kw">end</span></code></pre>
<h2 id="ssh-3">ssh</h2>
<h3 id="ssh-config">ssh config</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> up
<span class="kw">vagrant</span> ssh-config vm1  <span class="kw">&gt;&gt;</span> ~/.ssh/config
<span class="kw">vagrant</span> ssh-config vm2 <span class="kw">&gt;&gt;</span> ~/.ssh/config
<span class="kw">cat</span> ~/.ssh/config</code></pre>
<h2 id="provision">provision</h2>
<h3 id="with-chef">with chef</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> halt
<span class="kw">vagrant</span> sandbox on
<span class="kw">vagrant</span> up

<span class="kw">echo</span> vm1 vm2 <span class="kw">|</span> <span class="kw">xargs</span> -n 1 knife solo prepare

<span class="kw">vagrant</span> halt
<span class="kw">vagrant</span> sandbox commit
<span class="kw">vagrant</span> up

<span class="kw">echo</span> vm1 vm2 <span class="kw">|</span> <span class="kw">xargs</span> -n 1 knife solo cook</code></pre>
<h2 id="plug-in">PLUG-IN</h2>
<h3 id="sandbox">sandbox</h3>
<h4 id="sandboxモード開始">sandboxモード開始</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox on</code></pre>
<h4 id="変更を決定する">変更を決定する</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox commit</code></pre>
<h4 id="変更を破棄しロールバックする">変更を破棄し、ロールバックする</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox rollback</code></pre>
<h4 id="sandboxモード終了commitしていないものは破棄される">sandboxモード終了（commitしていないものは破棄される）</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox off</code></pre>
<h4 id="現在sandboxモードかどうかの確認">現在sandboxモードかどうかの確認</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox status</code></pre>
</div>

<h1 id="oracle">ORACLE</h1>
<h2 id="data-pump">DATA PUMP</h2>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-oradp',data:{label:''
,DP_SID: 'sid'
,DP_DMP: 'filename.dmp'
}});})</script>

<div id="app-oradp">
<form class="form-horizontal">
<varin label="SID"   v-model="DP_SID"></varin> <varin label="FILENAME"  v-model="DP_DMP"></varin>
</form>

<h3 id="export-1">EXPORT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">expdp</span> \
    <span class="kw">system</span>/<span class="kw">manager@</span><span class="dt">{{DP_SID}}</span> \
    <span class="ot">dumpfile=</span><span class="dt">{{DP_DMP}}</span> <span class="kw">\</span>
    <span class="ot">full=</span>Y <span class="kw">\</span>
    <span class="ot">content=</span>metadata_only <span class="kw">\</span>

    <span class="kw">SCHEMAS</span> \
    <span class="kw">TABLES</span> \
    <span class="ot">STATUS=</span>30 <span class="kw">\</span>
    <span class="ot">dumpfile=</span>dir_punp:<span class="dt">{{DP_DMP}}</span> <span class="kw">\</span></code></pre>
<p>DIR なければ、~oracle/admin/{{DP_SID}}/dpdump に落ちる</p>
<h3 id="import-1">IMPORT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">impdp</span> \
    <span class="kw">system</span>/<span class="kw">manager@</span><span class="dt">{{DP_SID}}</span> \
    <span class="ot">dumpfile=</span><span class="dt">{{DP_SID}}</span> <span class="kw">\</span>
    <span class="ot">STATUS=</span>30 <span class="kw">\</span>
    <span class="ot">table_exists_action=</span><span class="st">&#39;TRUNCATE&#39;</span> <span class="kw">\</span>
    <span class="ot">Parallel=</span>2 <span class="kw">\</span>
    <span class="ot">INCLUDE=</span>SCHEMA:<span class="st">&quot;KY,KX,REPADMIN,EQP,MNG&quot;</span>

    <span class="ot">INCLUDE=</span>SCHEMA:<span class="st">&quot;=&#39;in(&#39;KY&#39;,&#39;KX&#39;,&#39;EQP&#39;,&#39;REPADMIN&#39;,&#39;MNG&#39;)&#39;&quot;</span>


    <span class="ot">FULL=</span>N <span class="kw">\</span>

    <span class="ot">sqlfile=</span>kx.sql <span class="kw">\</span>
    <span class="ot">directory=</span>dir_punp <span class="kw">\</span>
    <span class="ot">EXCLUDE=</span>SCHEMA:<span class="st">&quot;=&#39;HR&#39;&quot;</span></code></pre>
<h3 id="mkdir-1">MKDIR</h3>
<p>DIR なければ、${ORACLE_HOME}/rdbms/log を探す。</p>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">or</span> <span class="kw">replace</span> <span class="kw">directory</span> dir_punp <span class="kw">as</span> <span class="st">&#39;/usr1/oradba/pump&#39;</span>;
<span class="co">-- grant read,write on directory dir_punp to ORAUSERNAME;</span>
<span class="co">-- commit;</span>
<span class="co">-- drop directory dir_punp</span></code></pre>
</div>


<h2 id="schema">SCHEMA</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlplus</span> /nolog</code></pre>
<h3 id="select-all">select all</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">conn system/manager@DBNAME <span class="kw">as</span> <span class="kw">sysdba</span>
<span class="co">--</span>
<span class="kw">select</span> username <span class="kw">from</span> dba_users;</code></pre>
<h3 id="not-defaults">NOT DEFAULTS</h3>
<p>たぶん</p>
<pre class="sourceCode sql"><code class="sourceCode sql">conn system/manager@DBNAME <span class="kw">as</span> <span class="kw">sysdba</span>
<span class="co">--</span>
<span class="kw">select</span> username <span class="kw">from</span> DBA_USERS
<span class="kw">where</span>
    initial_rsrc_consumer_group != <span class="st">&#39;SYS_GROUP&#39;</span>
<span class="kw">and</span> default_tablespace <span class="kw">not</span> <span class="kw">like</span> <span class="st">&#39;SYS%&#39;</span>
<span class="kw">and</span> account_status = <span class="st">&#39;OPEN&#39;</span>;</code></pre>
<h2 id="names">NAMES</h2>
<h3 id="global-db">global db</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> * <span class="kw">from</span> <span class="kw">global_name</span>;</code></pre>
<h3 id="db">DB</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> <span class="fu">sys_context</span>(<span class="st">&#39;USERENV&#39;</span>,<span class="st">&#39;db_name&#39;</span>) <span class="kw">from</span> dual;</code></pre>
<h3 id="instance">instance</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> <span class="fu">sys_context</span>(<span class="st">&#39;USERENV&#39;</span>,<span class="st">&#39;instance_name&#39;</span>) <span class="kw">from</span> dual;</code></pre>
<h3 id="current-user">current user</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> <span class="fu">user</span> <span class="kw">from</span> dual;</code></pre>
<h2 id="proc">PROC</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">PROC</th>
<th style="text-align: left;">NAME</th>
<th style="text-align: center;">WHAT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ora_j</td>
<td style="text-align: left;">?</td>
<td style="text-align: center;">ジョブ関連</td>
</tr>
<tr class="even">
<td style="text-align: left;">ora_smon</td>
<td style="text-align: left;">システムモニタ</td>
<td style="text-align: center;">インスタンス回復、デフラグ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ora_dbw</td>
<td style="text-align: left;">?</td>
<td style="text-align: center;">バッファ・キャッシュからデータファイルへの書込み</td>
</tr>
<tr class="even">
<td style="text-align: left;">ora_lsm</td>
<td style="text-align: left;">?</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ora_mmon</td>
<td style="text-align: left;">管理モニタ?</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="even">
<td style="text-align: left;">ora_cjq</td>
<td style="text-align: left;">?</td>
<td style="text-align: center;">?</td>
</tr>
</tbody>
</table>
<h2 id="setting">SETTING</h2>
<h3 id="tnsnames.ora">TNSNAMES.ORA</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cat</span> <span class="ot">$ORACLE_HOME</span>/network/admin/tnsnames.ora</code></pre>
<h3 id="tnsnames.ora-listener.ora">TNSNAMES.ora, LISTENER.ora</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> <span class="ot">$ORACLE_HOME</span>/network/admin</code></pre>
<h3 id="stop-start-restart">STOP, START, RESTART</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> dbora stop
<span class="kw">service</span> dbora start
<span class="kw">service</span> dbora restart</code></pre>
<h2 id="sqlplus">SQLPLUS</h2>
<h3 id="exec-.sql">exec *.sql</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlplus</span> <span class="kw">&lt;</span>USER<span class="kw">&gt;</span>/<span class="kw">&lt;</span>PASS<span class="kw">&gt;</span>@<span class="kw">&lt;</span>TNSNAME<span class="kw">&gt;</span> @<span class="kw">&lt;</span>FILE<span class="kw">&gt;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlplus</span> <span class="kw">&lt;</span>USER<span class="kw">&gt;</span>/<span class="kw">&lt;</span>PASS<span class="kw">&gt;</span>@<span class="kw">&lt;</span>SID<span class="kw">&gt;</span> @<span class="kw">&lt;</span>FILE<span class="kw">&gt;</span></code></pre>
<h3 id="csv">CSV</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">set</span> colsep <span class="st">&#39;,&#39;</span>
<span class="kw">set</span> pagesize <span class="dv">0</span>
<span class="kw">set</span> trimspool <span class="kw">off</span>
<span class="kw">set</span> headsep <span class="kw">off</span>
<span class="kw">set</span> linesize <span class="dv">32767</span>
<span class="kw">set</span> feedback <span class="kw">off</span>
<span class="co">-- set numw X</span></code></pre>
<h2 id="enterprise-manager">Enterprise Manager</h2>
<h3 id="updown-1">UP/DOWN</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">emctl</span> start dbconsole
<span class="kw">emctl</span> stop dbconsole</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">ORACLE_UNQNAME=</span>KX <span class="kw">emctl</span> start dbconsole</code></pre>
<h2 id="sql">SQL</h2>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-sql',data:{label:''
,ORA_TAB_NAME: 'TABNAME'
}});})</script>

<div id="app-sql">
<form class="form-horizontal">
<varin label="TAB NAME"     v-model="ORA_TAB_NAME"></varin>
</form>


<h3 id="insert">insert</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">insert</span> <span class="kw">into</span> {{ORA_TAB_NAME}} (&lt;COL1&gt; ,&lt;COL2&gt;) <span class="kw">values</span> (&lt;COL1VAL&gt;,&lt;COL2VAL&gt;);</code></pre>
<h3 id="update">update</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">update</span> {{ORA_TAB_NAME}} <span class="kw">set</span> &lt;COL1&gt;=<span class="st">&#39;AAA&#39;</span> , &lt;COL2&gt;=<span class="st">&#39;BBB&#39;</span> <span class="kw">where</span> &lt;COL3&gt;=<span class="st">&#39;ZZZ&#39;</span>;</code></pre>
<h3 id="prime">PRIME?</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> column_name <span class="kw">from</span> user_cons_columns
<span class="kw">where</span> constraint_name = (
      <span class="kw">select</span> constraint_name <span class="kw">from</span> user_constraints
      <span class="kw">where</span> table_name = <span class="st">&#39;&quot; + {{ORA_TAB_NAME}} + &quot;&#39;</span> <span class="kw">and</span> constraint_type = <span class="st">&#39;P&#39;</span>
)</code></pre>
</div>

<h3 id="get-instance-name">get instance name</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> <span class="fu">sys_context</span>(<span class="st">&#39;USERENV&#39;</span>, <span class="st">&#39;instance_name&#39;</span>) <span class="kw">from</span> dual;</code></pre>
<h3 id="db-link">DB Link</h3>
<h4 id="connect-3">connect</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlplus</span> sys/manager@<span class="kw">&lt;</span>db<span class="kw">&gt;</span> as sysdba</code></pre>
<h4 id="show-status">show status</h4>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">set</span> linesize <span class="dv">100</span>
col OWNER    format a10
col DB_LINK  format a20
col USERNAME format a10
col HOST     format a15
col CREATED  format a20
col <span class="kw">PASSWORD</span> format a20
<span class="kw">select</span> * <span class="kw">from</span> dba_db_links;</code></pre>
<h4 id="create-3">create</h4>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">PUBLIC</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> &lt;LINKNAME&gt;
<span class="kw">connect</span> <span class="kw">to</span> &lt;USER&gt; <span class="kw">identified</span> <span class="kw">by</span> &lt;PASS&gt;
<span class="kw">using</span> <span class="st">&#39;&lt;DB&gt;&#39;</span>;</code></pre>
<h3 id="get-object-source">get object source</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span>
  dbms_metadata.get_ddl (
     &lt;OBJECT_TYPE&gt;
   , &lt;OBJECT_NAME&gt;
   , &lt;OWNER&gt;
  )
<span class="kw">from</span>
  dual
;

<span class="co">-- database link</span>
<span class="kw">select</span>
  dbms_metadata.get_ddl (
     <span class="st">&#39;db_link&#39;</span>
   , &lt;OBJECT_NAME&gt;
   , <span class="st">&#39;public&#39;</span>
  )
<span class="kw">from</span>
  dual
;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CONNECT</span> sys/manager@DBNAME <span class="kw">AS</span> <span class="kw">SYSDBA</span>
<span class="kw">SET</span> ECHO <span class="kw">ON</span>
<span class="kw">SET</span> SERVEROUTPUT <span class="kw">ON</span>
<span class="kw">BEGIN</span>
<span class="kw">for</span> obj <span class="kw">in</span> (<span class="kw">select</span> <span class="kw">replace</span>(OBJECT_TYPE,<span class="st">&#39; &#39;</span>, <span class="st">&#39;_&#39;</span>) <span class="kw">as</span> OBJECT_TYPE, OBJECT_NAME, OWNER <span class="kw">from</span> dba_objects <span class="kw">where</span> OWNER=<span class="st">&#39;OWNNAME&#39;</span> <span class="kw">and</span> OBJECT_TYPE != <span class="st">&#39;DATABASE LINK&#39;</span>) <span class="kw">loop</span>
    DBMS_OUTPUT.PUT_LINE(<span class="st">&#39;{TYPE:&#39;</span> || obj.OBJECT_TYPE || <span class="st">&#39; ,NAME:&#39;</span> || obj.OBJECT_NAME || <span class="st">&#39;, OWNER:&#39;</span> || obj.OWNER || <span class="st">&#39;}&#39;</span>);
    <span class="kw">for</span> rec <span class="kw">in</span> (<span class="kw">select</span> dbms_metadata.get_ddl(obj.OBJECT_TYPE, obj.OBJECT_NAME, obj.OWNER) <span class="kw">as</span> <span class="kw">ddl</span> <span class="kw">from</span> dual) <span class="kw">loop</span>
        DBMS_OUTPUT.PUT_LINE(rec.ddl);
    <span class="kw">end</span> <span class="kw">loop</span>;
<span class="kw">end</span> <span class="kw">loop</span>;
<span class="kw">END</span>;
/
exit</code></pre>
<h2 id="multi-master-replication">MULTI MASTER REPLICATION</h2>
<script>window.addEventListener('load', function () {
new Vue({el:'#app-ora-mmr',data:{label:''
,ORA_REPSITE_A: 'AAA'
,ORA_REPSITE_B: 'BBB'
,ORA_REPTNSNAME: 'DB'
,ORA_REP_TABNAME: 'TABLENAME'
}});})</script>

<div id="app-ora-mmr">
<form class="form-horizontal">
<varin label="SITE A"  v-model="ORA_REPSITE_A"></varin> <varin label="SITE B"  v-model="ORA_REPSITE_B"></varin> <varin label="TNS"     v-model="ORA_REPTNSNAME"></varin> <varin label="TABLE"   v-model="ORA_REP_TABNAME"></varin>
</form>


<h3 id="sqlplus-1">SQLPLUS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlplus</span> /nolog</code></pre>
<h3 id="create-repadmin">CREATE REPADMIN</h3>
<h4 id="ora_repsite_a">{{ORA_REPSITE_A}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="kw">CREATE</span> <span class="fu">USER</span> repadmin <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">COMMENT</span> <span class="kw">ANY</span> <span class="kw">TABLE</span> <span class="kw">TO</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">LOCK</span> <span class="kw">ANY</span> <span class="kw">TABLE</span> <span class="kw">TO</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">SELECT</span> <span class="kw">ANY</span> <span class="kw">DICTIONARY</span> <span class="kw">TO</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">EXECUTE</span> <span class="kw">ANY</span> <span class="kw">PROCEDURE</span> <span class="kw">TO</span> repadmin;
<span class="kw">EXEC</span> Dbms_Repcat_Admin.Grant_Admin_Any_Repgroup(<span class="st">&#39;repadmin&#39;</span>);
<span class="kw">EXEC</span> Dbms_Repcat_Admin.Grant_Admin_Any_Schema (username =&gt; <span class="st">&#39;repadmin&#39;</span>);

<span class="co">-- プロパゲータ（送信者ロール）を登録</span>
<span class="kw">EXEC</span> DBMS_DEFER_SYS.REGISTER_PROPAGATOR(<span class="st">&#39;repadmin&#39;</span>);

<span class="co">-- 受信者（ロール）を登録</span>
<span class="kw">BEGIN</span>
   DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (
      username       =&gt; <span class="st">&#39;repadmin&#39;</span>,
      privilege_type =&gt; <span class="st">&#39;receiver&#39;</span>,
      list_of_gnames =&gt; <span class="kw">NULL</span>);
<span class="kw">END</span>;
/</code></pre>
<h4 id="ora_repsite_b">{{ORA_REPSITE_B}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="co">--</span>
<span class="co">-- same {{ORA_REPSITE_A}}</span>
<span class="co">--</span></code></pre>
<h3 id="create-database-link">CREATE DATABASE LINK</h3>
<h4 id="ora_repsite_a-1">{{ORA_REPSITE_A}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="kw">CREATE</span> <span class="kw">PUBLIC</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}} <span class="kw">USING</span> <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}
<span class="kw">CONNECT</span> <span class="kw">TO</span> repadmin <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> repadmin <span class="kw">using</span> <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<h4 id="ora_repsite_b-1">{{ORA_REPSITE_B}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span> <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="kw">CREATE</span> <span class="kw">PUBLIC</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}} <span class="kw">USING</span> <span class="st">&#39;{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}

<span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}
<span class="kw">CONNECT</span> <span class="kw">TO</span> repadmin <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> repadmin <span class="kw">using</span> <span class="st">&#39;{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<h3 id="create-job">CREATE JOB</h3>
<h4 id="ora_repsite_a-2">{{ORA_REPSITE_A}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PURGE (
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">24</span>),
      <span class="dt">interval</span> =&gt; <span class="st">&#39;SYSDATE + (1/24)&#39;</span>,
      delay_seconds =&gt; <span class="dv">0</span>,
      rollback_segment =&gt; <span class="st">&#39;&#39;</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/24 = １時間</span>

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PUSH(
      destination =&gt; <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}.WORLD&#39;</span>,
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">8640</span>),
      <span class="dt">interval</span>  =&gt; <span class="st">&#39;SYSDATE + (1/8640)&#39;</span>,
      parallelism =&gt; <span class="dv">1</span>,
      delay_seconds =&gt; <span class="dv">0</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/8640 = 10sec</span></code></pre>
<h4 id="ora_repsite_b-2">{{ORA_REPSITE_B}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PURGE (
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">24</span>),
      <span class="dt">interval</span> =&gt; <span class="st">&#39;SYSDATE + (1/24)&#39;</span>,
      delay_seconds =&gt; <span class="dv">0</span>,
      rollback_segment =&gt; <span class="st">&#39;&#39;</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/24 = １時間</span>

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PUSH(
      destination =&gt; <span class="st">&#39;{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}.WORLD&#39;</span>,
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">8640</span>),
      <span class="dt">interval</span>  =&gt; <span class="st">&#39;SYSDATE + (1/8640)&#39;</span>,
      parallelism =&gt; <span class="dv">1</span>,
      delay_seconds =&gt; <span class="dv">0</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/8640 = 10sec</span></code></pre>
<h4 id="check-1">Check</h4>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="co">-- conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}</span>

<span class="kw">set</span> linesize <span class="dv">150</span>
col job    format <span class="st">&#39;00000&#39;</span>
col what  format a65
col SCHEMA_USER format a10
col LAST_DATE format a10
col THIS_DATE format a10
col NEXT_DATE format a10
col <span class="dt">INTERVAL</span> format a10
<span class="kw">select</span> job,BROKEN,SCHEMA_USER,LAST_DATE,THIS_DATE,NEXT_DATE,
 <span class="dt">INTERVAL</span>, what <span class="kw">from</span> user_jobs;</code></pre>
<h3 id="create-replication-group">CREATE REPLICATION GROUP</h3>
<h4 id="ora_repsite_a-only">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">EXEC</span> DBMS_REPCAT.CREATE_MASTER_REPGROUP(<span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>);

<span class="kw">BEGIN</span>
   DBMS_REPCAT.ADD_MASTER_DATABASE (
      gname     =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>,
      <span class="kw">master</span>    =&gt; <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}&#39;</span>,
      use_existing_objects =&gt; <span class="kw">TRUE</span>,
      copy_rows =&gt; <span class="kw">FALSE</span>,
      propagation_mode =&gt; <span class="st">&#39;ASYNCHRONOUS&#39;</span>
   );
<span class="kw">END</span>;
/</code></pre>
<h3 id="add-object">ADD OBJECT</h3>
<h4 id="ora_repsite_a-only-1">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">begin</span> DBMS_REPCAT.CREATE_MASTER_REPOBJECT (
  gname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>
, <span class="kw">type</span> =&gt; <span class="st">&#39;TABLE&#39;</span>
, oname =&gt; <span class="st">&#39;{{ORA_REP_TABNAME}}&#39;</span>
, sname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}&#39;</span>
, use_existing_object =&gt; <span class="kw">TRUE</span>  <span class="co">-- 既存のオブジェクトを使用</span>
, copy_rows =&gt; <span class="kw">FALSE</span>           <span class="co">-- データのコピー</span>
);
<span class="kw">end</span>;
/

<span class="co">--（対象テーブル全部を登録する）</span></code></pre>
<h3 id="generate-replication-support">GENERATE REPLICATION SUPPORT</h3>
<h4 id="ora_repsite_a-only-2">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">begin</span> DBMS_REPCAT.GENERATE_REPLICATION_SUPPORT (
  sname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}&#39;</span>
, oname =&gt; <span class="st">&#39;{{ORA_REP_TABNAME}}&#39;</span>
, <span class="kw">type</span> =&gt; <span class="st">&#39;TABLE&#39;</span>
, min_communication =&gt; <span class="kw">TRUE</span>);
<span class="kw">end</span>;
/</code></pre>
<h3 id="start-replication">START REPLICATION</h3>
<h4 id="ora_repsite_a-only-3">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">exec</span> dbms_repcat.resume_master_activity(gname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>);</code></pre>
<h3 id="stop-replication">STOP REPLICATION</h3>
<h4 id="ora_repsite_a-only-4">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">exec</span> dbms_repcat.suspend_master_activity(gname=&gt;<span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>);</code></pre>
</div>
<script src="asset/vue.min.js"></script>
<script src="js/memo.js"></script>
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
</body>
</html>
