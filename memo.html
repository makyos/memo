<!DOCTYPE html>
<html ng-app>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title></title>


  <script src="./angular.min.js"></script>

  <link rel="stylesheet" href="./bootstrap-3.1.1-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="./bootstrap-3.1.1-dist/css/bootstrap-theme.min.css">

  <script src="vis/dist/vis.js"></script>
  <link href="vis/dist/vis.css" rel="stylesheet" type="text/css" />

  <script src="./memo.js"></script>
  <link rel="stylesheet" href="./memo.css">

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body  ng-controller="memoCtrl">
<h1 id="python">PYTHON</h1>
<h2 id="date-time">DATE &amp; TIME</h2>
<h3 id="what-time-now">what time now</h3>
<pre class="sourceCode python"><code class="sourceCode python"><span class="ch">import</span> datetime
datetime.datetime.today().strftime(<span class="st">&#39;%Y-%m-</span><span class="ot">%d</span><span class="st">_%H-%M-%S&#39;</span>)</code></pre>
<h1 id="crudsqlrest">CRUD/SQL/REST</h1>
<h2 id="basics">BASICs</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">OPE</th>
<th style="text-align: left;">CRUD</th>
<th style="text-align: left;">SQL</th>
<th style="text-align: left;">REST</th>
<th style="text-align: left;">$http</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">追加</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">insert</td>
<td style="text-align: left;">post</td>
<td style="text-align: left;">BODY</td>
</tr>
<tr class="even">
<td style="text-align: left;">取得</td>
<td style="text-align: left;">Read</td>
<td style="text-align: left;">select</td>
<td style="text-align: left;">get</td>
<td style="text-align: left;">URI</td>
</tr>
<tr class="odd">
<td style="text-align: left;">更新</td>
<td style="text-align: left;">Update</td>
<td style="text-align: left;">update</td>
<td style="text-align: left;">put</td>
<td style="text-align: left;">BODY</td>
</tr>
<tr class="even">
<td style="text-align: left;">削除</td>
<td style="text-align: left;">Delete</td>
<td style="text-align: left;">delete</td>
<td style="text-align: left;">delete</td>
<td style="text-align: left;">URI</td>
</tr>
</tbody>
</table>
<h1 id="nkf">NKF</h1>
<h3 id="改行変換">改行変換</h3>
<h4 id="from-win">from Win</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">nkf</span> -Lu AAA.txt</code></pre>
<h1 id="wget">WGET</h1>
<h2 id="ftp">FTP</h2>
<h3 id="ftp-get">FTP GET</h3>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">SERVER NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="WGET_FTP_SERVER" ng-init="WGET_FTP_SERVER='SERVER'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">FTP USER</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="WGET_FTP_USER" ng-init="WGET_FTP_USER='user'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">FTP PASSWORD</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="WGET_FTP_PASS" ng-init="WGET_FTP_PASS='passwd'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">get FILE</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="WGET_GET_FILE" ng-init="WGET_GET_FILE='filename'">
</div>
</div>
</form>

<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">wget</span> --ftp-user=<span class="dt">{{WGET_FTP_USER}}</span> --ftp-password=<span class="dt">{{WGET_FTP_PASS}}</span> ftp://<span class="dt">{{WGET_FTP_SERVER}}/{{WGET_GET_FILE}}</span></code></pre>
<h1 id="sqlite3">SQLITE3</h1>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">DATABASE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="SQLITE_DB_NAME" ng-init="SQLITE_DB_NAME='./mnt'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">TABLE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="SQLITE_TAB_NAME" ng-init="SQLITE_TAB_NAME='TAB'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">SQL FILE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="SQLITE_SQL_FILE" ng-init="SQLITE_SQL_FILE='AAA.sql'">
</div>
</div>
</form>

<h2 id="database">DATABASE</h2>
<h3 id="createconnect-database">create/connect DATABASE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlite3</span> <span class="dt">{{SQLITE_DB_NAME}}</span>.sqlite3</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">.databases</code></pre>
<h2 id="table">TABLE</h2>
<h3 id="csv-data-import">CSV DATA IMPORT</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.separator ,
.import <span class="kw">FILE</span> TAB</code></pre>
<h3 id="list">LIST</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.tables</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> name <span class="kw">from</span> sqlite_master <span class="kw">where</span> type=<span class="st">&#39;table&#39;</span> <span class="kw">order</span> <span class="kw">by</span> name;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> <span class="st">&#39;.import ./csv/&#39;</span> || name || <span class="st">&#39;.csv &#39;</span> || name <span class="kw">from</span> sqlite_master <span class="kw">where</span> type=<span class="st">&#39;table&#39;</span> <span class="kw">order</span> <span class="kw">by</span> name;</code></pre>
<h3 id="sql-from-file">SQL from FILE</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.read {{SQLITE_SQL_FILE}}</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">sqlite3 {{SQLITE_DB_NAME}} &lt; {{SQLITE_SQL_FILE}}</code></pre>
<h3 id="create">CREATE</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> {{SQLITE_TAB_NAME}} (
    <span class="kw">id</span> <span class="dt">integer</span> <span class="kw">not</span> <span class="kw">null</span> <span class="kw">primary</span> <span class="kw">key</span>
  , name text
  , notype
  , ts <span class="dt">timestamp</span> <span class="kw">default</span> (datetime(<span class="st">&#39;now&#39;</span>, <span class="st">&#39;localtaime&#39;</span>))
);</code></pre>
<h3 id="drop">DROP</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> {{SQLITE_TAB_NAME}};</code></pre>
<h3 id="source">SOURCE</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.schema {{SQLITE_TAB_NAME}}</code></pre>
<h1 id="emacs">EMACS</h1>
<h3 id="rect">RECT</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">key</th>
<th style="text-align: center;">move</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">C-x r k</td>
<td style="text-align: center;">矩形領域カット</td>
</tr>
<tr class="even">
<td style="text-align: center;">C-x r y</td>
<td style="text-align: center;">矩形領域ペースト</td>
</tr>
</tbody>
</table>
<h3 id="packeage">PACKEAGE</h3>
<p>M-x packeage-list-packeage</p>
<h1 id="escape-text">ESCAPE TEXT</h1>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">TEXT</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ESC_INPUT" ng-init="ESC_INPUT='http://hellowork/jobs'">
</div>
</div>
</form>

<pre class="sourceCode bash"><code class="sourceCode bash"><span class="dt">{{esc_ret()}}</span></code></pre>
<h1 id="ruby">RUBY</h1>
<h2 id="rbenv">rbenv</h2>
<h3 id="install">install</h3>
<p>git clone</p>
<h3 id="available-versions">available versions</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">rbenv</span> install --list</code></pre>
<h3 id="install-1">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">rbenv</span> install 2.1.2</code></pre>
<h3 id="init">init</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">rbenv</span> global 2.1.2</code></pre>
<h2 id="ruby-build">ruby-build</h2>
<h3 id="install-2">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> clone https://github.com/sstephenson/ruby-build.git .ruby-build
<span class="kw">.ruby-build/install.sh</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">rm</span> -fr .ruby-build</code></pre>
<h3 id="install-version">install version</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ruby-build</span> 2.1.2 /usr/local</code></pre>
<h1 id="linux">LINUX</h1>
<h2 id="use-disc-media">USE DISC MEDIA</h2>
<form class="form-horizontal">
<div class="form-group">
<label class="control-label col-xs-6">FILE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ISO_FILEPATH" ng-init="ISO_FILEPATH='/filename.iso'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">MOUNT POINT</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ISO_MOUNTPOINT" ng-init="ISO_MOUNTPOINT='/mnt/dvd'">
</div>
</div>
</form>



<h3 id="disc-to-iso-file">DISC to ISO FILE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> /dev/dvd of=<span class="dt">{{ISO_FILEPATH}}</span></code></pre>
<h3 id="mount-iso-file">MOUNT ISO FILE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mkdir</span> -p <span class="dt">{{ISO_MOUNTPOINT}}</span>
<span class="kw">mount</span> -t iso9660 -o loop <span class="dt">{{ISO_FILEPATH}}</span> <span class="dt">{{ISO_MOUNTPOINT}}</span></code></pre>
<p>umount</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">umount</span> <span class="dt">{{ISO_MOUNTPOINT}}</span></code></pre>
<p>永続化</p>
<h6 id="etcfstab">/etc/fstab</h6>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> <span class="st">&quot;{{ISO_FILEPATH}} {{ISO_MOUNTPOINT}} iso9660 loop,ro,auto 0 0&quot;</span> <span class="kw">&gt;&gt;</span> /etc/fstab
<span class="kw">cat</span> /etc/fstab
<span class="kw">mount</span> -a</code></pre>
<h2 id="lock-tray">LOCK TRAY?</h2>
<p>VirtualBox やらの VM が邪魔してる場合あり。とめよ。</p>
<h2 id="make-swap">MAKE SWAP</h2>
<h3 id="on-file">on FILE</h3>
<form class="form-horizontal">
<div class="form-group">
<label class="control-label col-xs-6">SWAP FILE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="LINUX_SWAP_FILE" ng-init="LINUX_SWAP_FILE='/swapfile'">
</div>
</div>
</form>

<p>example 255MB(4096x65536)</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> if=/dev/zero  of=<span class="dt">{{LINUX_SWAP_FILE}}</span> bs=4096 count=65536
<span class="ot">mkswap=</span><span class="dt">{{LINUX_SWAP_FILE}}</span>
<span class="kw">chmod</span> 600 <span class="dt">{{LINUX_SWAP_FILE}}</span>
<span class="kw">swapon</span> <span class="dt">{{LINUX_SWAP_FILE}}</span></code></pre>
<h4 id="etcfstab-1">/etc/fstab</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="dt">{{LINUX_SWAP_FILE}}</span> <span class="kw">swap</span> swap defaults</code></pre>
<h1 id="tmux">TMUX</h1>
<h2 id="new">NEW</h2>
<pre><code>tmux new -s &lt;session&gt;</code></pre>
<h2 id="kill">KILL</h2>
<pre><code>tmux kill-session -t &lt;session&gt;</code></pre>
<h1 id="git">GIT</h1>
<form class="form-horizontal">
<div class="form-group">
<label class="control-label col-sm-6">REPO NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_REPONAME" ng-init="GIT_REPONAME='dir/name.git'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">REPO ROOT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_ROOT" ng-init="GIT_ROOT='/var/lib/git'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">GIT SERVER NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_REMOTE" ng-init="GIT_REMOTE='192.168.0.10'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">GIT SERVER USER</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_USER" ng-init="GIT_USER='git'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">GIT SERVER SSH PORT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_SSH" ng-init="GIT_SSH='2203'">
</div>
</div>
</form>



<h2 id="on-the-serverremote">on the SERVER(REMOTE)</h2>
<h3 id="create-remote-rep.">CREATE REMOTE REP.</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> mkdir -p <span class="dt">{{GIT_ROOT}}/{{GIT_REPONAME}}</span>
<span class="kw">cd</span> <span class="dt">{{GIT_ROOT}}/{{GIT_REPONAME}}</span>
<span class="kw">sudo</span> git init --bare --shared
<span class="kw">sudo</span> chown -R root:git .
<span class="kw">ls</span> -la</code></pre>
<h2 id="on-the-clientlocal">on the CLIENT(LOCAL)</h2>
<h3 id="create-local-rep.">CREATE LOCAL REP.</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> init
<span class="kw">git</span> add .
<span class="kw">git</span> commit -m <span class="st">&quot;1st&quot;</span></code></pre>
<h3 id="push-to-remote">PUSH to REMOTE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> remote add origin ssh://<span class="dt">{{GIT_USER}}@{{GIT_REMOTE}}:{{GIT_SSH}}{{GIT_ROOT}}/{{GIT_REPONAME}}</span>
<span class="kw">git</span> push origin master</code></pre>
<h3 id="clone">CLONE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> clone ssh://<span class="dt">{{GIT_USER}}@{{GIT_REMOTE}}:{{GIT_SSH}}{{GIT_ROOT}}/{{GIT_REPONAME}}</span></code></pre>
<h3 id="commit">COMMIT</h3>
<form class="form-horizontal">
<div class="form-group">
<label class="control-label col-sm-6">COMMIT COMMENT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_COMMENT" ng-init="GIT_COMMENT='テストコミット'">
</div>
</div>
</form>


<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> add .
<span class="kw">git</span> commit -a -m <span class="st">&quot;{{GIT_COMMENT}}&quot;</span></code></pre>
<h3 id="commit-log">COMMIT LOG</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> log</code></pre>
<h3 id="push">PUSH</h3>
<pre><code>git push origin master</code></pre>
<h3 id="pull">PULL</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">git</span> pull origin master</code></pre>
<h1 id="docker">DOCKER</h1>
<h2 id="misc">MISC</h2>
<h3 id="install-3">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> install -y docker-io.x86_64</code></pre>
<h3 id="ps">PS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">watch</span> -n 2 <span class="st">&#39;df -h; echo; free -m; echo; docker ps -a|head; echo; docker images -a&#39;</span></code></pre>
<h2 id="dockerfile">DOCKERFILE</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">FROM</span> centos:latest

<span class="co"># EPEL</span>
<span class="kw">RUN</span> rpm -i http://ftp.riken.jp/Linux/fedora/epel/6/i386/epel-release-6-8.noarch.rpm
<span class="kw">RUN</span> rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
<span class="kw">RUN</span> yum clean metadata

<span class="co"># yum</span>
<span class="kw">RUN</span> yum --enablerepo=epel install -y \
    <span class="kw">make</span> \
    <span class="kw">gcc</span> \
    <span class="kw">zlib-devel</span> \
    <span class="kw">openssl-devel</span> \
    <span class="kw">readline-devel</span> \
    <span class="kw">ncurses-devel</span> \
    <span class="kw">gdbm-devel</span> \
    <span class="kw">db4-devel</span> \
    <span class="kw">libffi-devel</span> \
    <span class="kw">tk-devel</span> \
    <span class="kw">libyaml-devel</span> \
    <span class="kw">tar</span> \
    <span class="kw">git</span>

<span class="co"># Install ruby-build</span>
<span class="kw">RUN</span> git clone https://github.com/sstephenson/ruby-build.git .ruby-build
<span class="kw">RUN</span> .ruby-build/install.sh
<span class="kw">RUN</span> rm -fr .ruby-build

<span class="co"># Install ruby</span>
<span class="kw">RUN</span> ruby-build 2.1.2 /usr/local

<span class="co"># Install bundler</span>
<span class="kw">RUN</span> gem update --system
<span class="kw">RUN</span> gem install bundler --no-rdoc --no-ri</code></pre>
<h3 id="port-forward">port forward</h3>
<h4 id="vsftpd">vsftpd</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">pasv_enable=</span>YES
<span class="ot">pasv_min_port=</span>20
<span class="ot">pasv_max_port=</span>20
<span class="ot">pasv_address=</span><span class="dt">{global_ip_address}</span>

<span class="kw">iptables</span> -I FORWARD -p tcp --dport 20 -j ACCEPT</code></pre>
<h2 id="command-graph">COMMAND GRAPH</h2>
<div id="docker_graph" style="width: 100%; height: 300px; border: 1px solid lightgray;">
<div id="graph-navigation_wrapper" style="position: absolute; width: 100%; height: 300px;">
<pre><code>&lt;div id=&quot;graph-navigation_zoomExtends&quot; class=&quot;graph-navigation zoomExtends&quot;&gt;
&lt;/div&gt;</code></pre>
</div>
<div class="graph-frame" style="position: relative; overflow: hidden; width: 100%; height: 100%;">
<pre><code>&lt;canvas style=&quot;position: relative; -webkit-user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%&quot;&gt;&lt;/canvas&gt;</code></pre>
</div>
</div>
<script type="text/javascript">
var container = document.getElementById('docker_graph');
var data = {dot: 'digraph { \
\
REGISTER   [shape=box,fontColor=white,color=red]; \
Dockerfile [shape=box,fontColor=white,color=red]; \
IMAGE      [shape=box]; \
CONTAINER  [shape=box]; \
Running    [shape=circle]; \
Stoped     [shape=circle]; \
SAVEFILE   [shape=box]; \
EXPORTFILE [shape=box]; \
\
Dockerfile -- build -> IMAGE; \
\
REGISTER -- pull -> IMAGE ; \
REGISTER -- login  ; \
REGISTER -- search ; \
REGISTER -- tag    ; \
\
IMAGE -- push -> REGISTER  ; \
IMAGE -- run  -> CONTAINER ; \
IMAGE -- save -> SAVEFILE -- LOAD -> IMAGE ; \
IMAGE -- history ; \
IMAGE -- images  ; \
IMAGE -- insert  ; \
IMAGE -- rmi     ; \
IMAGE -- load    ; \
IMAGE -- inspect ; \
\
CONTAINER -- commit -> IMAGE      ; \
CONTAINER -- export -> EXPORTFILE -- import -> IMAGE ; \
CONTAINER -- Running ; \
CONTAINER -- Stoped  ; \
CONTAINER -- inspect ; \
CONTAINER -- logs    ; \
CONTAINER -- port    ; \
CONTAINER -- ps      ; \
CONTAINER -- diff    ; \
\
Running  -- attach   ; \
Running  -- cp       ; \
Running  -- top      ; \
Running  -- stop     [dir = none, weight = 100]; \
Running  -- kill     ; \
Running  -- restart  ; \
Running  -- wait     ; \
\
Stoped -- start -> Running ; \
Stoped -- rm ;    \
\
}'};
var graph = new vis.Graph(container, data);
</script>




<h2 id="use">USE</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">TARG REPOSITORY</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="DOCKER_TARG_REPO" ng-init="DOCKER_TARG_REPO='ubuntu'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">TARG TAG</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="DOCKER_TARG_TAG" ng-init="DOCKER_TARG_TAG='ruby2'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">IMAGE ID</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="DOCKER_IMAGE_ID" ng-init="DOCKER_IMAGE_ID='${IMAGE_ID}'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">CONTAINER ID</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="DOCKER_CONTAINER_ID" ng-init="DOCKER_CONTAINER_ID='${CONTAINER_ID}'">
</div>
</div>
</form>



<h3 id="build">BUILD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> build -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> .</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> build --rm=true -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> .</code></pre>
<h3 id="run-stop">RUN / STOP</h3>
<h4 id="run">RUN</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -i -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> /bin/bash</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run -i -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> /usr/sbin/sshd -D</code></pre>
<h4 id="stop">STOP</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> stop <span class="dt">{{DOCKER_CONTAINER_ID}}</span></code></pre>
<h4 id="all-stop">ALL STOP</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> stop <span class="kw">`docker</span> ps -aq<span class="kw">`</span></code></pre>
<h3 id="commit-1">COMMIT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> commit <span class="dt">{{DOCKER_CONTAINER_ID}}</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span></code></pre>
<h3 id="export-import">EXPORT / IMPORT</h3>
<p>差分統合される。</p>
<h4 id="export">EXPORT</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> export <span class="dt">{{DOCKER_CONTAINER_ID}}</span> <span class="kw">&gt;</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.export.tar</code></pre>
<h4 id="import">IMPORT</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cat</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.export.tar <span class="kw">|</span> <span class="kw">docker</span> import - <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span></code></pre>
<h3 id="save-load">SAVE / LOAD</h3>
<p>差分統合されない。</p>
<h4 id="save">SAVE</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> save <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> <span class="kw">&gt;</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.save.tar</code></pre>
<h4 id="load">LOAD</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> load <span class="kw">&lt;</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.save.tar</code></pre>
<h3 id="remove-all-container">REMOVE ALL CONTAINER</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rm <span class="kw">`docker</span> ps -aq<span class="kw">`</span></code></pre>
<h3 id="images-tree">images tree</h3>
<p>-tree もうすぐなくなる...</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> images -tree</code></pre>
<h3 id="all-images-list">all images list</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> images -a</code></pre>
<h3 id="remove-images">remove images</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rmi <span class="kw">&lt;</span>IMAGE ID<span class="kw">&gt;</span> </code></pre>
<h3 id="remove-all-homeless-images">remove all homeless images</h3>
<p>消えないもの</p>
<ul>
<li>コミット済み image に依存されている？</li>
<li>コンテナが残っとる？</li>
<li>コンテナが動いとる？</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> rmi <span class="ot">$(</span><span class="kw">docker</span> images -a <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;/^&lt;none&gt;/ {print $3}&#39;</span><span class="ot">)</span> </code></pre>
<h3 id="all-clear">ALL CLEAR</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> stop <span class="kw">`docker</span> ps -aq<span class="kw">`</span>
<span class="kw">docker</span> rm <span class="kw">`docker</span> ps -aq<span class="kw">`</span>
<span class="kw">docker</span> rmi <span class="ot">$(</span><span class="kw">docker</span> images -a <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;{print $3}&#39;</span><span class="ot">)</span></code></pre>
<p>docker rmi $(docker images -a | awk '{print $3}')</p>
<h2 id="boot2docker">boot2docker</h2>
<h3 id="install-4">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">brew</span> install docker boot2docker</code></pre>
<h3 id="up">up</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">boot2docker</span> init
<span class="kw">boot2docker</span> up</code></pre>
<h3 id="ssh">ssh</h3>
<p>password: tcuser</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">boot2docker</span> ssh</code></pre>
<h3 id="docker_host">DOCKER_HOST</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">DOCKER_HOST=</span>tcp://localhost:4243</code></pre>
<h1 id="ansible">ANSIBLE</h1>
<h2 id="basics-1">BASICS</h2>
<h3 id="ping">ping</h3>
<p>実行前に接続できるか確認する。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ansible</span> -i hosts all -m ping</code></pre>
<h3 id="run-playbook">run playbook</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ansible-playbook</span> -i hosts site.yml</code></pre>
<h2 id="roll">roll</h2>
<h3 id="send-file">send file</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> copy CENTOS iso file 1
  <span class="fu">copy:</span> src=CentOS-6.5-x86_64-bin-DVD1.iso dest=/mnt/ owner=root group=root mode=644</code></pre>
<h3 id="mkdir">mkdir</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> make mount position
  <span class="fu">file:</span> path=/mnt/CentOS-6.5_1 owner=root group=root mode=644 state=directory</code></pre>
<h3 id="mod-file-line">mod file line</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> MODFILE &quot;yum.conf&quot;
  <span class="fu">lineinfile:</span> dest=/etc/yum.conf  regexp=^keepcache  line=keepcache=1</code></pre>
<h3 id="yums">yums</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> yum install depend pkg
  <span class="fu">yum:</span> name={{ item }} state=installed disablerepo=* enablerepo=c6-media
  <span class="fu">with_items:</span>
    <span class="kw">-</span> compat-libstdc++-33
    <span class="kw">-</span> elfutils-libelf-devel
    <span class="kw">-</span> elfutils-libelf-devel-static
    <span class="kw">-</span> gcc
    <span class="kw">-</span> gcc-c++
    <span class="kw">-</span> glibc-devel
    <span class="kw">-</span> glibc-headers
    <span class="kw">-</span> kernel-headers
    <span class="kw">-</span> libaio-devel
    <span class="kw">-</span> libgomp
    <span class="kw">-</span> libstdc++-devel
    <span class="kw">-</span> sysstat</code></pre>
<h3 id="add-group-user">add group &amp; user</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> create group
  <span class="fu">group:</span> name={{item.name}} gid={{item.gid}} state=present
  <span class="fu">with_items:</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;oinstall&quot;</span> <span class="kw">, </span><span class="fu">gid:</span> 701<span class="kw">}</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;dba&quot;</span>      <span class="kw">, </span><span class="fu">gid:</span> 702<span class="kw">}</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;oracle&quot;</span>   <span class="kw">, </span><span class="fu">gid:</span> 703<span class="kw">}</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;oper&quot;</span>     <span class="kw">, </span><span class="fu">gid:</span> 704<span class="kw">}</span>

<span class="kw">-</span> <span class="fu">name:</span> create user
  <span class="fu">user:</span> name={{item.name}} uid={{item.uid}} password={{item.pass}} group=oinstall groups=dba,oper createhome=yes state=present
  <span class="fu">with_items:</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> <span class="st">&quot;oracle&quot;</span> <span class="kw">, </span><span class="fu">uid:</span> 701<span class="kw">,</span> <span class="fu">pass:</span> <span class="st">&quot;$1$SomeSalt$c7SWNheGRHNaCLwuAG7Sa.&quot;</span> <span class="kw">}</span></code></pre>
<h4 id="make-password">make password</h4>
<pre class="sourceCode python"><code class="sourceCode python">python -c <span class="st">&#39;import crypt; print crypt.crypt(&quot;REPLACE:username&quot;, &quot;$1$SomeSalt$&quot;)&#39;</span></code></pre>
<h4 id="exec-shell-command">exec shell command</h4>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> yum install
  <span class="fu">shell:</span> yum --disablerepo=\* -y localinstall /opt/rpm/*.rpm &gt; /opt/rpm/res.txt</code></pre>
<p>command もあるが、なんか違う。</p>
<h1 id="command">COMMAND</h1>
<h2 id="grep">GREP</h2>
<h3 id="and">and</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> <span class="st">&#39;AAA&#39;</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">&#39;BBB&#39;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> <span class="st">&#39;AAA.*BBB&#39;</span></code></pre>
<h3 id="or">or</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> <span class="st">&#39;AAA\|BBB&#39;</span></code></pre>
<h3 id="not">not</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -v <span class="st">&#39;AAA&#39;</span></code></pre>
<h2 id="misc-1">MISC</h2>
<h3 id="bell">BELL</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> -n <span class="st">$&#39;</span><span class="dt">\a</span><span class="st">&#39;</span></code></pre>
<h3 id="iconv">iconv</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">iconv</span> -l</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">iconv</span> -f EUC-JP -t UTF-8 FILE -o FILE.utf8</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">iconv</span> -f SJIS -t UTF-8 FILE -o FILE.utf8</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">find</span> -type f <span class="kw">|</span> <span class="kw">xargs</span> file <span class="kw">|</span> <span class="kw">grep</span> <span class="st">&quot;:.*text&quot;</span> <span class="kw">|</span> <span class="kw">cut</span> -d : -f1 <span class="kw">|</span> <span class="kw">xargs</span> -t -I<span class="dt">{}</span> iconv -f EUC-JP -t UTF-8 <span class="dt">{}</span> -o <span class="dt">{}</span>.utf8</code></pre>
<h3 id="file-name">FILE NAME</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">for</span> <span class="kw">x</span> in *.csv.utf8<span class="kw">;do</span> <span class="kw">mv</span> <span class="ot">$x</span> <span class="ot">${x%</span>.csv.utf8<span class="ot">}</span><span class="st">&quot;.csv&quot;</span><span class="kw">;done</span></code></pre>
<h3 id="一括置換">一括置換</h3>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">BEFOR</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_REPLACE_BEFOR" ng-init="CMD_REPLACE_BEFOR='BEFOR'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">AFTER</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_REPLACE_AFTER" ng-init="CMD_REPLACE_AFTER='AFTER'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">FILENAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_REPLACE_FILENAME" ng-init="CMD_REPLACE_FILENAME='*.html'">
</div>
</div>
</form>


<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -rl <span class="st">&quot;{{CMD_REPLACE_BEFOR}}&quot;</span> */<span class="dt">{{CMD_REPLACE_FILENAME}}</span>
<span class="kw">perl</span> -p -i.befor -e <span class="st">&#39;s/{{CMD_REPLACE_BEFOR}}/{{CMD_REPLACE_AFTER}}/g&#39;</span> <span class="dt">{{CMD_REPLACE_FILENAME}}</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">find</span> . -name <span class="st">&#39;{{CMD_REPLACE_FILENAME}}&#39;</span> -type f -exec sed -i <span class="st">&#39;s/{{CMD_REPLACE_BEFOR}}/{{CMD_REPLACE_AFTER}}/g&#39;</span> <span class="dt">{}</span> <span class="dt">\;</span></code></pre>
<h3 id="通算秒-日時">通算秒 / 日時</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span> -d <span class="st">&quot;1970-01-01 UTC &lt;通算秒数&gt; seconds&quot;</span> <span class="st">&#39;+%Y-%m-%d %H:%M:%S&#39;</span></code></pre>
<h3 id="所要時間測定">所要時間測定</h3>
<ul>
<li>centos6 minimum だと bc コマンドはいってない。</li>
<li>uptime なので時刻調整されても問題ないはず。</li>
<li>cat /proc/uptime の2つ目はアイドル時間数とのこと。</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">IFS=</span><span class="st">&quot; &quot;</span>
<span class="kw">read</span> -a <span class="ot">t1</span> <span class="kw">&lt;&lt;&lt;</span> <span class="kw">`cat</span> /proc/uptime<span class="kw">`</span>;<span class="kw">date</span>
<span class="kw">sleep</span> 5
<span class="kw">read</span> -a <span class="ot">t2</span> <span class="kw">&lt;&lt;&lt;</span> <span class="kw">`cat</span> /proc/uptime<span class="kw">`</span>;<span class="kw">date</span>
<span class="ot">td=</span><span class="kw">`echo</span> <span class="st">&quot;</span><span class="ot">${t2[0]}</span><span class="st">-</span><span class="ot">${t1[0]}</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="kw">bc`</span>
<span class="kw">echo</span> <span class="st">&quot;</span><span class="ot">${td}</span><span class="st"> sec.&quot;</span></code></pre>
<h3 id="ファイル検索-コマンド実行">ファイル検索 &amp; コマンド実行</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">find</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="kw">&lt;</span>検索文字&gt; <span class="kw">|</span> <span class="kw">xargs</span> <span class="kw">&lt;</span>コマンド&gt;</code></pre>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">FILE1</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_FILE1" ng-init="CMD_FILE1='file1'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">FILE2</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_FILE2" ng-init="CMD_FILE2='file2'">
</div>
</div>
</form>




<h3 id="ナイスな-diff">ナイスな diff</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">diff</span> -y --suppress-common-lines <span class="dt">{{CMD_FILE1}}</span> <span class="dt">{{CMD_FILE2}}</span></code></pre>
<h3 id="ファイルの単純横結合">ファイルの単純横結合</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">paste</span>  <span class="dt">{{CMD_FILE1}}</span> <span class="dt">{{CMD_FILE2}}</span></code></pre>
<h3 id="プロンプト反転">プロンプト反転</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">PS1=</span><span class="st">&quot;\[\033[07m\][\u@</span><span class="ot">${HOSTNAME}</span><span class="st"> \W]</span><span class="dt">\\</span><span class="st">$\[\033[00m\] &quot;</span></code></pre>
<h3 id="日時書式">日時書式</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span> +<span class="st">&quot;%Y_%m_%d__%H_%M_%S&quot;</span></code></pre>
<h3 id="offset">OFFSET</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span> +<span class="st">&quot;%Y_%m_%d__%H_%M_%S&quot;</span> -d <span class="st">&quot;12 hours ago&quot;</span></code></pre>
<h3 id="pgrep">pgrep</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">pgrep</span> procname*</code></pre>
<h4 id="pkill-and-kill">pkill and kill</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">pgrep</span> procname* <span class="kw">|</span> <span class="kw">xargs</span> kill -9</code></pre>
<h3 id="watch">watch</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">while</span> <span class="kw">true;do</span> <span class="kw">date</span> +<span class="st">&quot;%Y-%m-%d %H:%M:%S.%N&quot;</span><span class="kw">;sleep</span> 1<span class="kw">;done</span></code></pre>
<h3 id="exfat">exfat</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> mount -t exfat-fuse /dev/sde1 /media/exfat
<span class="kw">umount</span> /media/exfat</code></pre>
<h3 id="lang">LANG</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">LANG=</span>en_US.UTF-8</code></pre>
<h3 id="scp">scp</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">scp</span> -P 22 -rq tcp/ vagrant@192.168.33.32:/home/vagrant/
<span class="kw">scp</span> -P 22 -rq tcp/ vagrant@192.168.33.43:/home/vagrant/</code></pre>
<h1 id="vi">VI</h1>
<h2 id="edit">EDIT</h2>
<h3 id="置換え">置換え</h3>
<h4 id="確認あり">確認あり</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">:<span class="kw">%s</span>/前/後/<span class="kw">gc</span></code></pre>
<h4 id="確認なし">確認なし</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">:<span class="kw">%s</span>/前/後/<span class="kw">g</span></code></pre>
<h2 id="view">VIEW</h2>
<h3 id="カーソル移動">カーソル移動</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">key</th>
<th style="text-align: left;">move</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1G</td>
<td style="text-align: left;">1 行目のあたま</td>
</tr>
<tr class="even">
<td style="text-align: center;">G</td>
<td style="text-align: left;">最終行のケツ</td>
</tr>
<tr class="odd">
<td style="text-align: center;">~</td>
<td style="text-align: left;">今の行のあたま</td>
</tr>
<tr class="even">
<td style="text-align: center;">$</td>
<td style="text-align: left;">今の行のケツ</td>
</tr>
</tbody>
</table>
<h1 id="windows">WINDOWS</h1>
<h2 id="network">NETWORK</h2>
<p>ドス窓は管理者権限で実行</p>
<h3 id="ip-アドレス設定">IP アドレス設定</h3>
<pre><code>netsh interface ipv4 set address name=&quot;ローカル エリア接続&quot; addr=192.2.56.111 mask=255.255.255.0 gateway=192.2.56.1</code></pre>
<h3 id="ip-アドレス追加">IP アドレス追加</h3>
<p>追加の場合は gateway 不要</p>
<pre><code>netsh interface ipv4 add address name=&quot;ローカル エリア接続&quot; addr=192.2.56.111 mask=255.255.255.0</code></pre>
<h3 id="ip-アドレス削除">IP アドレス削除</h3>
<pre><code>netsh interface ipv4 del address name=&quot;ローカル エリア接続&quot; addr=192.2.56.111</code></pre>
<h3 id="各種情報収集">各種情報収集</h3>
<pre><code>mkdir .\%COMPUTERNAME%
cd .\%COMPUTERNAME%

echo &quot;&quot;        &gt; 10_SYSTEM
systeminfo     &gt; 11_SYSTEM__systeminfo.txt
msinfo32 /report 12_SYSTEM__msinfo32.txt

echo &quot;&quot;        &gt; 20_NETWORK
ipconfig /all  &gt; 21_NETWORK__ipconfig_all.txt
route print    &gt; 22_NETWORK__route_print.txt
netstat -sp    &gt; 23_NETWORK__netstat_sp.txt
netstat -e     &gt; 24_NETWORK__netstat_e.txt
net use        &gt; 25_NETWORK__net_use.txt

echo &quot;&quot;            &gt; 30_TASK
schtasks /query /V &gt; 31_TASK__shttasks.txt
tasklist           &gt; 32_TASK__tasklist.txt
tasklist /svc      &gt; 33_TASK__tasklist_svc.txt
tasklist /m        &gt; 34_TASK__tasklist_m.txt

echo &quot;&quot;                        &gt; 40_LOG
wevutil qe system      /f:TEXT &gt; 41_LOG__wevutil_qe_system.txt
wevutil qe Application /f:TEXT &gt; 42_LOG__wevutil_qe_application.txt</code></pre>
<h1 id="nxr120">NXR120</h1>
<h2 id="web">Web</h2>
<pre><code>http://IPADDRESS:880/
(admin/admin)</code></pre>
<h2 id="ssh-1">ssh</h2>
<h3 id="設定の確認">設定の確認</h3>
<pre><code>show config</code></pre>
<h3 id="default-gateway">default gateway</h3>
<pre><code>configure terminal
ip route 0.0.0.0/0 196.1.58.1
exit
save config</code></pre>
<h3 id="nat">1:1 NAT</h3>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">ethernet0 IP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="nxr_e0ip" ng-init="nxr_e0ip='192.168.0.1'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">host IP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="NXR_RIP" ng-init="NXR_RIP='192.168.0.10'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">ethernet1 IP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="nxr_e1ip" ng-init="nxr_e1ip='11.22.33.44'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">host virtIP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="nxr_vip" ng-init="nxr_vip='11.22.33.10'">
</div>
</div>
</form>




<pre><code>show config
configure terminal

system dnat-group DNAT
system snat-group SNAT
ip dnat DNAT ip any {{nxr_vip}} {{NXR_RIP}}
ip snat SNAT ip {{NXR_RIP}} any {{nxr_vip}}

interface ethernet 0

  ip address {{nxr_e0ip}}/24
  ip snat-group SNAT
  exit

interface ethernet 1

  ip address {{nxr_e1ip}}/24
  ip address {{nxr_vip}}/24 secondary
  ip dnat-group DNAT
  exit

exit
save config
restart</code></pre>
<h3 id="ip-filter">ip filter</h3>
<pre><code>configure terminal

ip access-list 55555 permit any any tcp any 55555
ip access-list eth0_in permit 196.1.58.0/24 192.1.58.220/32 tcp any 880
ip access-list eth0_in permit any any icmp
ip access-list eth0_in deny any any
ip access-list eth1_forward_in permit 195.200.58.33 any tcp any range 1024 65535
ip access-list eth1_forward_in permit any any icmp
ip access-list eth1_forward_in permit any any tcp any range 80 81
ip access-list eth1_forward_in permit any any tcp any 8081
ip access-list eth1_forward_in permit any any tcp any 8084
ip access-list eth1_forward_in permit any any tcp range 80 81 any
ip access-list eth1_forward_in permit any any tcp 8081 any
ip access-list eth1_forward_in permit any any tcp 8084 any
ip access-list eth1_forward_in permit 196.1.58.0/24 195.200.58.33/32 tcp any range 1024 65535
ip access-list eth1_forward_in deny any any
ip access-list eth1_in permit 195.200.58.33/32 any tcp any 80
ip access-list eth1_in permit 195.200.58.33/32 any tcp any range 1024 65535
ip access-list eth1_in permit any any icmp
ip access-list eth1_in deny any any

exit
save config
restart</code></pre>
<h3 id="設定の無効化">設定の無効化</h3>
<pre><code>頭に no をつける</code></pre>
<h1 id="ssh-2">SSH</h1>
<h2 id="no-pass-login">NO PASS LOGIN</h2>
<h3 id="on-local">on LOCAL</h3>
<h4 id="keygen">keygen</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ssh-keygen</span>
<span class="kw">ssh-add</span> ./id_rsa...?
<span class="kw">cat</span> ~/.ssh/id_rsa.pub</code></pre>
<h3 id="on-server">on SERVER</h3>
<h4 id="paste">paste</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/home/USERNAME/.ssh/authorized_keys</span></code></pre>
<h1 id="centos">CENTOS</h1>
<h2 id="selinux">SELINUX</h2>
<h3 id="状況確認">状況確認</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">getenforce</span></code></pre>
<h3 id="一時的な-off">一時的な OFF</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">setenforce</span> 0</code></pre>
<h3 id="恒久的な-off">恒久的な OFF</h3>
<h4 id="etcselinuxconfig">/etc/selinux/config</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">SELINUX=</span>disabled</code></pre>
<h2 id="network-1">NETWORK</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">I/F NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CENT_NET_IFNAME" ng-init="CENT_NET_IFNAME='eth0'">
</div>
</div>
</form>



<h3 id="ip-アドレスリンクスピード固定化">IP アドレス・リンクスピード固定化</h3>
<h4 id="etcsysconfignetwork-scriptsifcfg-eth0">/etc/sysconfig/network-scripts/ifcfg-eth0</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">HWADDR=</span>XX:XX:XX:XX:XX:XX
<span class="ot">DEVICE=</span><span class="dt">{{CENT_NET_IFNAME}}</span>
<span class="ot">BOOTPROTO=</span>none
<span class="ot">ONBOOT=</span>yes
<span class="ot">USERCTL=</span>no
<span class="ot">IPV6INIT=</span>no
<span class="ot">PEERDNS=</span>no
<span class="ot">TYPE=</span>Ethernet
<span class="ot">IPADDR=</span>192.168.1.10
<span class="ot">NETMASK=</span>255.255.255.0
<span class="ot">ETHTOOL_OPTS=</span><span class="st">&quot;autoneg off speed 10 duplex full&quot;</span></code></pre>
<h4 id="sudo">sudo</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> network restart</code></pre>
<h3 id="ip-エイリアス">IP エイリアス</h3>
<h4 id="sudo-1">sudo</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> /etc/sysconfig/network-scripts
<span class="kw">cp</span> ifcfg-<span class="dt">{{CENT_NET_IFNAME}}</span> ifcfg-<span class="dt">{{CENT_NET_IFNAME}}</span>:1</code></pre>
<h4 id="etcsysconfignetwork-scriptsifcfg-cent_net_ifname1">/etc/sysconfig/network-scripts/ifcfg-{{CENT_NET_IFNAME}}:1</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">HWADDR=</span>XX:XX:XX:XX:XX:XX
<span class="ot">DEVICE=</span><span class="dt">{{CENT_NET_IFNAME}}</span>:1
<span class="ot">BOOTPROTO=</span>none
<span class="ot">ONBOOT=</span>yes
<span class="ot">USERCTL=</span>no
<span class="ot">IPV6INIT=</span>no
<span class="ot">PEERDNS=</span>no
<span class="ot">TYPE=</span>Ethernet
<span class="ot">IPADDR=</span>192.168.1.10
<span class="ot">NETMASK=</span>255.255.255.0
<span class="ot">ETHTOOL_OPTS=</span><span class="st">&quot;autoneg off speed 10 duplex full&quot;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> network restart</code></pre>
<h3 id="スタティックルート">スタティックルート</h3>
<h4 id="etcsysconfigstatic-routes">/etc/sysconfig/static-routes</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">any</span> net 123.1.2.0 netmask 255.255.255.0 gw 192.168.0.201</code></pre>
<h4 id="sudo-2">sudo</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> network restart</code></pre>
<h3 id="デフォルトゲートウェイホスト名">デフォルトゲートウェイ・ホスト名</h3>
<h4 id="etcsysconfignetwork">/etc/sysconfig/network</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">NETWORKING=</span>yes
<span class="ot">NETWORKING_IPV6=</span>no
<span class="ot">HOSTNAME=</span>SERVERNAME
<span class="ot">GATEWAY=</span>192.168.0.123</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> network restart</code></pre>
<h2 id="yum">YUM</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">PKG NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="YUM_PKG" ng-init="YUM_PKG='httpd'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">OPT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="YUM_OPT" ng-init="YUM_OPT='--disablerepo=\\* --enablerepo=c6-media'">
</div>
</div>
</form>





<h3 id="onoff-repo">ON/OFF REPO</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> --disablerepo=<span class="dt">\*</span> --enablerepo=c6-media ...</code></pre>
<h3 id="packages-dependencies">package's dependencies</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> deplist <span class="dt">{{YUM_PKG}}</span> <span class="dt">{{YUM_OPT}}</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> deplist <span class="dt">{{YUM_PKG}}</span> <span class="dt">{{YUM_OPT}}</span> <span class="kw">|</span> <span class="kw">grep</span> provider</code></pre>
<h3 id="download">DOWNLOAD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yumdownloader</span> --resolve <span class="dt">{{YUM_PKG}}</span></code></pre>
<h3 id="install-local-rpm">INSTALL LOCAL RPM</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> --disablerepo=<span class="dt">\*</span> -y localinstall ./*.rpm</code></pre>
<h3 id="list-1">LIST</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">yum</span> <span class="dt">{{YUM_OPT}}</span> list</code></pre>
<h1 id="chef">CHEF</h1>
<h2 id="misc-2">MISC</h2>
<h3 id="create-cookbok">CREATE cookbok</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">knife</span> cookbook create app -o site-cookbooks</code></pre>
<h1 id="virualbox">VirualBox</h1>
<h2 id="image">image</h2>
<h3 id="from-vmware">from vmware</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">VBoxManage</span> clonehd --format VDI cyua.vmdk cyua.vdi</code></pre>
<h1 id="vagrant">VAGRANT</h1>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">BOX FILE</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_BOX_FILE" ng-init="VAG_BOX_FILE='./package.box'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">BOX NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_BOX_NAME" ng-init="VAG_BOX_NAME='centos65-x86_64-20131205'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">VM NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_VM_NAME" ng-init="VAG_VM_NAME='vm1'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">VM STATIC IP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_VM_IP" ng-init="VAG_VM_IP='192.168.0.111'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">VM SSH PORT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_SSH_PORT" ng-init="VAG_SSH_PORT='2205'">
</div>
</div>
</form>

<h2 id="box">BOX</h2>
<h3 id="add">ADD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> box add <span class="dt">{{VAG_BOX_NAME}}</span> <span class="dt">{{VAG_BOX_FILE}}</span>
<span class="kw">vagrant</span> box list</code></pre>
<h2 id="vagrantfile">Vagrantfile</h2>
<pre class="sourceCode ruby"><code class="sourceCode ruby"><span class="co"># -*- mode: ruby -*-</span>
<span class="co"># vi: set ft=ruby :</span>

<span class="dt">VAGRANTFILE_API_VERSION</span> = <span class="st">&quot;2&quot;</span>

<span class="dt">NUM_INSTANCES</span> = <span class="dv">2</span>
<span class="dt">BASE_IP_ADDR</span>  = <span class="dt">ENV</span>[<span class="st">&#39;BASE_IP_ADDR&#39;</span>] || <span class="st">&quot;192.168.100&quot;</span>


<span class="dt">Vagrant</span>.configure(<span class="dt">VAGRANTFILE_API_VERSION</span>) <span class="kw">do</span> |config|

  config.vm.box = <span class="st">&quot;chef/centos-6.5&quot;</span>
  config.vm.synced_folder <span class="st">&quot;~/src/&quot;</span>, <span class="st">&quot;/vagrant/src&quot;</span>

  (<span class="dv">1</span>..<span class="dt">NUM_INSTANCES</span>).each <span class="kw">do</span> |i|

    config.vm.define <span class="st">&quot;dummy-</span><span class="ot">#{</span>i<span class="ot">}</span><span class="st">&quot;</span> <span class="kw">do</span> |dummy|
      dummy.vm.hostname = <span class="st">&quot;dummy-</span><span class="ot">#{</span>i<span class="ot">}</span><span class="st">&quot;</span>
      dummy.vm.network <span class="st">:private_network</span>, ip: <span class="st">&quot;</span><span class="ot">#{</span><span class="dt">BASE_IP_ADDR</span><span class="ot">}</span><span class="st">.</span><span class="ot">#{</span>i<span class="ot">}</span><span class="st">&quot;</span>
    <span class="kw">end</span>

    config.vm.provider <span class="st">&quot;virtualbox&quot;</span> <span class="kw">do</span> |vbox|
      vbox.gui = <span class="dv">false</span>
      vbox.customize [<span class="st">&quot;modifyvm&quot;</span>, <span class="st">:id</span>, <span class="st">&quot;--memory&quot;</span>, <span class="st">&quot;1000&quot;</span>]
      <span class="co"># centos 6.5 slow network fix</span>
      vbox.customize [<span class="st">&quot;modifyvm&quot;</span>, <span class="st">:id</span>, <span class="st">&quot;--natdnsproxy1&quot;</span>, <span class="st">&quot;on&quot;</span>]
      vbox.customize [<span class="st">&quot;modifyvm&quot;</span>, <span class="st">:id</span>, <span class="st">&quot;--natdnshostresolver1&quot;</span>, <span class="st">&quot;on&quot;</span>]
    <span class="kw">end</span>

  <span class="kw">end</span>

<span class="kw">end</span></code></pre>
<h2 id="ssh-3">ssh</h2>
<h3 id="ssh-config">ssh config</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> up
<span class="kw">vagrant</span> ssh-config vm1  <span class="kw">&gt;&gt;</span> ~/.ssh/config
<span class="kw">vagrant</span> ssh-config vm2 <span class="kw">&gt;&gt;</span> ~/.ssh/config
<span class="kw">cat</span> ~/.ssh/config</code></pre>
<h2 id="provision">provision</h2>
<h3 id="with-chef">with chef</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> halt
<span class="kw">vagrant</span> sandbox on
<span class="kw">vagrant</span> up

<span class="kw">echo</span> vm1 vm2 <span class="kw">|</span> <span class="kw">xargs</span> -n 1 knife solo prepare 

<span class="kw">vagrant</span> halt
<span class="kw">vagrant</span> sandbox commit
<span class="kw">vagrant</span> up

<span class="kw">echo</span> vm1 vm2 <span class="kw">|</span> <span class="kw">xargs</span> -n 1 knife solo cook</code></pre>
<h2 id="plug-in">PLUG-IN</h2>
<h3 id="sandbox">sandbox</h3>
<h4 id="sandboxモード開始">sandboxモード開始</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox on</code></pre>
<h4 id="変更を決定する">変更を決定する</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox commit</code></pre>
<h4 id="変更を破棄しロールバックする">変更を破棄し、ロールバックする</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox rollback</code></pre>
<h4 id="sandboxモード終了commitしていないものは破棄される">sandboxモード終了（commitしていないものは破棄される）</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox off</code></pre>
<h4 id="現在sandboxモードかどうかの確認">現在sandboxモードかどうかの確認</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">vagrant</span> sandbox status</code></pre>
<h1 id="oracle">ORACLE</h1>
<h2 id="setting">SETTING</h2>
<h3 id="tnsnames.ora">TNSNAMES.ORA</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cat</span> <span class="ot">$ORACLE_HOME</span>/network/admin/tnsnames.ora</code></pre>
<h3 id="tnsnames.ora-listener.ora">TNSNAMES.ora, LISTENER.ora</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> <span class="ot">$ORACLE_HOME</span>/network/admin</code></pre>
<h3 id="stop-start-restart">STOP, START, RESTART</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">service</span> dbora stop
<span class="kw">service</span> dbora start
<span class="kw">service</span> dbora restart</code></pre>
<h2 id="sqlplus">SQLPLUS</h2>
<h3 id="exec-.sql">exec *.sql</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlplus</span> <span class="kw">&lt;</span>USER<span class="kw">&gt;</span>/<span class="kw">&lt;</span>PASS<span class="kw">&gt;</span>@<span class="kw">&lt;</span>TNSNAME<span class="kw">&gt;</span> @<span class="kw">&lt;</span>FILE<span class="kw">&gt;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlplus</span> <span class="kw">&lt;</span>USER<span class="kw">&gt;</span>/<span class="kw">&lt;</span>PASS<span class="kw">&gt;</span>@<span class="kw">&lt;</span>SID<span class="kw">&gt;</span> @<span class="kw">&lt;</span>FILE<span class="kw">&gt;</span></code></pre>
<h3 id="csv">CSV</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">set</span> colsep <span class="st">&#39;,&#39;</span>
<span class="kw">set</span> pagesize <span class="dv">0</span>
<span class="kw">set</span> trimspool <span class="kw">off</span>
<span class="kw">set</span> headsep <span class="kw">off</span>
<span class="kw">set</span> linesize <span class="dv">32767</span>
<span class="kw">set</span> feedback <span class="kw">off</span>
<span class="co">-- set numw X</span></code></pre>
<h2 id="enterprise-manager">Enterprise Manager</h2>
<h3 id="updown">UP/DOWN</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">emctl</span> start dbconsole
<span class="kw">emctl</span> stop dbconsole</code></pre>
<h2 id="sql">SQL</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">TAB NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_TAB_NAME" ng-init="ORA_TAB_NAME='TABNAME'">
</div>
</div>
</form>

<h3 id="insert">insert</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">insert</span> <span class="kw">into</span> {{ORA_TAB_NAME}} (&lt;COL1&gt; ,&lt;COL2&gt;) <span class="kw">values</span> (&lt;COL1VAL&gt;,&lt;COL2VAL&gt;);</code></pre>
<h3 id="update">update</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">update</span> {{ORA_TAB_NAME}} <span class="kw">set</span> &lt;COL1&gt;=<span class="st">&#39;AAA&#39;</span> , &lt;COL2&gt;=<span class="st">&#39;BBB&#39;</span> <span class="kw">where</span> &lt;COL3&gt;=<span class="st">&#39;ZZZ&#39;</span>;</code></pre>
<h3 id="prime">PRIME?</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> column_name <span class="kw">from</span> user_cons_columns
<span class="kw">where</span> constraint_name = (
      <span class="kw">select</span> constraint_name <span class="kw">from</span> user_constraints
      <span class="kw">where</span> table_name = <span class="st">&#39;&quot; + tab + &quot;&#39;</span> <span class="kw">and</span> constraint_type = <span class="st">&#39;P&#39;</span>
)</code></pre>
<h3 id="get-instance-name">get instance name</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> <span class="fu">sys_context</span>(<span class="st">&#39;USERENV&#39;</span>, <span class="st">&#39;instance_name&#39;</span>) <span class="kw">from</span> dual;</code></pre>
<h3 id="db-link">DB Link</h3>
<h4 id="connect">connect</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlplus</span> sys/manager@<span class="kw">&lt;</span>db<span class="kw">&gt;</span> as sysdba</code></pre>
<h4 id="show-status">show status</h4>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">set</span> linesize <span class="dv">100</span>
col OWNER    format a10
col DB_LINK  format a20
col USERNAME format a10
col HOST     format a15
col CREATED  format a20
col <span class="kw">PASSWORD</span> format a20
<span class="kw">select</span> * <span class="kw">from</span> dba_db_links;</code></pre>
<h4 id="create-1">create</h4>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">PUBLIC</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> &lt;LINKNAME&gt;
<span class="kw">connect</span> <span class="kw">to</span> &lt;USER&gt; <span class="kw">identified</span> <span class="kw">by</span> &lt;PASS&gt;
<span class="kw">using</span> <span class="st">&#39;&lt;DB&gt;&#39;</span>;</code></pre>
<h3 id="get-object-source">get object source</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span>
  dbms_metadata.get_ddl (
     &lt;OBJECT_TYPE&gt;
   , &lt;OBJECT_NAME&gt;
   , &lt;OWNER&gt;
  )
<span class="kw">from</span>
  dual
;</code></pre>
<h2 id="multi-master-replication">MULTI MASTER REPLICATION</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">SITE A</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_REPSITE_A" ng-init="ORA_REPSITE_A='AAA'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">SITE B</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_REPSITE_B" ng-init="ORA_REPSITE_B='BBB'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">TNS</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_REPTNSNAME" ng-init="ORA_REPTNSNAME='DB'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">TABLE</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_REP_TABNAME" ng-init="ORA_REP_TABNAME='TABLENAME'">
</div>
</div>
</form>



<h3 id="sqlplus-1">SQLPLUS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sqlplus</span> /nolog</code></pre>
<h3 id="create-repadmin">CREATE REPADMIN</h3>
<h4 id="ora_repsite_a">{{ORA_REPSITE_A}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="kw">CREATE</span> <span class="fu">USER</span> repadmin <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">COMMENT</span> <span class="kw">ANY</span> <span class="kw">TABLE</span> <span class="kw">TO</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">LOCK</span> <span class="kw">ANY</span> <span class="kw">TABLE</span> <span class="kw">TO</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">SELECT</span> <span class="kw">ANY</span> <span class="kw">DICTIONARY</span> <span class="kw">TO</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">EXECUTE</span> <span class="kw">ANY</span> <span class="kw">PROCEDURE</span> <span class="kw">TO</span> repadmin;
<span class="kw">EXEC</span> Dbms_Repcat_Admin.Grant_Admin_Any_Repgroup(<span class="st">&#39;repadmin&#39;</span>);
<span class="kw">EXEC</span> Dbms_Repcat_Admin.Grant_Admin_Any_Schema (username =&gt; <span class="st">&#39;repadmin&#39;</span>);

<span class="co">-- プロパゲータ（送信者ロール）を登録</span>
<span class="kw">EXEC</span> DBMS_DEFER_SYS.REGISTER_PROPAGATOR(<span class="st">&#39;repadmin&#39;</span>);

<span class="co">-- 受信者（ロール）を登録</span>
<span class="kw">BEGIN</span>
   DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (
      username       =&gt; <span class="st">&#39;repadmin&#39;</span>,
      privilege_type =&gt; <span class="st">&#39;receiver&#39;</span>,
      list_of_gnames =&gt; <span class="kw">NULL</span>);
<span class="kw">END</span>;
/</code></pre>
<h4 id="ora_repsite_b">{{ORA_REPSITE_B}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="co">--</span>
<span class="co">-- same {{ORA_REPSITE_A}}</span>
<span class="co">--</span></code></pre>
<h3 id="create-database-link">CREATE DATABASE LINK</h3>
<h4 id="ora_repsite_a-1">{{ORA_REPSITE_A}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="kw">CREATE</span> <span class="kw">PUBLIC</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}} <span class="kw">USING</span> <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}
<span class="kw">CONNECT</span> <span class="kw">TO</span> repadmin <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> repadmin <span class="kw">using</span> <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<h4 id="ora_repsite_b-1">{{ORA_REPSITE_B}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span> <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="kw">CREATE</span> <span class="kw">PUBLIC</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}} <span class="kw">USING</span> <span class="st">&#39;{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}

<span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}
<span class="kw">CONNECT</span> <span class="kw">TO</span> repadmin <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> repadmin <span class="kw">using</span> <span class="st">&#39;{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<h3 id="create-job">CREATE JOB</h3>
<h4 id="ora_repsite_a-2">{{ORA_REPSITE_A}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PURGE (
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">24</span>),
      <span class="dt">interval</span> =&gt; <span class="st">&#39;SYSDATE + (1/24)&#39;</span>,
      delay_seconds =&gt; <span class="dv">0</span>,
      rollback_segment =&gt; <span class="st">&#39;&#39;</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/24 = １時間</span>

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PUSH(
      destination =&gt; <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}.WORLD&#39;</span>,
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">8640</span>),
      <span class="dt">interval</span>  =&gt; <span class="st">&#39;SYSDATE + (1/8640)&#39;</span>,
      parallelism =&gt; <span class="dv">1</span>,
      delay_seconds =&gt; <span class="dv">0</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/8640 = 10sec</span></code></pre>
<h4 id="ora_repsite_b-2">{{ORA_REPSITE_B}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PURGE (
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">24</span>),
      <span class="dt">interval</span> =&gt; <span class="st">&#39;SYSDATE + (1/24)&#39;</span>,
      delay_seconds =&gt; <span class="dv">0</span>,
      rollback_segment =&gt; <span class="st">&#39;&#39;</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/24 = １時間</span>

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PUSH(
      destination =&gt; <span class="st">&#39;{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}.WORLD&#39;</span>,
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">8640</span>),
      <span class="dt">interval</span>  =&gt; <span class="st">&#39;SYSDATE + (1/8640)&#39;</span>,
      parallelism =&gt; <span class="dv">1</span>,
      delay_seconds =&gt; <span class="dv">0</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/8640 = 10sec</span></code></pre>
<h4 id="check">Check</h4>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="co">-- conn repadmin/repadmin@???_{{ORA_REPTNSNAME}}</span>

<span class="kw">set</span> linesize <span class="dv">150</span>
col job    format <span class="st">&#39;00000&#39;</span>
col what  format a65
col SCHEMA_USER format a10
col LAST_DATE format a10
col THIS_DATE format a10
col NEXT_DATE format a10
col <span class="dt">INTERVAL</span> format a10
<span class="kw">select</span> job,BROKEN,SCHEMA_USER,LAST_DATE,THIS_DATE,NEXT_DATE,
 <span class="dt">INTERVAL</span>, what <span class="kw">from</span> user_jobs;</code></pre>
<h3 id="create-replication-group">CREATE REPLICATION GROUP</h3>
<h4 id="ora_repsite_a-only">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">EXEC</span> DBMS_REPCAT.CREATE_MASTER_REPGROUP(<span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>);

<span class="kw">BEGIN</span>
   DBMS_REPCAT.ADD_MASTER_DATABASE (
      gname     =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>,
      <span class="kw">master</span>    =&gt; <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}&#39;</span>,
      use_existing_objects =&gt; <span class="kw">TRUE</span>,
      copy_rows =&gt; <span class="kw">FALSE</span>,
      propagation_mode =&gt; <span class="st">&#39;ASYNCHRONOUS&#39;</span>
   );
<span class="kw">END</span>;
/</code></pre>
<h3 id="add-object">ADD OBJECT</h3>
<h4 id="ora_repsite_a-only-1">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">begin</span> DBMS_REPCAT.CREATE_MASTER_REPOBJECT (
  gname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>
, <span class="kw">type</span> =&gt; <span class="st">&#39;TABLE&#39;</span>
, oname =&gt; <span class="st">&#39;{{ORA_REP_TABNAME}}&#39;</span>
, sname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}&#39;</span>
, use_existing_object =&gt; <span class="kw">TRUE</span>  <span class="co">-- 既存のオブジェクトを使用</span>
, copy_rows =&gt; <span class="kw">FALSE</span>           <span class="co">-- データのコピー</span>
);
<span class="kw">end</span>;
/

<span class="co">--（対象テーブル全部を登録する）</span></code></pre>
<h3 id="generate-replication-support">GENERATE REPLICATION SUPPORT</h3>
<h4 id="ora_repsite_a-only-2">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">begin</span> DBMS_REPCAT.GENERATE_REPLICATION_SUPPORT (
  sname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}&#39;</span>
, oname =&gt; <span class="st">&#39;{{ORA_REP_TABNAME}}&#39;</span>
, <span class="kw">type</span> =&gt; <span class="st">&#39;TABLE&#39;</span>
, min_communication =&gt; <span class="kw">TRUE</span>);
<span class="kw">end</span>;
/</code></pre>
<h3 id="start-replication">START REPLICATION</h3>
<h4 id="ora_repsite_a-only-3">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">exec</span> dbms_repcat.resume_master_activity(gname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>);</code></pre>
<h3 id="stop-replication">STOP REPLICATION</h3>
<h4 id="ora_repsite_a-only-4">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">exec</span> dbms_repcat.suspend_master_activity(gname=&gt;<span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>);</code></pre>
</body>
</html>
