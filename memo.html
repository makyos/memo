<!DOCTYPE html>
<html ng-app>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title></title>


  <script src="./angular.min.js"></script>

  <link rel="stylesheet" href="./bootstrap-3.1.1-dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="./bootstrap-3.1.1-dist/css/bootstrap-theme.min.css">

  <script src="vis/dist/vis.js"></script>
  <link href="vis/dist/vis.css" rel="stylesheet" type="text/css" />

  <script src="./memo.js"></script>
  <link rel="stylesheet" href="./memo.css">

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body  ng-controller="memoCtrl">
<h1 id="shell-script">SHELL SCRIPT</h1>
<h2 id="arg">ARG</h2>
<h3 id="arg-check">ARG CHECK</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/bin/env sh</span>
<span class="kw">if </span>[ <span class="ot">$#</span> -ne 2 ]; <span class="kw">then</span>
    <span class="kw">echo</span> usage: <span class="kw">`basename</span> <span class="ot">${0}</span><span class="kw">`</span> YYYY MO <span class="kw">&gt;&amp;2</span>
    <span class="kw">exit</span> 1
<span class="kw">fi</span>
<span class="ot">ARG1=${1}</span>
<span class="ot">ARG2=${2}</span></code></pre>
<h2 id="time">TIME</h2>
<h3 id="uptime-for-scriptbash">UPTIME for SCRIPT(bash)</h3>
<p>bash にはあらかじめ SECONDS ていう環境変数がある。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/bin/env bash</span>
<span class="ot">SECONDS=</span>0
<span class="kw">sleep</span> 3
<span class="kw">echo</span> <span class="ot">$SECONDS</span></code></pre>
<h2 id="quoteation">QUOTEATION</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">AAA=</span>abc
<span class="kw">echo</span> <span class="st">&quot;</span><span class="ot">${AAA}</span><span class="st">&quot;</span> <span class="co"># 展開される</span>
<span class="kw">echo</span> <span class="st">&#39;${AAA}&#39;</span> <span class="co"># 展開されぬ</span></code></pre>
<h2 id="for">FOR</h2>
<h3 id="for-each">for each</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">for</span> num <span class="kw">in</span> one two three; <span class="kw">do</span>
    <span class="kw">echo</span> <span class="ot">${num}</span>
<span class="kw">done</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">nums=</span><span class="st">&quot;one two three&quot;</span>
<span class="kw">for</span> num <span class="kw">in</span> <span class="ot">${nums}</span>; <span class="kw">do</span>
    <span class="kw">echo</span> <span class="ot">${num}</span>
<span class="kw">done</span></code></pre>
<h1 id="elastic-search">ELASTIC SEARCH</h1>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">SERVER ADDRESS &amp; PORT</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ES_SERVER_ADDRESS" ng-init="ES_SERVER_ADDRESS='192.168.0.246:9200'">
</div>
</div>

<div class="form-group">
<label class="control-label col-xs-6">INDEX NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ES_INDEX_NAME" ng-init="ES_INDEX_NAME='db-name'">
</div>
</div>


<div class="form-group">
<label class="control-label col-xs-6">TYPE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ES_TYPE_NAME" ng-init="ES_TYPE_NAME='table-name'">
</div>
</div>

</form>

<h2 id="index">INDEX</h2>
<h3 id="create">create</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">curl -XPUT <span class="st">&#39;http://{{ES_SERVER_ADDRESS}}/{{ES_INDEX_NAME}}&#39;</span></code></pre>
<h3 id="look">look</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">curl -XGET <span class="st">&#39;http://{{ES_SERVER_ADDRESS}}/{{ES_INDEX_NAME}}?pretty=true&#39;</span></code></pre>
<h3 id="delete">delete</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">curl -XDELETE <span class="st">&#39;http://{{ES_SERVER_ADDRESS}}/{{ES_INDEX_NAME}}&#39;</span></code></pre>
<h2 id="type">TYPE</h2>
<h3 id="create-1">create</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">curl -XPUT <span class="st">&#39;http://{{ES_SERVER_ADDRESS}}/{{ES_INDEX_NAME}}/{{ES_TYPE_NAME}}/_mapping&#39;</span>  -d @<span class="dt">{{ES_TYPE_NAME}}</span>.json</code></pre>
<h4 id="es_type_name.json">{{ES_TYPE_NAME}}.json</h4>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;{{ES_TYPE_NAME}}&quot;</span>:{
        <span class="dt">&quot;properties&quot;</span>:{
            <span class="dt">&quot;@timestamp&quot;</span>:{
                <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;date&quot;</span>
                ,<span class="dt">&quot;format&quot;</span>:<span class="st">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>
            }
            ,<span class="dt">&quot;srv&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;pid&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;user&quot;</span>    :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;pr&quot;</span>      :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;ni&quot;</span>      :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;virt&quot;</span>    :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;res&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;shr&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;integer&quot;</span>}
            ,<span class="dt">&quot;s&quot;</span>       :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;cpu&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;float&quot;</span>}
            ,<span class="dt">&quot;mem&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;float&quot;</span>}
            ,<span class="dt">&quot;times&quot;</span>   :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>}
            ,<span class="dt">&quot;cmd0&quot;</span>    :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
            ,<span class="dt">&quot;cmd&quot;</span>     :{<span class="dt">&quot;type&quot;</span>:<span class="st">&quot;string&quot;</span>, <span class="dt">&quot;index&quot;</span>: <span class="st">&quot;not_analyzed&quot;</span>}
        }
    }
}</code></pre>
<h3 id="look-1">look</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">curl -XGET <span class="st">&#39;http://{{ES_SERVER_ADDRESS}}/{{ES_INDEX_NAME}}/{{ES_TYPE_NAME}}/_mapping?pretty=true&#39;</span></code></pre>
<h3 id="delete-1">delete</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">curl -XGET <span class="st">&#39;http://{{ES_SERVER_ADDRESS}}/{{ES_INDEX_NAME}}/{{ES_TYPE_NAME}}&#39;</span></code></pre>
<h2 id="bulk-import">BULK IMPORT</h2>
<h4 id="importdatafile.json">@IMPORTDATAFILE.json</h4>
<pre class="sourceCode json"><code class="sourceCode json">{<span class="dt">&quot;index&quot;</span>:{}}
{<span class="dt">&quot;@timestamp&quot;</span>:<span class="st">&quot;2014-11-01 00:01:01&quot;</span>,<span class="dt">&quot;srv&quot;</span>:<span class="st">&quot;srv_A&quot;</span>,<span class="dt">&quot;pid&quot;</span>:<span class="dv">2884</span>,<span class="dt">&quot;user&quot;</span>:<span class="st">&quot;oracle&quot;</span>,<span class="dt">&quot;pr&quot;</span>:<span class="st">&quot;15&quot;</span>,<span class="dt">&quot;ni&quot;</span>:<span class="st">&quot;0&quot;</span>,<span class="dt">&quot;virt&quot;</span>:<span class="dv">1589000</span>,<span class="dt">&quot;res&quot;</span>:<span class="dv">496000</span>,<span class="dt">&quot;shr&quot;</span>:<span class="dv">489000</span>,<span class="dt">&quot;s&quot;</span>:<span class="st">&quot;S&quot;</span>,<span class="dt">&quot;cpu&quot;</span>:<span class="fl">15.4</span>,<span class="dt">&quot;mem&quot;</span>:<span class="fl">10.0</span>,<span class="dt">&quot;times&quot;</span>:<span class="st">&quot;0:03.45&quot;</span>,<span class="dt">&quot;cmd0&quot;</span>:<span class="st">&quot;oracle&quot;</span>,<span class="dt">&quot;cmd&quot;</span>:<span class="st">&quot;oracle (LOCAL=NO)&quot;</span>}
{<span class="dt">&quot;index&quot;</span>:{}}
{<span class="dt">&quot;@timestamp&quot;</span>:<span class="st">&quot;2014-11-01 00:01:01&quot;</span>,<span class="dt">&quot;srv&quot;</span>:<span class="st">&quot;srv_A&quot;</span>,<span class="dt">&quot;pid&quot;</span>:<span class="dv">10680</span>,<span class="dt">&quot;user&quot;</span>:<span class="st">&quot;oracle&quot;</span>,<span class="dt">&quot;pr&quot;</span>:<span class="st">&quot;16&quot;</span>,<span class="dt">&quot;ni&quot;</span>:<span class="st">&quot;0&quot;</span>,<span class="dt">&quot;virt&quot;</span>:<span class="dv">1603000</span>,<span class="dt">&quot;res&quot;</span>:<span class="dv">1000000</span>,<span class="dt">&quot;shr&quot;</span>:<span class="dv">1000000</span>,<span class="dt">&quot;s&quot;</span>:<span class="st">&quot;S&quot;</span>,<span class="dt">&quot;cpu&quot;</span>:<span class="fl">3.9</span>,<span class="dt">&quot;mem&quot;</span>:<span class="fl">27.4</span>,<span class="dt">&quot;times&quot;</span>:<span class="st">&quot;400:19.45&quot;</span>,<span class="dt">&quot;cmd0&quot;</span>:<span class="st">&quot;ora_j000&quot;</span>,<span class="dt">&quot;cmd&quot;</span>:<span class="st">&quot;ora_j000&quot;</span>}
{<span class="dt">&quot;index&quot;</span>:{}}
{<span class="dt">&quot;@timestamp&quot;</span>:<span class="st">&quot;2014-11-01 00:01:01&quot;</span>,<span class="dt">&quot;srv&quot;</span>:<span class="st">&quot;srv_A&quot;</span>,<span class="dt">&quot;pid&quot;</span>:<span class="dv">4645</span>,<span class="dt">&quot;user&quot;</span>:<span class="st">&quot;root&quot;</span>,<span class="dt">&quot;pr&quot;</span>:<span class="st">&quot;15&quot;</span>,<span class="dt">&quot;ni&quot;</span>:<span class="st">&quot;0&quot;</span>,<span class="dt">&quot;virt&quot;</span>:<span class="dv">6276</span>,<span class="dt">&quot;res&quot;</span>:<span class="dv">948</span>,<span class="dt">&quot;shr&quot;</span>:<span class="dv">668</span>,<span class="dt">&quot;s&quot;</span>:<span class="st">&quot;R&quot;</span>,<span class="dt">&quot;cpu&quot;</span>:<span class="fl">1.9</span>,<span class="dt">&quot;mem&quot;</span>:<span class="fl">0.0</span>,<span class="dt">&quot;times&quot;</span>:<span class="st">&quot;0:00.01&quot;</span>,<span class="dt">&quot;cmd0&quot;</span>:<span class="st">&quot;top&quot;</span>,<span class="dt">&quot;cmd&quot;</span>:<span class="st">&quot;top -b -n 1 -c&quot;</span>}</code></pre>
<h3 id="normal-size">NORMAL SIZE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">curl -XPOST <span class="st">&#39;http://{{ES_SERVER_ADDRESS}}/{{ES_INDEX_NAME}}/{{ES_TYPE_NAME}}/_bulk&#39;</span> --data-binary @IMPORTDATAFILE.json  <span class="kw">&gt;</span> /dev/null</code></pre>
<h3 id="laerge-size">LAERGE SIZE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">split</span> IMPORTDATAFILE.json -l 100000
<span class="kw">time</span> <span class="kw">for</span> f <span class="kw">in</span> x??; <span class="kw">do</span> curl -XPOST <span class="st">&#39;http://{{ES_SERVER_ADDRESS}}/{{ES_INDEX_NAME}}/{{ES_TYPE_NAME}}/_bulk&#39;</span> --data-binary @<span class="ot">$f</span> <span class="kw">&gt;</span> /dev/null; <span class="kw">done</span>
<span class="kw">rm</span> -f x??</code></pre>
<h2 id="search">SEARCH</h2>
<pre class="sourceCode bash"><code class="sourceCode bash">curl -XGET <span class="st">&#39;http://{{ES_SERVER_ADDRESS}}/{{ES_INDEX_NAME}}/{{ES_TYPE_NAME}}/_search&#39;</span></code></pre>
<h1 id="bz2">BZ2</h1>
<h3 id="extract">EXTRACT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">tar</span> jxvf FILE.tar.bz2</code></pre>
<h1 id="node">NODE</h1>
<h2 id="npm">npm</h2>
<h3 id="order-package">order PACKAGE</h3>
<h4 id="package.json">package.json</h4>
<p>dependencies に追加していく</p>
<pre class="sourceCode json"><code class="sourceCode json">{
  <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;tw&quot;</span>,
  <span class="dt">&quot;version&quot;</span>: <span class="st">&quot;1.0.0&quot;</span>,
  <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;&quot;</span>,
  <span class="dt">&quot;main&quot;</span>: <span class="st">&quot;index.js&quot;</span>,
  <span class="dt">&quot;scripts&quot;</span>: {
    <span class="dt">&quot;test&quot;</span>: <span class="st">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  },
  <span class="dt">&quot;author&quot;</span>: <span class="st">&quot;&quot;</span>,
  <span class="dt">&quot;license&quot;</span>: <span class="st">&quot;ISC&quot;</span>,
  <span class="dt">&quot;dependencies&quot;</span>: {
    <span class="dt">&quot;ntwitter&quot;</span>: <span class="st">&quot;~0.5.0&quot;</span>
  }
}</code></pre>
<h3 id="package-install">PACKAGE INSTALL</h3>
<p>bundler と違ってデフォルトでローカル ./node_modules/ にダウンロードされる</p>
<pre class="sourceCode bash"><code class="sourceCode bash">npm <span class="kw">install</span></code></pre>
<h1 id="cassandra">CASSANDRA</h1>
<h2 id="cqlsh">CQLSH</h2>
<h3 id="exec-cql-file">exec CQL file</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">cqlsh HOSTNAME -f FILENAME</code></pre>
<h3 id="cluster-status">CLUSTER STATUS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">nodetool status KEYSPACE</code></pre>
<h1 id="tcpdump">TCPDUMP</h1>
<pre class="sourceCode bash"><code class="sourceCode bash">tcpdump -Xs 256 -n -i eth1 dst port 50012</code></pre>
<h1 id="scheme">SCHEME</h1>
<h2 id="list">LIST</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">OPE</th>
<th style="text-align: center;">内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(car LIST)</td>
<td style="text-align: center;">リストの先頭要素を返す</td>
</tr>
<tr class="even">
<td style="text-align: left;">(cdr LIST)</td>
<td style="text-align: center;">リストの先頭要素を除いた要素を返す</td>
</tr>
</tbody>
</table>
<h1 id="closure">CLOSURE</h1>
<h2 id="what">What</h2>
<p>関数そのものに値を保持する仕組み。これが無いと大域汚染を伴うクラスやグローバル変数を使うことになる。この大域汚染は、特に複数のサードパーティライブラリを組み合わせる際に問題となる。</p>
<p>なので、データセットのダーティフラグとかしょうもない用事には CLOSURE を使う。</p>
<h3 id="examplejavascript">example:javascript</h3>
<pre class="sourceCode javascript"><code class="sourceCode javascript">#!/bin/env node

<span class="kw">function</span> outer(n) {
    <span class="kw">var</span> x = n;
    <span class="kw">return</span> <span class="kw">function</span>() {
        <span class="kw">console</span>.<span class="fu">log</span>(x);
        x = x + <span class="dv">1</span>;
    };
}

<span class="kw">var</span> f1 = outer(<span class="dv">1</span>);
<span class="kw">var</span> f2 = outer(<span class="dv">11</span>);

f1();
f1();
<span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;---&quot;</span>)
f2();
f2();
<span class="kw">console</span>.<span class="fu">log</span>(<span class="st">&quot;---&quot;</span>)
f1();
f1();</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash">$ node ./closure.js 
1
2
---
11
12
---
3
4</code></pre>
<h1 id="python">PYTHON</h1>
<h2 id="date-time">DATE &amp; TIME</h2>
<h3 id="what-time-now">what time now</h3>
<pre class="sourceCode python"><code class="sourceCode python"><span class="ch">import</span> datetime
datetime.datetime.today().strftime(<span class="st">&#39;%Y-%m-</span><span class="ot">%d</span><span class="st">_%H-%M-%S&#39;</span>)</code></pre>
<h1 id="crudsqlrest">CRUD/SQL/REST</h1>
<h2 id="basics">BASICs</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">OPE</th>
<th style="text-align: left;">CRUD</th>
<th style="text-align: left;">SQL</th>
<th style="text-align: left;">REST</th>
<th style="text-align: left;">$http</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">追加</td>
<td style="text-align: left;">Create</td>
<td style="text-align: left;">insert</td>
<td style="text-align: left;">post</td>
<td style="text-align: left;">BODY</td>
</tr>
<tr class="even">
<td style="text-align: left;">取得</td>
<td style="text-align: left;">Read</td>
<td style="text-align: left;">select</td>
<td style="text-align: left;">get</td>
<td style="text-align: left;">URI</td>
</tr>
<tr class="odd">
<td style="text-align: left;">更新</td>
<td style="text-align: left;">Update</td>
<td style="text-align: left;">update</td>
<td style="text-align: left;">put</td>
<td style="text-align: left;">BODY</td>
</tr>
<tr class="even">
<td style="text-align: left;">削除</td>
<td style="text-align: left;">Delete</td>
<td style="text-align: left;">delete</td>
<td style="text-align: left;">delete</td>
<td style="text-align: left;">URI</td>
</tr>
</tbody>
</table>
<h1 id="nkf">NKF</h1>
<h3 id="改行変換">改行変換</h3>
<h4 id="from-win">from Win</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">nkf -Lu AAA.txt</code></pre>
<h1 id="wget">WGET</h1>
<h2 id="ftp">FTP</h2>
<h3 id="ftp-get">FTP GET</h3>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">SERVER NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="WGET_FTP_SERVER" ng-init="WGET_FTP_SERVER='SERVER'">
</div>
</div>

<div class="form-group">
<label class="control-label col-xs-6">FTP USER</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="WGET_FTP_USER" ng-init="WGET_FTP_USER='user'">
</div>
</div>

<div class="form-group">
<label class="control-label col-xs-6">FTP PASSWORD</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="WGET_FTP_PASS" ng-init="WGET_FTP_PASS='passwd'">
</div>
</div>

<div class="form-group">
<label class="control-label col-xs-6">get FILE</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="WGET_GET_FILE" ng-init="WGET_GET_FILE='filename'">
</div>
</div>

</form>

<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">wget</span> --ftp-user=<span class="dt">{{WGET_FTP_USER}}</span> --ftp-password=<span class="dt">{{WGET_FTP_PASS}}</span> ftp://<span class="dt">{{WGET_FTP_SERVER}}/{{WGET_GET_FILE}}</span></code></pre>
<h1 id="sqlite3">SQLITE3</h1>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">DATABASE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="SQLITE_DB_NAME" ng-init="SQLITE_DB_NAME='./mnt'">
</div>
</div>

<div class="form-group">
<label class="control-label col-xs-6">TABLE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="SQLITE_TAB_NAME" ng-init="SQLITE_TAB_NAME='TAB'">
</div>
</div>

<div class="form-group">
<label class="control-label col-xs-6">SQL FILE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="SQLITE_SQL_FILE" ng-init="SQLITE_SQL_FILE='AAA.sql'">
</div>
</div>

</form>

<h2 id="database">DATABASE</h2>
<h3 id="createconnect-database">create/connect DATABASE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">sqlite3 <span class="dt">{{SQLITE_DB_NAME}}</span>.sqlite3</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">.databases</code></pre>
<h2 id="table">TABLE</h2>
<h3 id="csv-data-import">CSV DATA IMPORT</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.separator ,
.import <span class="kw">FILE</span> TAB</code></pre>
<h3 id="list-1">LIST</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.tables</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> name <span class="kw">from</span> sqlite_master <span class="kw">where</span> type=<span class="st">&#39;table&#39;</span> <span class="kw">order</span> <span class="kw">by</span> name;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> <span class="st">&#39;.import ./csv/&#39;</span> || name || <span class="st">&#39;.csv &#39;</span> || name <span class="kw">from</span> sqlite_master <span class="kw">where</span> type=<span class="st">&#39;table&#39;</span> <span class="kw">order</span> <span class="kw">by</span> name;</code></pre>
<h3 id="sql-from-file">SQL from FILE</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.read {{SQLITE_SQL_FILE}}</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">sqlite3 {{SQLITE_DB_NAME}} &lt; {{SQLITE_SQL_FILE}}</code></pre>
<h3 id="create-2">CREATE</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> {{SQLITE_TAB_NAME}} (
    <span class="kw">id</span> <span class="dt">integer</span> <span class="kw">not</span> <span class="kw">null</span> <span class="kw">primary</span> <span class="kw">key</span>
  , name text
  , notype
  , ts <span class="dt">timestamp</span> <span class="kw">default</span> (datetime(<span class="st">&#39;now&#39;</span>, <span class="st">&#39;localtaime&#39;</span>))
);</code></pre>
<h3 id="drop">DROP</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">create</span> <span class="kw">table</span> {{SQLITE_TAB_NAME}};</code></pre>
<h3 id="source">SOURCE</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">.schema {{SQLITE_TAB_NAME}}</code></pre>
<h1 id="emacs">EMACS</h1>
<h3 id="rect">RECT</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">key</th>
<th style="text-align: center;">move</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">C-x r k</td>
<td style="text-align: center;">矩形領域カット</td>
</tr>
<tr class="even">
<td style="text-align: center;">C-x r y</td>
<td style="text-align: center;">矩形領域ペースト</td>
</tr>
</tbody>
</table>
<h3 id="packeage">PACKEAGE</h3>
<p>M-x packeage-list-packeage</p>
<h1 id="escape-text">ESCAPE TEXT</h1>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">TEXT</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ESC_INPUT" ng-init="ESC_INPUT='http://hellowork/jobs'">
</div>
</div>

</form>

<pre class="sourceCode bash"><code class="sourceCode bash"><span class="dt">{{esc_ret()}}</span></code></pre>
<h1 id="ruby">RUBY</h1>
<h2 id="rbenv">rbenv</h2>
<h3 id="install">install</h3>
<p>git clone</p>
<h3 id="available-versions">available versions</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">rbenv <span class="kw">install</span> --list</code></pre>
<h3 id="install-1">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">rbenv <span class="kw">install</span> 2.1.2</code></pre>
<h3 id="init">init</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">rbenv global 2.1.2</code></pre>
<h2 id="ruby-build">ruby-build</h2>
<h3 id="install-2">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">git clone https://github.com/sstephenson/ruby-build.git .ruby-build
.ruby-build/install.sh</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">rm</span> -fr .ruby-build</code></pre>
<h3 id="install-version">install version</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">ruby-build 2.1.2 /usr/local</code></pre>
<h3 id="bundler">BUNDLER</h3>
<h4 id="init-1">init</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">bundle init</code></pre>
<h4 id="install-gems">install GEMS</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">bundle <span class="kw">install</span> --path=vendor/bundle</code></pre>
<h4 id="exec">exec</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">bundle <span class="kw">exec</span> ruby app.rb</code></pre>
<h2 id="json">JSON</h2>
<p>パースするとき no ASCII とかいわれたら。</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">LANG=</span>en_US.UTF8
locale</code></pre>
<p>ssh はログイン元の環境変数(LANG)を引継ぐため、意図せず &quot;ja_JP.UTF-8&quot; になってしまう。</p>
<h1 id="linux">LINUX</h1>
<h2 id="use-disc-media">USE DISC MEDIA</h2>
<form class="form-horizontal">
<div class="form-group">
<label class="control-label col-xs-6">FILE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ISO_FILEPATH" ng-init="ISO_FILEPATH='/filename.iso'">
</div>
</div>
<div class="form-group">
<label class="control-label col-xs-6">MOUNT POINT</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ISO_MOUNTPOINT" ng-init="ISO_MOUNTPOINT='/mnt/dvd'">
</div>
</div>
</form>



<h3 id="disc-to-iso-file">DISC to ISO FILE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> /dev/dvd <span class="ot">of=</span><span class="dt">{{ISO_FILEPATH}}</span></code></pre>
<h3 id="mount-iso-file">MOUNT ISO FILE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mkdir</span> -p <span class="dt">{{ISO_MOUNTPOINT}}</span>
<span class="kw">mount</span> -t iso9660 -o loop <span class="dt">{{ISO_FILEPATH}}</span> <span class="dt">{{ISO_MOUNTPOINT}}</span></code></pre>
<p>umount</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">umount</span> <span class="dt">{{ISO_MOUNTPOINT}}</span></code></pre>
<p>永続化</p>
<h6 id="etcfstab">/etc/fstab</h6>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> <span class="st">&quot;{{ISO_FILEPATH}} {{ISO_MOUNTPOINT}} iso9660 loop,ro,auto 0 0&quot;</span> <span class="kw">&gt;&gt;</span> /etc/fstab
<span class="kw">cat</span> /etc/fstab
<span class="kw">mount</span> -a</code></pre>
<h2 id="lock-tray">LOCK TRAY?</h2>
<p>VirtualBox やらの VM が邪魔してる場合あり。とめよ。</p>
<h2 id="make-swap">MAKE SWAP</h2>
<h3 id="on-file">on FILE</h3>
<form class="form-horizontal">
<div class="form-group">
<label class="control-label col-xs-6">SWAP FILE NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="LINUX_SWAP_FILE" ng-init="LINUX_SWAP_FILE='/swapfile'">
</div>
</div>
</form>

<p>example 255MB(4096x65536)</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> <span class="ot">if=</span>/dev/zero  of=<span class="dt">{{LINUX_SWAP_FILE}}</span> bs=4096 count=65536
<span class="ot">mkswap=</span><span class="dt">{{LINUX_SWAP_FILE}}</span>
<span class="kw">chmod</span> 600 <span class="dt">{{LINUX_SWAP_FILE}}</span>
swapon <span class="dt">{{LINUX_SWAP_FILE}}</span></code></pre>
<h4 id="etcfstab-1">/etc/fstab</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="dt">{{LINUX_SWAP_FILE}}</span> swap swap defaults</code></pre>
<h1 id="p2v">P2V</h1>
<h2 id="physical-drive-to-image-file">physical drive to image file</h2>
<h3 id="physical-drive-のセクタサイズを調べる">physical drive のセクタサイズを調べる</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> fdisk -l /dev/sda</code></pre>
<h4 id="出力例">出力例</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">ディスク /dev/sda: 500.1 GB, 500107862016 バイト
ヘッド 255, セクタ 63, シリンダ 60801
Units = シリンダ数 of 16065 * 512 = 8225280 バイト
セクタサイズ <span class="kw">(</span>論理 / 物理<span class="kw">):</span> 512 バイト / 512 バイト
I/O <span class="kw">size</span> <span class="kw">(</span>minimum/optimal<span class="kw">):</span> 512 bytes / 512 bytes
ディスク識別子: 0x6f16023a

デバイス ブート      始点        終点     ブロック   Id  システム
/dev/sda1   *           1          64      512000   83  Linux
パーティション 1 は、シリンダ境界で終わっていません。
/dev/sda2              64      121602   976254976   8e  Linux LVM</code></pre>
<h3 id="dd-コマンドでイメージファイル化">dd コマンドでイメージファイル化</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> <span class="ot">bs=</span>セクタサイズ if=/dev/sda of=sda.dd conv=sync,noerror</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> <span class="ot">bs=</span>セクタサイズ if=/dev/sda conv=sync,noerror <span class="kw">|</span> <span class="kw">gzip</span> -c9 <span class="kw">&gt;</span> sda.dd.gz</code></pre>
<h5 id="dd-の進捗表示">dd の進捗表示</h5>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> watch -n 60 <span class="st">&quot;pkill -USER1 dd&quot;</span></code></pre>
<h4 id="イメージファイルの中身確認">イメージファイルの中身確認</h4>
<h5 id="パーティションテーブル">パーティションテーブル</h5>
<pre class="sourceCode bash"><code class="sourceCode bash">fdisk -l sda.dd</code></pre>
<h5 id="マウントしてみる">マウントしてみる</h5>
<h2 id="image-file-to-vdi">image file to VDI</h2>
<p>自動的に圧縮（最小化ではない）される。</p>
<pre class="sourceCode bash"><code class="sourceCode bash">vboxmanage convertfromraw sda.dd sda.vdi</code></pre>
<h2 id="参考情報">参考情報</h2>
<h3 id="fsck-とかで起動しない場合">fsck とかで起動しない場合</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mount</span> -o remount,rw</code></pre>
<h3 id="ゼロ埋め">ゼロ埋め</h3>
<p>対象ドライブに cd して、</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">dd</span> <span class="ot">if=</span>/dev/zero of=zero bs=4k; \rm zero</code></pre>
<h3 id="圧縮">圧縮</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">vboxmanage modifyhd sda.vdi --compact</code></pre>
<h1 id="tmux">TMUX</h1>
<h2 id="new">NEW</h2>
<pre><code>tmux new -s &lt;session&gt;</code></pre>
<h2 id="kill">KILL</h2>
<pre><code>tmux kill-session -t &lt;session&gt;</code></pre>
<h1 id="git">GIT</h1>
<form class="form-horizontal">
<div class="form-group">
<label class="control-label col-sm-6">REPO NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_REPONAME" ng-init="GIT_REPONAME='dir/name.git'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">REPO ROOT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_ROOT" ng-init="GIT_ROOT='/var/lib/git'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">GIT SERVER NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_REMOTE" ng-init="GIT_REMOTE='192.168.0.10'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">GIT SERVER USER</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_USER" ng-init="GIT_USER='git'">
</div>
</div>
<div class="form-group">
<label class="control-label col-sm-6">GIT SERVER SSH PORT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_SSH" ng-init="GIT_SSH='2203'">
</div>
</div>
</form>



<h2 id="on-the-serverremote">on the SERVER(REMOTE)</h2>
<h3 id="create-remote-rep.">CREATE REMOTE REP.</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> <span class="kw">mkdir</span> -p <span class="dt">{{GIT_ROOT}}/{{GIT_REPONAME}}</span>
<span class="kw">cd</span> <span class="dt">{{GIT_ROOT}}/{{GIT_REPONAME}}</span>
<span class="kw">sudo</span> git init --bare --shared
<span class="kw">sudo</span> <span class="kw">chown</span> -R root:git .
<span class="kw">ls</span> -la</code></pre>
<h2 id="on-the-clientlocal">on the CLIENT(LOCAL)</h2>
<h3 id="create-local-rep.">CREATE LOCAL REP.</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">git init
git add .
git commit -m <span class="st">&quot;1st&quot;</span></code></pre>
<h3 id="push-to-remote">PUSH to REMOTE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">git remote add origin ssh://<span class="dt">{{GIT_USER}}@{{GIT_REMOTE}}:{{GIT_SSH}}{{GIT_ROOT}}/{{GIT_REPONAME}}</span>
git push origin master</code></pre>
<h3 id="clone">CLONE</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">git clone ssh://<span class="dt">{{GIT_USER}}@{{GIT_REMOTE}}:{{GIT_SSH}}{{GIT_ROOT}}/{{GIT_REPONAME}}</span></code></pre>
<h3 id="commit">COMMIT</h3>
<form class="form-horizontal">
<div class="form-group">
<label class="control-label col-sm-6">COMMIT COMMENT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="GIT_COMMENT" ng-init="GIT_COMMENT='テストコミット'">
</div>
</div>
</form>


<pre class="sourceCode bash"><code class="sourceCode bash">git add .
git commit -a -m <span class="st">&quot;{{GIT_COMMENT}}&quot;</span></code></pre>
<h3 id="commit-log">COMMIT LOG</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">git log</code></pre>
<h3 id="push">PUSH</h3>
<pre><code>git push origin master</code></pre>
<h3 id="pull">PULL</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">git pull origin master</code></pre>
<h1 id="docker">DOCKER</h1>
<h2 id="misc">MISC</h2>
<h3 id="install-3">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">yum <span class="kw">install</span> -y docker-io.x86_64</code></pre>
<h3 id="ps">PS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">watch -n 2 <span class="st">&#39;df -h; echo; free -m; echo; docker ps -a|head; echo; docker images -a&#39;</span></code></pre>
<h2 id="dockerfile">DOCKERFILE</h2>
<pre class="sourceCode bash"><code class="sourceCode bash">FROM centos:latest

<span class="co"># EPEL</span>
RUN rpm -i http://ftp.riken.jp/Linux/fedora/epel/6/i386/epel-release-6-8.noarch.rpm
RUN rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
RUN yum clean metadata

<span class="co"># yum</span>
RUN yum --enablerepo=epel <span class="kw">install</span> -y <span class="kw">\</span>
    <span class="kw">make</span> <span class="kw">\</span>
    <span class="kw">gcc</span> <span class="kw">\</span>
    zlib-devel <span class="kw">\</span>
    openssl-devel <span class="kw">\</span>
    readline-devel <span class="kw">\</span>
    ncurses-devel <span class="kw">\</span>
    gdbm-devel <span class="kw">\</span>
    db4-devel <span class="kw">\</span>
    libffi-devel <span class="kw">\</span>
    tk-devel <span class="kw">\</span>
    libyaml-devel <span class="kw">\</span>
    <span class="kw">tar</span> <span class="kw">\</span>
    git

<span class="co"># Install ruby-build</span>
RUN git clone https://github.com/sstephenson/ruby-build.git .ruby-build
RUN .ruby-build/install.sh
RUN <span class="kw">rm</span> -fr .ruby-build

<span class="co"># Install ruby</span>
RUN ruby-build 2.1.2 /usr/local

<span class="co"># Install bundler</span>
RUN gem update --system
RUN gem <span class="kw">install</span> bundler --no-rdoc --no-ri</code></pre>
<h1 id="iptables">IPTABLES</h1>
<pre class="sourceCode bash"><code class="sourceCode bash">● 現在の設定の確認
iptables -L

● FORWARDは使わない
iptables -P FORWARD DROP

● まずは全許可に
iptables -P INPUT ACCEPT

● デフォルトのルールを全て削除
iptables -F

● 自分自身からのパケットは全許可
iptables -A INPUT -i lo -j ACCEPT

● SSH許可 or SSH自分<span class="kw">(</span>255.255.255.255<span class="kw">)</span>だけ許可
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
 or
 iptables -A INPUT -s 255.255.255.255 -p tcp --dport 22 -j ACCEPT

● FTP<span class="kw">(</span>20,21,4000-4029<span class="kw">)</span> の接続を許可
iptables -A INPUT -p tcp --dport 20 -j ACCEPT
iptables -A INPUT -p tcp --dport 21 -j ACCEPT
iptables -A INPUT -p tcp --dport 4000:4029 -j ACCEPT

● http, https の接続を許可
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT

● POP<span class="kw">(</span>受信メール<span class="kw">)</span>の許可
iptables -A INPUT -p tcp --dport 110 -j ACCEPT

● SMTP<span class="kw">(</span>送信メール<span class="kw">)</span>の許可【これをしないと世間からメールが来なくなる！】
iptables -A INPUT -p tcp --dport 25 -j ACCEPT

● SUBMISSION ポートを開<span class="kw">放</span>
iptables -A INPUT -p tcp --dport 587 -j ACCEPT

● PostgreSQLも外から使います
iptables -A INPUT -p tcp --dport 5432 -j ACCEPT

● DNS関係
iptables -A INPUT -p tcp --dport 53 -j ACCEPT
iptables -A INPUT -p udp --dport 53 -j ACCEPT

● PINGを許可
iptables -A INPUT -p icmp -j ACCEPT

● TCPの接続開始と応答、FTPデータなどを許可【これをしないと外にメールが飛ばなくなる】
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

● 設定したルール以外のパケットを拒<span class="kw">否</span>
iptables -P INPUT DROP</code></pre>
<h3 id="port-forward">port forward</h3>
<h4 id="vsftpd">vsftpd</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">pasv_enable=</span>YES
<span class="ot">pasv_min_port=</span>20
<span class="ot">pasv_max_port=</span>20
<span class="ot">pasv_address=</span><span class="dt">{global_ip_address}</span>

iptables -I FORWARD -p tcp --dport 20 -j ACCEPT</code></pre>
<h2 id="command-graph">COMMAND GRAPH</h2>
<div id="docker_graph" style="width: 100%; height: 300px; border: 1px solid lightgray;">
  <div id="graph-navigation_wrapper" style="position: absolute; width: 100%; height: 300px;">
    <div id="graph-navigation_zoomExtends" class="graph-navigation zoomExtends">
    </div>
  </div>
  <div class="graph-frame" style="position: relative; overflow: hidden; width: 100%; height: 100%;">
    
<canvas style="position: relative; -webkit-user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); width: 100%; height: 100%"></canvas>
</div>
</div>

<script type="text/javascript">
var container = document.getElementById('docker_graph');
var data = {dot: 'digraph { \
\
REGISTER   [shape=box,fontColor=white,color=red]; \
Dockerfile [shape=box,fontColor=white,color=red]; \
IMAGE      [shape=box]; \
CONTAINER  [shape=box]; \
Running    [shape=circle]; \
Stoped     [shape=circle]; \
SAVEFILE   [shape=box]; \
EXPORTFILE [shape=box]; \
\
Dockerfile -- build -> IMAGE; \
\
REGISTER -- pull -> IMAGE ; \
REGISTER -- login  ; \
REGISTER -- search ; \
REGISTER -- tag    ; \
\
IMAGE -- push -> REGISTER  ; \
IMAGE -- run  -> CONTAINER ; \
IMAGE -- save -> SAVEFILE -- LOAD -> IMAGE ; \
IMAGE -- history ; \
IMAGE -- images  ; \
IMAGE -- insert  ; \
IMAGE -- rmi     ; \
IMAGE -- load    ; \
IMAGE -- inspect ; \
\
CONTAINER -- commit -> IMAGE      ; \
CONTAINER -- export -> EXPORTFILE -- import -> IMAGE ; \
CONTAINER -- Running ; \
CONTAINER -- Stoped  ; \
CONTAINER -- inspect ; \
CONTAINER -- logs    ; \
CONTAINER -- port    ; \
CONTAINER -- ps      ; \
CONTAINER -- diff    ; \
\
Running  -- attach   ; \
Running  -- cp       ; \
Running  -- top      ; \
Running  -- stop     [dir = none, weight = 100]; \
Running  -- kill     ; \
Running  -- restart  ; \
Running  -- wait     ; \
\
Stoped -- start -> Running ; \
Stoped -- rm ;    \
\
}'};
var graph = new vis.Graph(container, data);
</script>




<h2 id="use">USE</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">TARG REPOSITORY</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="DOCKER_TARG_REPO" ng-init="DOCKER_TARG_REPO='ubuntu'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">TARG TAG</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="DOCKER_TARG_TAG" ng-init="DOCKER_TARG_TAG='ruby2'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">IMAGE ID</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="DOCKER_IMAGE_ID" ng-init="DOCKER_IMAGE_ID='${IMAGE_ID}'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">CONTAINER ID</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="DOCKER_CONTAINER_ID" ng-init="DOCKER_CONTAINER_ID='${CONTAINER_ID}'">
</div>
</div>

</form>



<h3 id="build">BUILD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">docker build -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> .</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash">docker build --rm=<span class="kw">true</span> -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> .</code></pre>
<h3 id="run-stop">RUN / STOP</h3>
<h4 id="run">RUN</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">docker run -i -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> /bin/bash</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash">docker run -i -t <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> /usr/sbin/sshd -D</code></pre>
<h4 id="stop">STOP</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">docker stop <span class="dt">{{DOCKER_CONTAINER_ID}}</span></code></pre>
<h4 id="all-stop">ALL STOP</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">docker stop <span class="kw">`</span>docker <span class="kw">ps</span> -aq<span class="kw">`</span></code></pre>
<h3 id="commit-1">COMMIT</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">docker commit <span class="dt">{{DOCKER_CONTAINER_ID}}</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span></code></pre>
<h3 id="export-import">EXPORT / IMPORT</h3>
<p>差分統合される。</p>
<h4 id="export">EXPORT</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">docker <span class="kw">export</span> <span class="dt">{{DOCKER_CONTAINER_ID}}</span> <span class="kw">&gt;</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.export.tar</code></pre>
<h4 id="import">IMPORT</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cat</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.export.tar <span class="kw">|</span> docker import - <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span></code></pre>
<h3 id="save-load">SAVE / LOAD</h3>
<p>差分統合されない。</p>
<h4 id="save">SAVE</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">docker save <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span> <span class="kw">&gt;</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.save.tar</code></pre>
<h4 id="load">LOAD</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">docker load <span class="kw">&lt;</span> <span class="dt">{{DOCKER_TARG_REPO}}:{{DOCKER_TARG_TAG}}</span>.save.tar</code></pre>
<h3 id="remove-all-container">REMOVE ALL CONTAINER</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">docker <span class="kw">rm</span> <span class="kw">`</span>docker <span class="kw">ps</span> -aq<span class="kw">`</span></code></pre>
<h3 id="images-tree">images tree</h3>
<p>-tree もうすぐなくなる...</p>
<pre class="sourceCode bash"><code class="sourceCode bash">docker images -tree</code></pre>
<h3 id="all-images-list">all images list</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">docker images -a</code></pre>
<h3 id="remove-images">remove images</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">docker rmi <span class="kw">&lt;</span>IMAGE ID<span class="kw">&gt;</span> </code></pre>
<h3 id="remove-all-homeless-images">remove all homeless images</h3>
<p>消えないもの</p>
<ul>
<li>コミット済み image に依存されている？</li>
<li>コンテナが残っとる？</li>
<li>コンテナが動いとる？</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash">docker rmi <span class="ot">$(</span>docker images -a <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;/^&lt;none&gt;/ {print $3}&#39;</span><span class="ot">)</span> </code></pre>
<h3 id="all-clear">ALL CLEAR</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">docker stop <span class="kw">`</span>docker <span class="kw">ps</span> -aq<span class="kw">`</span>
docker <span class="kw">rm</span> <span class="kw">`</span>docker <span class="kw">ps</span> -aq<span class="kw">`</span>
docker rmi <span class="ot">$(</span>docker images -a <span class="kw">|</span> <span class="kw">awk</span> <span class="st">&#39;{print $3}&#39;</span><span class="ot">)</span></code></pre>
<p>docker rmi $(docker images -a | awk '{print $3}')</p>
<h2 id="boot2docker">boot2docker</h2>
<h3 id="install-4">install</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">brew <span class="kw">install</span> docker boot2docker</code></pre>
<h3 id="up">up</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">boot2docker init
boot2docker up</code></pre>
<h3 id="ssh">ssh</h3>
<p>password: tcuser</p>
<pre class="sourceCode bash"><code class="sourceCode bash">boot2docker <span class="kw">ssh</span></code></pre>
<h3 id="docker_host">DOCKER_HOST</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">DOCKER_HOST=</span>tcp://localhost:4243</code></pre>
<h1 id="ansible">ANSIBLE</h1>
<h2 id="basics-1">BASICS</h2>
<h3 id="ping">ping</h3>
<p>実行前に接続できるか確認する。</p>
<pre class="sourceCode bash"><code class="sourceCode bash">ansible -i hosts all -m <span class="kw">ping</span></code></pre>
<h3 id="run-playbook">run playbook</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">ansible-playbook -i hosts site.yml</code></pre>
<h2 id="roll">roll</h2>
<h3 id="send-file">send file</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> copy CENTOS iso file 1
  <span class="fu">copy:</span> src=CentOS-6.5-x86_64-bin-DVD1.iso dest=/mnt/ owner=root group=root mode=644</code></pre>
<h3 id="mkdir">mkdir</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> make mount position
  <span class="fu">file:</span> path=/mnt/CentOS-6.5_1 owner=root group=root mode=644 state=directory</code></pre>
<h3 id="mod-file-line">mod file line</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> MODFILE &quot;yum.conf&quot;
  <span class="fu">lineinfile:</span> dest=/etc/yum.conf  regexp=^keepcache  line=keepcache=1</code></pre>
<h3 id="yums">yums</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> yum install depend pkg
  <span class="fu">yum:</span> name={{ item }} state=installed disablerepo=* enablerepo=c6-media
  <span class="fu">with_items:</span>
<span class="er">    - compat-libstdc++-33</span>
<span class="er">    - elfutils-libelf-devel</span>
<span class="er">    - elfutils-libelf-devel-static</span>
<span class="er">    - gcc</span>
<span class="er">    - gcc-c++</span>
<span class="er">    - glibc-devel</span>
<span class="er">    - glibc-headers</span>
<span class="er">    - kernel-headers</span>
<span class="er">    - libaio-devel</span>
<span class="er">    - libgomp</span>
<span class="er">    - libstdc++-devel</span>
<span class="er">    - sysstat</span></code></pre>
<h3 id="add-group-user">add group &amp; user</h3>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> create group
  <span class="fu">group:</span> name={{item.name}} gid={{item.gid}} state=present
  <span class="fu">with_items:</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> &quot;oinstall&quot; <span class="kw">, </span><span class="fu">gid:</span> 701<span class="kw">}</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> &quot;dba&quot;      <span class="kw">, </span><span class="fu">gid:</span> 702<span class="kw">}</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> &quot;oracle&quot;   <span class="kw">, </span><span class="fu">gid:</span> 703<span class="kw">}</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> &quot;oper&quot;     <span class="kw">, </span><span class="fu">gid:</span> 704<span class="kw">}</span>

<span class="kw">-</span> <span class="fu">name:</span> create user
  <span class="fu">user:</span> name={{item.name}} uid={{item.uid}} password={{item.pass}} group=oinstall groups=dba,oper createhome=yes state=present
  <span class="fu">with_items:</span>
    <span class="kw">-</span> <span class="kw">{</span> <span class="fu">name:</span> &quot;oracle&quot; <span class="kw">, </span><span class="fu">uid:</span> 701<span class="kw">,</span> <span class="fu">pass:</span> &quot;$1$SomeSalt$c7SWNheGRHNaCLwuAG7Sa.&quot; <span class="kw">}</span></code></pre>
<h4 id="make-password">make password</h4>
<pre class="sourceCode python"><code class="sourceCode python">python -c <span class="st">&#39;import crypt; print crypt.crypt(&quot;REPLACE:username&quot;, &quot;$1$SomeSalt$&quot;)&#39;</span></code></pre>
<h4 id="exec-shell-command">exec shell command</h4>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="kw">-</span> <span class="fu">name:</span> yum install
  <span class="fu">shell:</span> yum --disablerepo=\* -y localinstall /opt/rpm/*.rpm &gt; /opt/rpm/res.txt</code></pre>
<p>command もあるが、なんか違う。</p>
<h1 id="test">test</h1>
<h2 id="ファイルの有無">ファイルの有無</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">test</span> ! -e /vagrant/rpm/gitlab-7.3.2_omnibus-1.el6.x86_64.rpm; <span class="kw">echo</span> <span class="ot">$?</span></code></pre>
<h1 id="grep">grep</h1>
<h2 id="and">AND</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> <span class="st">&#39;AAA&#39;</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">&#39;BBB&#39;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> <span class="st">&#39;AAA.*BBB&#39;</span></code></pre>
<h2 id="or">OR</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> <span class="st">&#39;AAA\|BBB&#39;</span></code></pre>
<h2 id="not">NOT</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -v <span class="st">&#39;AAA&#39;</span></code></pre>
<h2 id="前後も表示">前後も表示</h2>
<ul>
<li>-B マッチ「前」の行数</li>
<li>-A マッチ「後」の行数</li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -B 3 -A 3 <span class="st">&#39;xyz&#39;</span> *.txt</code></pre>
<h1 id="sed">sed</h1>
<h2 id="ファイルを直接置換え">ファイルを直接置換え</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sed</span> -i -e <span class="st">&#39;s/AAA/ZZZ/g&#39;</span> FILENAME.txt</code></pre>
<h1 id="echo">echo</h1>
<h2 id="改行しない">改行しない</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> -n <span class="st">&#39;ZZZ...&#39;</span></code></pre>
<h2 id="colorstyle">COLOR/STYLE</h2>
<h3 id="green">GREEN</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">          \e[32m  \e[m
          <span class="kw">&lt;</span>----<span class="kw">&gt;</span>  <span class="kw">&lt;</span>--<span class="kw">&gt;</span>
<span class="kw">echo</span> -e <span class="st">&#39;[\e[32mOK\e[m]&#39;</span></code></pre>
<h3 id="red">RED</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">          \e[31m  \e[m
          <span class="kw">&lt;</span>----<span class="kw">&gt;</span>  <span class="kw">&lt;</span>--<span class="kw">&gt;</span>
<span class="kw">echo</span> -e <span class="st">&#39;[\e[31mNG\e[m]&#39;</span></code></pre>
<h3 id="bold">BOLD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">         \e[1m         \e[m
         <span class="kw">&lt;</span>---<span class="kw">&gt;</span>         <span class="kw">&lt;</span>--<span class="kw">&gt;</span>
<span class="kw">echo</span> -e <span class="st">&#39;\e[1mI AM BOLD\e[m&#39;</span></code></pre>
<h3 id="red-bold">RED + BOLD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">            \e[1m\e[31m        \e[m
            <span class="kw">&lt;</span>---<span class="kw">&gt;&lt;</span>----<span class="kw">&gt;</span>        <span class="kw">&lt;</span>--<span class="kw">&gt;</span>
<span class="kw">echo</span> -e <span class="st">&#39;zzz\e[1m\e[31mRED+BOLD\e[mzzz&#39;</span></code></pre>
<h3 id="what-ever">What Ever</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> -e <span class="st">&quot;</span>
<span class="st"># Attribute codes:</span>
<span class="st"># 00=none 01=bold 04=underscore 05=blink 07=reverse 08=concealed</span>
<span class="st"># Text color codes:</span>
<span class="st"># 30=black 31=red 32=green 33=yellow 34=blue 35=magenta 36=cyan 37=white</span>
<span class="st"># Background color codes:</span>
<span class="st"># 40=black 41=red 42=green 43=yellow 44=blue 45=magenta 46=cyan 47=white</span>

<span class="st">状態番号</span>
<span class="st">\033[00m デフォルト状態 00 \033[00m</span>
<span class="st">\033[01m 強調           01 \033[00m</span>
<span class="st">\033[04m 下線           04 \033[00m</span>
<span class="st">\033[05m 点滅           05 \033[00m</span>
<span class="st">\033[07m 色反転         07 \033[00m</span>
<span class="st">\033[08m 塗りつぶし     08 \033[00m(塗りつぶし 08)</span>

<span class="st">色番号</span>
<span class="st">\033[30m 黒               30 \033[00m \033[40m 40 \033[00m \033[31;40m 31;40 \033[00m \033[32;00;40m 32;00;40 \033[00m</span>
<span class="st">\033[31m 赤               31 \033[00m \033[41m 41 \033[00m \033[32;41m 32;41 \033[00m \033[33;01;41m 33;01;41 \033[00m</span>
<span class="st">\033[32m 緑               32 \033[00m \033[42m 42 \033[00m \033[33;42m 33;42 \033[00m \033[34;04;42m 34;04;42 \033[00m</span>
<span class="st">\033[33m 黄(または茶)     33 \033[00m \033[43m 43 \033[00m \033[34;43m 34;43 \033[00m \033[35;05;43m 35;05;43 \033[00m</span>
<span class="st">\033[34m 青               34 \033[00m \033[44m 44 \033[00m \033[35;44m 35;44 \033[00m \033[36;07;44m 36;07;44 \033[00m</span>
<span class="st">\033[35m 紫               35 \033[00m \033[45m 45 \033[00m \033[36;45m 36;45 \033[00m \033[37;00;45m 37;00;45 \033[00m</span>
<span class="st">\033[36m シアン           36 \033[00m \033[46m 46 \033[00m \033[37;46m 37;46 \033[00m \033[30;01;46m 30;01;46 \033[00m</span>
<span class="st">\033[37m 白(またはグレー) 37 \033[00m \033[47m 47 \033[00m \033[30;47m 30;47 \033[00m \033[31;04;47m 31;04;47 \033[00m</span>
<span class="st">&quot;</span></code></pre>
<h1 id="iconv">iconv</h1>
<p>Windows SJIS は、 SHIFT_JISX0213 とすべし。</p>
<h2 id="文字コード一覧表示">文字コード一覧表示</h2>
<pre class="sourceCode bash"><code class="sourceCode bash">iconv -l</code></pre>
<h2 id="euc---utf-8">EUC -&gt; UTF-8</h2>
<pre class="sourceCode bash"><code class="sourceCode bash">iconv -f EUC-JP -t UTF-8 FILE -o FILE.utf8</code></pre>
<h2 id="sjis---utf-8">SJIS -&gt; UTF-8</h2>
<pre class="sourceCode bash"><code class="sourceCode bash">iconv -f SHIFT_JISX0213 -t UTF-8 FILE -o FILE.utf8</code></pre>
<h2 id="一括処理">一括処理</h2>
<h3 id="カレントディレクトリ以下">カレントディレクトリ以下</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">find</span> -type f <span class="kw">|</span> <span class="kw">xargs</span> <span class="kw">file</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="st">&quot;:.*text&quot;</span> <span class="kw">|</span> <span class="kw">cut</span> -d <span class="kw">:</span> -f1 <span class="kw">|</span> <span class="kw">xargs</span> -t -I<span class="dt">{}</span> iconv -f EUC-JP -t UTF-8 <span class="dt">{}</span> -o <span class="dt">{}</span>.utf8</code></pre>
<h1 id="ファイルの内容置換">ファイルの内容置換</h1>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">BEFOR</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_REPLACE_BEFOR" ng-init="CMD_REPLACE_BEFOR='BEFOR'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">AFTER</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_REPLACE_AFTER" ng-init="CMD_REPLACE_AFTER='AFTER'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">FILENAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_REPLACE_FILENAME" ng-init="CMD_REPLACE_FILENAME='*.html'">
</div>
</div>

</form>


<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">grep</span> -rl <span class="st">&quot;{{CMD_REPLACE_BEFOR}}&quot;</span> */<span class="dt">{{CMD_REPLACE_FILENAME}}</span>
<span class="kw">perl</span> -p -i.befor -e <span class="st">&#39;s/{{CMD_REPLACE_BEFOR}}/{{CMD_REPLACE_AFTER}}/g&#39;</span> <span class="dt">{{CMD_REPLACE_FILENAME}}</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">find</span> <span class="kw">.</span> -name <span class="st">&#39;{{CMD_REPLACE_FILENAME}}&#39;</span> -type f -exec <span class="kw">sed</span> -i <span class="st">&#39;s/{{CMD_REPLACE_BEFOR}}/{{CMD_REPLACE_AFTER}}/g&#39;</span> <span class="dt">{}</span> <span class="dt">\;</span></code></pre>
<h1 id="date">date</h1>
<h2 id="from-通算秒-to-日時">from 通算秒 to 日時</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span> -d <span class="st">&quot;1970-01-01 UTC 4294967295 seconds&quot;</span> <span class="st">&#39;+%Y-%m-%d %H:%M:%S&#39;</span></code></pre>
<h2 id="from-日時-to-通算秒">from 日時 to 通算秒</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span> -d <span class="st">&quot;2000-01-01 00:00:00&quot;</span> +%s</code></pre>
<h2 id="watch">WATCH</h2>
<pre class="sourceCode bash"><code class="sourceCode bash">watch -t -n 0.1 --no-title <span class="st">&quot;date  +&#39;%n +------------+%n | %Y-%m-%d |%n +------------+%n |  %H:%M:%S  |%n +------------+%n | %N0 |%n +------------+%n | %s |%n +------------+&#39;&quot;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">while</span> <span class="kw">true</span>;<span class="kw">do</span> <span class="kw">date</span> +<span class="st">&quot;%Y-%m-%d %H:%M:%S.%N&quot;</span>;<span class="kw">sleep</span> 1;<span class="kw">done</span></code></pre>
<h2 id="timer">TIMER</h2>
<pre class="sourceCode bash"><code class="sourceCode bash">watch -n 0.1 --no-title <span class="st">&#39;expr `date +%s -d &quot;2020-12-31 23:59:59&quot;` - `date +%s`&#39;</span></code></pre>
<h2 id="日時書式">日時書式</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span>
<span class="kw">date</span> +<span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span></code></pre>
<h2 id="offset">OFFSET</h2>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">date</span>
<span class="kw">date</span> -d <span class="st">&quot;12 hours ago&quot;</span>
<span class="kw">date</span> -d <span class="st">&quot;12 hours&quot;</span></code></pre>
<h3 id="ファイル検索-コマンド実行">ファイル検索 &amp; コマンド実行</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">find</span> <span class="kw">|</span> <span class="kw">grep</span> <span class="kw">&lt;</span>検索文字<span class="kw">&gt;</span> <span class="kw">|</span> <span class="kw">xargs</span> <span class="kw">&lt;</span>コマンド<span class="kw">&gt;</span></code></pre>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">FILE1</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_FILE1" ng-init="CMD_FILE1='file1'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">FILE2</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CMD_FILE2" ng-init="CMD_FILE2='file2'">
</div>
</div>

</form>




<h3 id="ナイスな-diff">ナイスな diff</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">diff</span> -y --suppress-common-lines <span class="dt">{{CMD_FILE1}}</span> <span class="dt">{{CMD_FILE2}}</span></code></pre>
<h3 id="ファイルの単純横結合">ファイルの単純横結合</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">paste  <span class="dt">{{CMD_FILE1}}</span> <span class="dt">{{CMD_FILE2}}</span></code></pre>
<h3 id="プロンプト反転">プロンプト反転</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">PS1=</span><span class="st">&quot;\[\033[07m\][\u@</span><span class="ot">${HOSTNAME}</span><span class="st"> \W]</span><span class="dt">\\</span><span class="st">$\[\033[00m\] &quot;</span></code></pre>
<h3 id="pgrep">pgrep</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">pgrep procname*</code></pre>
<h4 id="pkill-and-kill">pkill and kill</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">pgrep procname* <span class="kw">|</span> <span class="kw">xargs</span> <span class="kw">kill</span> -9</code></pre>
<h3 id="exfat">exfat</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> <span class="kw">mount</span> -t exfat-fuse /dev/sde1 /media/exfat
<span class="kw">umount</span> /media/exfat</code></pre>
<h3 id="lang">LANG</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">LANG=</span>en_US.UTF-8</code></pre>
<h3 id="scp">scp</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">scp</span> -P 22 -rq tcp/ username@192.168.33.32:/home/aaa/</code></pre>
<h1 id="vi">VI</h1>
<h2 id="edit">EDIT</h2>
<h3 id="置換え">置換え</h3>
<h4 id="確認あり">確認あり</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">:%s/前/後/gc</code></pre>
<h4 id="確認なし">確認なし</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">:%s/前/後/g</code></pre>
<h2 id="view">VIEW</h2>
<h3 id="カーソル移動">カーソル移動</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">key</th>
<th style="text-align: left;">move</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1G</td>
<td style="text-align: left;">1 行目のあたま</td>
</tr>
<tr class="even">
<td style="text-align: center;">G</td>
<td style="text-align: left;">最終行のケツ</td>
</tr>
<tr class="odd">
<td style="text-align: center;">~</td>
<td style="text-align: left;">今の行のあたま</td>
</tr>
<tr class="even">
<td style="text-align: center;">$</td>
<td style="text-align: left;">今の行のケツ</td>
</tr>
</tbody>
</table>
<h1 id="windows">WINDOWS</h1>
<h2 id="network">NETWORK</h2>
<p>ドス窓は管理者権限で実行</p>
<h3 id="ip-アドレス設定">IP アドレス設定</h3>
<pre><code>netsh interface ipv4 set address name=&quot;ローカル エリア接続&quot; addr=192.2.56.111 mask=255.255.255.0 gateway=192.2.56.1</code></pre>
<h3 id="ip-アドレス追加">IP アドレス追加</h3>
<p>追加の場合は gateway 不要</p>
<pre><code>netsh interface ipv4 add address name=&quot;ローカル エリア接続&quot; addr=192.2.56.111 mask=255.255.255.0</code></pre>
<h3 id="ip-アドレス削除">IP アドレス削除</h3>
<pre><code>netsh interface ipv4 del address name=&quot;ローカル エリア接続&quot; addr=192.2.56.111</code></pre>
<h3 id="各種情報収集">各種情報収集</h3>
<pre><code>mkdir .\%COMPUTERNAME%
cd .\%COMPUTERNAME%

echo &quot;&quot;        &gt; 10_SYSTEM
systeminfo     &gt; 11_SYSTEM__systeminfo.txt
msinfo32 /report 12_SYSTEM__msinfo32.txt

echo &quot;&quot;        &gt; 20_NETWORK
ipconfig /all  &gt; 21_NETWORK__ipconfig_all.txt
route print    &gt; 22_NETWORK__route_print.txt
netstat -sp    &gt; 23_NETWORK__netstat_sp.txt
netstat -e     &gt; 24_NETWORK__netstat_e.txt
net use        &gt; 25_NETWORK__net_use.txt

echo &quot;&quot;            &gt; 30_TASK
schtasks /query /V &gt; 31_TASK__shttasks.txt
tasklist           &gt; 32_TASK__tasklist.txt
tasklist /svc      &gt; 33_TASK__tasklist_svc.txt
tasklist /m        &gt; 34_TASK__tasklist_m.txt

echo &quot;&quot;                        &gt; 40_LOG
wevutil qe system      /f:TEXT &gt; 41_LOG__wevutil_qe_system.txt
wevutil qe Application /f:TEXT &gt; 42_LOG__wevutil_qe_application.txt</code></pre>
<h1 id="nxr120">NXR120</h1>
<h2 id="web">Web</h2>
<pre><code>http://IPADDRESS:880/
(admin/admin)</code></pre>
<h2 id="ssh-1">ssh</h2>
<h3 id="設定の確認">設定の確認</h3>
<pre><code>show config</code></pre>
<h3 id="default-gateway">default gateway</h3>
<pre><code>configure terminal
ip route 0.0.0.0/0 196.1.58.1
exit
save config</code></pre>
<h3 id="nat">1:1 NAT</h3>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">ethernet0 IP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="nxr_e0ip" ng-init="nxr_e0ip='192.168.0.1'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">host IP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="NXR_RIP" ng-init="NXR_RIP='192.168.0.10'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">ethernet1 IP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="nxr_e1ip" ng-init="nxr_e1ip='11.22.33.44'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">host virtIP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="nxr_vip" ng-init="nxr_vip='11.22.33.10'">
</div>
</div>

</form>




<pre><code>show config
configure terminal

system dnat-group DNAT
system snat-group SNAT
ip dnat DNAT ip any {{nxr_vip}} {{NXR_RIP}}
ip snat SNAT ip {{NXR_RIP}} any {{nxr_vip}}

interface ethernet 0

  ip address {{nxr_e0ip}}/24
  ip snat-group SNAT
  exit

interface ethernet 1

  ip address {{nxr_e1ip}}/24
  ip address {{nxr_vip}}/24 secondary
  ip dnat-group DNAT
  exit

exit
save config
restart</code></pre>
<h3 id="ip-filter">ip filter</h3>
<pre><code>configure terminal

ip access-list 55555 permit any any tcp any 55555
ip access-list eth0_in permit 196.1.58.0/24 192.1.58.220/32 tcp any 880
ip access-list eth0_in permit any any icmp
ip access-list eth0_in deny any any
ip access-list eth1_forward_in permit 195.200.58.33 any tcp any range 1024 65535
ip access-list eth1_forward_in permit any any icmp
ip access-list eth1_forward_in permit any any tcp any range 80 81
ip access-list eth1_forward_in permit any any tcp any 8081
ip access-list eth1_forward_in permit any any tcp any 8084
ip access-list eth1_forward_in permit any any tcp range 80 81 any
ip access-list eth1_forward_in permit any any tcp 8081 any
ip access-list eth1_forward_in permit any any tcp 8084 any
ip access-list eth1_forward_in permit 196.1.58.0/24 195.200.58.33/32 tcp any range 1024 65535
ip access-list eth1_forward_in deny any any
ip access-list eth1_in permit 195.200.58.33/32 any tcp any 80
ip access-list eth1_in permit 195.200.58.33/32 any tcp any range 1024 65535
ip access-list eth1_in permit any any icmp
ip access-list eth1_in deny any any

exit
save config
restart</code></pre>
<h3 id="設定の無効化">設定の無効化</h3>
<pre><code>頭に no をつける</code></pre>
<h1 id="ssh-2">SSH</h1>
<h2 id="no-pass-login">NO PASS LOGIN</h2>
<h3 id="on-local">on LOCAL</h3>
<h4 id="keygen">keygen</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">ssh-keygen</span>
<span class="kw">ssh-add</span> ./id_rsa...?
<span class="kw">cat</span> ~/.ssh/id_rsa.pub</code></pre>
<h3 id="on-server">on SERVER</h3>
<h4 id="paste">paste</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">/home/USERNAME/.ssh/authorized_keys</code></pre>
<h1 id="centos">CENTOS</h1>
<h2 id="single-user-mode">single user mode</h2>
<ul>
<li>起動カウントダウン中に [ENTER] を押す。</li>
<li>karnel... の行を選んで [e] を押す。</li>
<li>起動オプションの末尾に [スペース]+single を追記して [ENTER] を押す。</li>
<li>karnel... の行を選んで [b] を押す。</li>
</ul>
<h2 id="selinux">SELINUX</h2>
<h3 id="状況確認">状況確認</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">getenforce</code></pre>
<h3 id="一時的な-off">一時的な OFF</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">setenforce 0</code></pre>
<h3 id="恒久的な-off">恒久的な OFF</h3>
<h4 id="etcselinuxconfig">/etc/selinux/config</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">SELINUX=</span>disabled</code></pre>
<h2 id="network-1">NETWORK</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">I/F NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="CENT_NET_IFNAME" ng-init="CENT_NET_IFNAME='eth0'">
</div>
</div>

</form>



<h3 id="ip-アドレスリンクスピード固定化">IP アドレス・リンクスピード固定化</h3>
<h4 id="etcsysconfignetwork-scriptsifcfg-eth0">/etc/sysconfig/network-scripts/ifcfg-eth0</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">HWADDR=</span>XX:XX:XX:XX:XX:XX
<span class="ot">DEVICE=</span><span class="dt">{{CENT_NET_IFNAME}}</span>
<span class="ot">BOOTPROTO=</span>none
<span class="ot">ONBOOT=</span>yes
<span class="ot">USERCTL=</span>no
<span class="ot">IPV6INIT=</span>no
<span class="ot">PEERDNS=</span>no
<span class="ot">TYPE=</span>Ethernet
<span class="ot">IPADDR=</span>192.168.1.10
<span class="ot">NETMASK=</span>255.255.255.0
<span class="ot">ETHTOOL_OPTS=</span><span class="st">&quot;autoneg off speed 10 duplex full&quot;</span></code></pre>
<h4 id="sudo">sudo</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">service network restart</code></pre>
<h3 id="ip-エイリアス">IP エイリアス</h3>
<h4 id="sudo-1">sudo</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> /etc/sysconfig/network-scripts
<span class="kw">cp</span> ifcfg-<span class="dt">{{CENT_NET_IFNAME}}</span> ifcfg-<span class="dt">{{CENT_NET_IFNAME}}</span>:1</code></pre>
<h4 id="etcsysconfignetwork-scriptsifcfg-cent_net_ifname1">/etc/sysconfig/network-scripts/ifcfg-{{CENT_NET_IFNAME}}:1</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">HWADDR=</span>XX:XX:XX:XX:XX:XX
<span class="ot">DEVICE=</span><span class="dt">{{CENT_NET_IFNAME}}</span>:1
<span class="ot">BOOTPROTO=</span>none
<span class="ot">ONBOOT=</span>yes
<span class="ot">USERCTL=</span>no
<span class="ot">IPV6INIT=</span>no
<span class="ot">PEERDNS=</span>no
<span class="ot">TYPE=</span>Ethernet
<span class="ot">IPADDR=</span>192.168.1.10
<span class="ot">NETMASK=</span>255.255.255.0
<span class="ot">ETHTOOL_OPTS=</span><span class="st">&quot;autoneg off speed 10 duplex full&quot;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash">service network restart</code></pre>
<h3 id="スタティックルート">スタティックルート</h3>
<h4 id="etcsysconfigstatic-routes">/etc/sysconfig/static-routes</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">any net 123.1.2.0 netmask 255.255.255.0 gw 192.168.0.201</code></pre>
<h4 id="sudo-2">sudo</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">service network restart</code></pre>
<h3 id="デフォルトゲートウェイホスト名">デフォルトゲートウェイ・ホスト名</h3>
<h4 id="etcsysconfignetwork">/etc/sysconfig/network</h4>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">NETWORKING=</span>yes
<span class="ot">NETWORKING_IPV6=</span>no
<span class="ot">HOSTNAME=</span>SERVERNAME
<span class="ot">GATEWAY=</span>192.168.0.123</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash">service network restart</code></pre>
<h2 id="yum">YUM</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">PKG NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="YUM_PKG" ng-init="YUM_PKG='httpd'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">OPT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="YUM_OPT" ng-init="YUM_OPT='--disablerepo=\\* --enablerepo=c6-media'">
</div>
</div>

</form>





<h3 id="onoff-repo">ON/OFF REPO</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">yum --disablerepo=<span class="dt">\*</span> --enablerepo=c6-media ...</code></pre>
<h3 id="packages-dependencies">package's dependencies</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">yum deplist <span class="dt">{{YUM_PKG}}</span> <span class="dt">{{YUM_OPT}}</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash">yum deplist <span class="dt">{{YUM_PKG}}</span> <span class="dt">{{YUM_OPT}}</span> <span class="kw">|</span> <span class="kw">grep</span> provider</code></pre>
<h3 id="download">DOWNLOAD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">yumdownloader --resolve <span class="dt">{{YUM_PKG}}</span></code></pre>
<h3 id="install-local-rpm">INSTALL LOCAL RPM</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">yum --disablerepo=<span class="dt">\*</span> -y localinstall ./*.rpm</code></pre>
<h3 id="list-2">LIST</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">yum <span class="dt">{{YUM_OPT}}</span> list</code></pre>
<h1 id="chef">CHEF</h1>
<h2 id="misc-1">MISC</h2>
<h3 id="create-cookbok">CREATE cookbok</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">knife cookbook create app -o site-cookbooks</code></pre>
<h1 id="virualbox">VirualBox</h1>
<h2 id="image">image</h2>
<h3 id="from-vmware">from vmware</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">VBoxManage clonehd --format VDI cyua.vmdk cyua.vdi</code></pre>
<h1 id="vagrant">VAGRANT</h1>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-sm-6">BOX FILE</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_BOX_FILE" ng-init="VAG_BOX_FILE='./package.box'">
</div>
</div>


<div class="form-group">
<label class="control-label col-sm-6">BOX NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_BOX_NAME" ng-init="VAG_BOX_NAME='centos65-x86_64-20131205'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">VM NAME</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_VM_NAME" ng-init="VAG_VM_NAME='vm1'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">VM STATIC IP</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_VM_IP" ng-init="VAG_VM_IP='192.168.0.111'">
</div>
</div>

<div class="form-group">
<label class="control-label col-sm-6">VM SSH PORT</label>
<div class="col-sm-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="VAG_SSH_PORT" ng-init="VAG_SSH_PORT='2205'">
</div>
</div>

</form>

<h2 id="box">BOX</h2>
<h3 id="add">ADD</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant box add <span class="dt">{{VAG_BOX_NAME}}</span> <span class="dt">{{VAG_BOX_FILE}}</span>
vagrant box list</code></pre>
<h3 id="vms-status">VMs STATUS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant global-status</code></pre>
<h2 id="vagrantfile">Vagrantfile</h2>
<pre class="sourceCode ruby"><code class="sourceCode ruby"><span class="co"># -*- mode: ruby -*-</span>
<span class="co"># vi: set ft=ruby :</span>

<span class="dt">VAGRANTFILE_API_VERSION</span> = <span class="st">&quot;2&quot;</span>

<span class="dt">NUM_INSTANCES</span> = <span class="dv">2</span>
<span class="dt">BASE_IP_ADDR</span>  = <span class="dt">ENV</span>[<span class="st">&#39;BASE_IP_ADDR&#39;</span>] || <span class="st">&quot;192.168.100&quot;</span>


<span class="dt">Vagrant</span>.configure(<span class="dt">VAGRANTFILE_API_VERSION</span>) <span class="kw">do</span> |config|

  config.vm.box = <span class="st">&quot;chef/centos-6.5&quot;</span>
  config.vm.synced_folder <span class="st">&quot;~/src/&quot;</span>, <span class="st">&quot;/vagrant/src&quot;</span>

  (<span class="dv">1</span>..<span class="dt">NUM_INSTANCES</span>).each <span class="kw">do</span> |i|

    config.vm.define <span class="st">&quot;dummy-</span><span class="ot">#{</span>i<span class="ot">}</span><span class="st">&quot;</span> <span class="kw">do</span> |dummy|
      dummy.vm.box_check_update = <span class="dv">false</span>
      dummy.vm.hostname = <span class="st">&quot;dummy-</span><span class="ot">#{</span>i<span class="ot">}</span><span class="st">&quot;</span>
      dummy.vm.network <span class="st">:private_network</span>, ip: <span class="st">&quot;</span><span class="ot">#{</span><span class="dt">BASE_IP_ADDR</span><span class="ot">}</span><span class="st">.</span><span class="ot">#{</span>i<span class="ot">}</span><span class="st">&quot;</span>
    <span class="kw">end</span>

    config.vm.provider <span class="st">&quot;virtualbox&quot;</span> <span class="kw">do</span> |vbox|
      vbox.gui = <span class="dv">false</span>
      vbox.customize [<span class="st">&quot;modifyvm&quot;</span>, <span class="st">:id</span>, <span class="st">&quot;--memory&quot;</span>, <span class="st">&quot;1000&quot;</span>]
      <span class="co"># centos 6.5 slow network fix</span>
      vbox.customize [<span class="st">&quot;modifyvm&quot;</span>, <span class="st">:id</span>, <span class="st">&quot;--natdnsproxy1&quot;</span>, <span class="st">&quot;on&quot;</span>]
      vbox.customize [<span class="st">&quot;modifyvm&quot;</span>, <span class="st">:id</span>, <span class="st">&quot;--natdnshostresolver1&quot;</span>, <span class="st">&quot;on&quot;</span>]
    <span class="kw">end</span>

  <span class="kw">end</span>

<span class="kw">end</span></code></pre>
<h2 id="ssh-3">ssh</h2>
<h3 id="ssh-config">ssh config</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant up
vagrant ssh-config vm1  <span class="kw">&gt;&gt;</span> ~/.ssh/config
vagrant ssh-config vm2 <span class="kw">&gt;&gt;</span> ~/.ssh/config
<span class="kw">cat</span> ~/.ssh/config</code></pre>
<h2 id="provision">provision</h2>
<h3 id="with-chef">with chef</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant halt
vagrant sandbox on
vagrant up

<span class="kw">echo</span> vm1 vm2 <span class="kw">|</span> <span class="kw">xargs</span> -n 1 knife solo prepare 

vagrant halt
vagrant sandbox commit
vagrant up

<span class="kw">echo</span> vm1 vm2 <span class="kw">|</span> <span class="kw">xargs</span> -n 1 knife solo cook</code></pre>
<h2 id="plug-in">PLUG-IN</h2>
<h3 id="sandbox">sandbox</h3>
<h4 id="sandboxモード開始">sandboxモード開始</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant sandbox on</code></pre>
<h4 id="変更を決定する">変更を決定する</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant sandbox commit</code></pre>
<h4 id="変更を破棄しロールバックする">変更を破棄し、ロールバックする</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant sandbox rollback</code></pre>
<h4 id="sandboxモード終了commitしていないものは破棄される">sandboxモード終了（commitしていないものは破棄される）</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant sandbox off</code></pre>
<h4 id="現在sandboxモードかどうかの確認">現在sandboxモードかどうかの確認</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant sandbox status</code></pre>
<h1 id="oracle">ORACLE</h1>
<h2 id="setting">SETTING</h2>
<h3 id="tnsnames.ora">TNSNAMES.ORA</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cat</span> <span class="ot">$ORACLE_HOME</span>/network/admin/tnsnames.ora</code></pre>
<h3 id="tnsnames.ora-listener.ora">TNSNAMES.ora, LISTENER.ora</h3>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> <span class="ot">$ORACLE_HOME</span>/network/admin</code></pre>
<h3 id="stop-start-restart">STOP, START, RESTART</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">service dbora stop
service dbora start
service dbora restart</code></pre>
<h2 id="sqlplus">SQLPLUS</h2>
<h3 id="exec-.sql">exec *.sql</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">sqlplus <span class="kw">&lt;</span>USER<span class="kw">&gt;</span>/<span class="kw">&lt;</span>PASS<span class="kw">&gt;</span>@<span class="kw">&lt;</span>TNSNAME<span class="kw">&gt;</span> @<span class="kw">&lt;</span>FILE<span class="kw">&gt;</span></code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash">sqlplus <span class="kw">&lt;</span>USER<span class="kw">&gt;</span>/<span class="kw">&lt;</span>PASS<span class="kw">&gt;</span>@<span class="kw">&lt;</span>SID<span class="kw">&gt;</span> @<span class="kw">&lt;</span>FILE<span class="kw">&gt;</span></code></pre>
<h3 id="csv">CSV</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">set</span> colsep <span class="st">&#39;,&#39;</span>
<span class="kw">set</span> pagesize <span class="dv">0</span>
<span class="kw">set</span> trimspool <span class="kw">off</span>
<span class="kw">set</span> headsep <span class="kw">off</span>
<span class="kw">set</span> linesize <span class="dv">32767</span>
<span class="kw">set</span> feedback <span class="kw">off</span>
<span class="co">-- set numw X</span></code></pre>
<h2 id="enterprise-manager">Enterprise Manager</h2>
<h3 id="updown">UP/DOWN</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">emctl start dbconsole
emctl stop dbconsole</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">ORACLE_UNQNAME=</span>KX emctl start dbconsole</code></pre>
<h2 id="sql">SQL</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">TAB NAME</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_TAB_NAME" ng-init="ORA_TAB_NAME='TABNAME'">
</div>
</div>

</form>

<h3 id="insert">insert</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">insert</span> <span class="kw">into</span> {{ORA_TAB_NAME}} (&lt;COL1&gt; ,&lt;COL2&gt;) <span class="kw">values</span> (&lt;COL1VAL&gt;,&lt;COL2VAL&gt;);</code></pre>
<h3 id="update">update</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">update</span> {{ORA_TAB_NAME}} <span class="kw">set</span> &lt;COL1&gt;=<span class="st">&#39;AAA&#39;</span> , &lt;COL2&gt;=<span class="st">&#39;BBB&#39;</span> <span class="kw">where</span> &lt;COL3&gt;=<span class="st">&#39;ZZZ&#39;</span>;</code></pre>
<h3 id="prime">PRIME?</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> column_name <span class="kw">from</span> user_cons_columns
<span class="kw">where</span> constraint_name = (
      <span class="kw">select</span> constraint_name <span class="kw">from</span> user_constraints
      <span class="kw">where</span> table_name = <span class="st">&#39;&quot; + tab + &quot;&#39;</span> <span class="kw">and</span> constraint_type = <span class="st">&#39;P&#39;</span>
)</code></pre>
<h3 id="get-instance-name">get instance name</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> <span class="fu">sys_context</span>(<span class="st">&#39;USERENV&#39;</span>, <span class="st">&#39;instance_name&#39;</span>) <span class="kw">from</span> dual;</code></pre>
<h3 id="db-link">DB Link</h3>
<h4 id="connect">connect</h4>
<pre class="sourceCode bash"><code class="sourceCode bash">sqlplus sys/manager@<span class="kw">&lt;</span>db<span class="kw">&gt;</span> <span class="kw">as</span> sysdba</code></pre>
<h4 id="show-status">show status</h4>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">set</span> linesize <span class="dv">100</span>
col OWNER    format a10
col DB_LINK  format a20
col USERNAME format a10
col HOST     format a15
col CREATED  format a20
col <span class="kw">PASSWORD</span> format a20
<span class="kw">select</span> * <span class="kw">from</span> dba_db_links;</code></pre>
<h4 id="create-3">create</h4>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">PUBLIC</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> &lt;LINKNAME&gt;
<span class="kw">connect</span> <span class="kw">to</span> &lt;USER&gt; <span class="kw">identified</span> <span class="kw">by</span> &lt;PASS&gt;
<span class="kw">using</span> <span class="st">&#39;&lt;DB&gt;&#39;</span>;</code></pre>
<h3 id="get-object-source">get object source</h3>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span>
  dbms_metadata.get_ddl (
     &lt;OBJECT_TYPE&gt;
   , &lt;OBJECT_NAME&gt;
   , &lt;OWNER&gt;
  )
<span class="kw">from</span>
  dual
;</code></pre>
<h2 id="multi-master-replication">MULTI MASTER REPLICATION</h2>
<form class="form-horizontal">

<div class="form-group">
<label class="control-label col-xs-6">SITE A</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_REPSITE_A" ng-init="ORA_REPSITE_A='AAA'">
</div>
</div>

<div class="form-group">
<label class="control-label col-xs-6">SITE B</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_REPSITE_B" ng-init="ORA_REPSITE_B='BBB'">
</div>
</div>

<div class="form-group">
<label class="control-label col-xs-6">TNS</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_REPTNSNAME" ng-init="ORA_REPTNSNAME='DB'">
</div>
</div>

<div class="form-group">
<label class="control-label col-xs-6">TABLE</label>
<div class="col-xs-6">
<input class="form-control" type="text" onclick="this.select();" ng-model="ORA_REP_TABNAME" ng-init="ORA_REP_TABNAME='TABLENAME'">
</div>
</div>

</form>



<h3 id="sqlplus-1">SQLPLUS</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">sqlplus /nolog</code></pre>
<h3 id="create-repadmin">CREATE REPADMIN</h3>
<h4 id="ora_repsite_a">{{ORA_REPSITE_A}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="kw">CREATE</span> <span class="fu">USER</span> repadmin <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">COMMENT</span> <span class="kw">ANY</span> <span class="kw">TABLE</span> <span class="kw">TO</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">LOCK</span> <span class="kw">ANY</span> <span class="kw">TABLE</span> <span class="kw">TO</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">SELECT</span> <span class="kw">ANY</span> <span class="kw">DICTIONARY</span> <span class="kw">TO</span> repadmin;
<span class="kw">GRANT</span> <span class="kw">EXECUTE</span> <span class="kw">ANY</span> <span class="kw">PROCEDURE</span> <span class="kw">TO</span> repadmin;
<span class="kw">EXEC</span> Dbms_Repcat_Admin.Grant_Admin_Any_Repgroup(<span class="st">&#39;repadmin&#39;</span>);
<span class="kw">EXEC</span> Dbms_Repcat_Admin.Grant_Admin_Any_Schema (username =&gt; <span class="st">&#39;repadmin&#39;</span>);

<span class="co">-- プロパゲータ（送信者ロール）を登録</span>
<span class="kw">EXEC</span> DBMS_DEFER_SYS.REGISTER_PROPAGATOR(<span class="st">&#39;repadmin&#39;</span>);

<span class="co">-- 受信者（ロール）を登録</span>
<span class="kw">BEGIN</span>
   DBMS_REPCAT_ADMIN.REGISTER_USER_REPGROUP (
      username       =&gt; <span class="st">&#39;repadmin&#39;</span>,
      privilege_type =&gt; <span class="st">&#39;receiver&#39;</span>,
      list_of_gnames =&gt; <span class="kw">NULL</span>);
<span class="kw">END</span>;
/</code></pre>
<h4 id="ora_repsite_b">{{ORA_REPSITE_B}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="co">--</span>
<span class="co">-- same {{ORA_REPSITE_A}}</span>
<span class="co">--</span></code></pre>
<h3 id="create-database-link">CREATE DATABASE LINK</h3>
<h4 id="ora_repsite_a-1">{{ORA_REPSITE_A}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="kw">CREATE</span> <span class="kw">PUBLIC</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}} <span class="kw">USING</span> <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}
<span class="kw">CONNECT</span> <span class="kw">TO</span> repadmin <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> repadmin <span class="kw">using</span> <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<h4 id="ora_repsite_b-1">{{ORA_REPSITE_B}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn sys/manager@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}} <span class="kw">as</span> <span class="kw">sysdba</span> <span class="kw">as</span> <span class="kw">sysdba</span>

<span class="kw">CREATE</span> <span class="kw">PUBLIC</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}} <span class="kw">USING</span> <span class="st">&#39;{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}

<span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="kw">LINK</span> {{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}
<span class="kw">CONNECT</span> <span class="kw">TO</span> repadmin <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> repadmin <span class="kw">using</span> <span class="st">&#39;{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}&#39;</span>;</code></pre>
<h3 id="create-job">CREATE JOB</h3>
<h4 id="ora_repsite_a-2">{{ORA_REPSITE_A}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PURGE (
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">24</span>),
      <span class="dt">interval</span> =&gt; <span class="st">&#39;SYSDATE + (1/24)&#39;</span>,
      delay_seconds =&gt; <span class="dv">0</span>,
      rollback_segment =&gt; <span class="st">&#39;&#39;</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/24 = １時間</span>

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PUSH(
      destination =&gt; <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}.WORLD&#39;</span>,
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">8640</span>),
      <span class="dt">interval</span>  =&gt; <span class="st">&#39;SYSDATE + (1/8640)&#39;</span>,
      parallelism =&gt; <span class="dv">1</span>,
      delay_seconds =&gt; <span class="dv">0</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/8640 = 10sec</span></code></pre>
<h4 id="ora_repsite_b-2">{{ORA_REPSITE_B}}</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PURGE (
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">24</span>),
      <span class="dt">interval</span> =&gt; <span class="st">&#39;SYSDATE + (1/24)&#39;</span>,
      delay_seconds =&gt; <span class="dv">0</span>,
      rollback_segment =&gt; <span class="st">&#39;&#39;</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/24 = １時間</span>

<span class="kw">BEGIN</span>
   DBMS_DEFER_SYS.SCHEDULE_PUSH(
      destination =&gt; <span class="st">&#39;{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}.WORLD&#39;</span>,
      next_date =&gt; <span class="fu">SYSDATE</span> + (<span class="dv">1</span>/<span class="dv">8640</span>),
      <span class="dt">interval</span>  =&gt; <span class="st">&#39;SYSDATE + (1/8640)&#39;</span>,
      parallelism =&gt; <span class="dv">1</span>,
      delay_seconds =&gt; <span class="dv">0</span>
   );
<span class="kw">END</span>;
/
<span class="co">-- 1/8640 = 10sec</span></code></pre>
<h4 id="check">Check</h4>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="co">-- conn repadmin/repadmin@???_{{ORA_REPTNSNAME}}</span>

<span class="kw">set</span> linesize <span class="dv">150</span>
col job    format <span class="st">&#39;00000&#39;</span>
col what  format a65
col SCHEMA_USER format a10
col LAST_DATE format a10
col THIS_DATE format a10
col NEXT_DATE format a10
col <span class="dt">INTERVAL</span> format a10
<span class="kw">select</span> job,BROKEN,SCHEMA_USER,LAST_DATE,THIS_DATE,NEXT_DATE,
 <span class="dt">INTERVAL</span>, what <span class="kw">from</span> user_jobs;</code></pre>
<h3 id="create-replication-group">CREATE REPLICATION GROUP</h3>
<h4 id="ora_repsite_a-only">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">EXEC</span> DBMS_REPCAT.CREATE_MASTER_REPGROUP(<span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>);

<span class="kw">BEGIN</span>
   DBMS_REPCAT.ADD_MASTER_DATABASE (
      gname     =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>,
      <span class="kw">master</span>    =&gt; <span class="st">&#39;{{ORA_REPSITE_B}}_{{ORA_REPTNSNAME}}&#39;</span>,
      use_existing_objects =&gt; <span class="kw">TRUE</span>,
      copy_rows =&gt; <span class="kw">FALSE</span>,
      propagation_mode =&gt; <span class="st">&#39;ASYNCHRONOUS&#39;</span>
   );
<span class="kw">END</span>;
/</code></pre>
<h3 id="add-object">ADD OBJECT</h3>
<h4 id="ora_repsite_a-only-1">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">begin</span> DBMS_REPCAT.CREATE_MASTER_REPOBJECT (
  gname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>
, <span class="kw">type</span> =&gt; <span class="st">&#39;TABLE&#39;</span>
, oname =&gt; <span class="st">&#39;{{ORA_REP_TABNAME}}&#39;</span>
, sname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}&#39;</span>
, use_existing_object =&gt; <span class="kw">TRUE</span>  <span class="co">-- 既存のオブジェクトを使用</span>
, copy_rows =&gt; <span class="kw">FALSE</span>           <span class="co">-- データのコピー</span>
);
<span class="kw">end</span>;
/

<span class="co">--（対象テーブル全部を登録する）</span></code></pre>
<h3 id="generate-replication-support">GENERATE REPLICATION SUPPORT</h3>
<h4 id="ora_repsite_a-only-2">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">begin</span> DBMS_REPCAT.GENERATE_REPLICATION_SUPPORT (
  sname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}&#39;</span>
, oname =&gt; <span class="st">&#39;{{ORA_REP_TABNAME}}&#39;</span>
, <span class="kw">type</span> =&gt; <span class="st">&#39;TABLE&#39;</span>
, min_communication =&gt; <span class="kw">TRUE</span>);
<span class="kw">end</span>;
/</code></pre>
<h3 id="start-replication">START REPLICATION</h3>
<h4 id="ora_repsite_a-only-3">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">exec</span> dbms_repcat.resume_master_activity(gname =&gt; <span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>);</code></pre>
<h3 id="stop-replication">STOP REPLICATION</h3>
<h4 id="ora_repsite_a-only-4">{{ORA_REPSITE_A}} ONLY!</h4>
<pre class="sourceCode sql"><code class="sourceCode sql">conn repadmin/repadmin@{{ORA_REPSITE_A}}_{{ORA_REPTNSNAME}}

<span class="kw">exec</span> dbms_repcat.suspend_master_activity(gname=&gt;<span class="st">&#39;{{ORA_REPTNSNAME}}_REPG&#39;</span>);</code></pre>
</body>
</html>
